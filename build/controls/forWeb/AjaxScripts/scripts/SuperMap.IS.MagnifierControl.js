//================================================================================ 
// SuperMap IS .NET 客户端程序，版权所有，北京超图软件股份有限公司，2000-2008。 
// 本程序只能在有效的授权许可下使用。未经许可，不得以任何手段擅自使用或传播。 
// 作 者:  SuperMap IS Web Team 
// 版 本:  $Id: SuperMap.IS.MagnifierControl.js,v 1.57 2011/01/11 09:38:56 hubq Exp $
// 文 件:  SuperMap.IS.MagnifierControl.js 
// 描 述:  AjaxScripts 放大镜控件 
// 更 新:  $Date: 2011/01/11 09:38:56 $ 
//================================================================================ 
SuperMap.IS.MagnifierControl=function(g,b,E){g=_GetDomElement(g);this.width=200;if(g.style.pixelWidth){this.width=g.style.pixelWidth}else{g.style.pixelWidth=this.width}this.height=200;if(g.style.pixelHeight){this.height=g.style.pixelHeight}else{g.style.pixelHeight=this.height}this.headHeight=20;if(E&&typeof (E.headHeight)!="undefined"){this.headHeight=E.headHeight}this.headBackColor="SkyBlue";if(E&&typeof (E.headBackColor)!="undefined"){this.headBackColor=E.headBackColor}this.minZoomRadio=2;if(E&&typeof (E.minZoomRadio)!="undefined"){this.minZoomRadio=E.minZoomRadio}this.maxZoomRadio=6;if(E&&typeof (E.maxZoomRadio)!="undefined"){this.maxZoomRadio=E.maxZoomRadio}this.closeButton=true;if(E&&typeof (E.closeButton)!="undefined"){this.closeButton=E.closeButton}this.closeButtonImg="images/close.gif";if(E&&typeof (E.closeButtonImg)!="undefined"){this.closeButtonImg=E.closeButtonImg}this.draggable=true;if(E&&typeof (E.draggable)!="undefined"){this.draggable=E.draggable}this.expandCollapseButton=true;if(E&&typeof (E.expandCollapseButton)!="undefined"){this.expandCollapseButton=E.expandCollapseButton}this.expandButtonImg="images/restore.gif";if(E&&typeof (E.expandButtonImg)!="undefined"){this.expandButtonImg=E.expandButtonImg}this.collapseButtonImg="images/mini.gif";if(E&&typeof (E.collapseButtonImg)!="undefined"){this.collapseButtonImg=E.collapseButtonImg}this.expanded=true;if(E&&typeof (E.expanded)!="undefined"){this.expanded=E.expanded}this.title="";if(E&&typeof (E.title)!="undefined"){this.title=E.title}this.headFont=new SuperMap.IS.Font();if(E&&typeof (E.headFont)!="undefined"){var o=eval("("+E.headFont+")");this.headFont.FromJSON(o);o=null}this.headBackgroundImage="";if(E&&typeof (E.headBackgroundImage)!="undefined"){this.headBackgroundImage=E.headBackgroundImage}this.headSeparatorLine=true;if(E&&typeof (E.headSeparatorLine)!="undefined"){this.headSeparatorLine=E.headSeparatorLine}this.left=0;if(E&&typeof (E.left)!="undefined"){this.left=E.left}this.top=0;if(E&&typeof (E.top)!="undefined"){this.top=E.top}var r;var h=false;var M;var n;var i;var d;var A;var P;var l;var K=this;var L;var H;var a=false;var p;var T;var N;var I;var G;var c=null;var U=0;this.Destroy=F;this.Close=e;this.Collapse=V;this.Expand=m;this.Update=Q;this.RefreshImage=S;if(b){b.AttachEvent("oninit",k);b.AttachEvent("ondestroying",F)}function k(){if(c&&c.parentNode){c.parentNode.removeChild(c)}c=document.createElement("div");c.style.position="absolute";c.style.pixelWidth=K.width;c.style.pixelHeight=K.height;c.style.overflow="hidden";g.onmousedown=C;g.onmousemove=J;g.onmouseup=B;g.ondblclick=X;g.onmousewheel=D;g.style.position="absolute";g.style.display="block";r=b.workLayer;g.style.zIndex=21;g.style.left=K.left+"px";g.style.top=K.top+"px";g.appendChild(c);if(g.style.borderWidth){U=g.offsetWidth-g.clientWidth}r.appendChild(g);O();N=b.mapName;if(b){b.AttachEvent("onchangeview",S)}}function Z(){K.width=E.width;K.height=E.height;K.headHeight=E.headHeight;K.headBackColor=E.headBackColor;K.minZoomRadio=E.minZoomRadio;K.maxZoomRadio=E.maxZoomRadio;K.closeButton=E.closeButton;K.closeButtonImg=E.closeButtonImg;K.draggable=E.draggable;K.expandCollapseButton=E.expandCollapseButton;K.expandButtonImg=E.expandButtonImg;K.collapseButtonImg=E.collapseButtonImg;K.expanded=E.expanded;K.title=E.title;K.headFont=eval("("+E.headFont+")");K.headBackgroundImage=E.headBackgroundImage;K.headSeparatorLine=E.headSeparatorLine}function F(){if(b){b.DetachEvent("onchangeview",S);b.DetachEvent("oninit",k);b.DetachEvent("ondestroying",F)}r=null;A=null;P=null;l=null;K=null;L=null;H=null;a=null;p=null;T=null;N=null;I=null;G=null;if(c&&c.parentNode){c.parentNode.removeChild(c)}g.innerHTML="";c=g=E=null}function S(){if(!N){N=b.mapName;return }if(!M){M=parseInt(g.style.left)}if(!n){n=parseInt(g.style.top)}if(a){return }N=b.mapName;P=new SuperMap.IS.PixelCoord(M+parseInt(A.style.width)/2+A.offsetLeft+1,n+parseInt(A.style.height)/2+A.offsetTop+1);l=b.GetMapScale();var t=b.PixelToMapCoord(P,l);var w=new SuperMap.IS.PixelRect(0,0,parseInt(A.style.width),parseInt(A.style.height));var s=document.getElementById(g.id+"_ZoomRadio");if(!t.x||!t.y||!w||!s){return }var u=s.options[s.selectedIndex].value;var v=new SuperMap.IS.MapParam(b.mapName,l*u);v.pixelRect=w;v.center=t;b.GetMapImage(v,W,q);v.Destroy();w=null;t=null;s=null}function e(t){t=_GetEvent(t);if(t){_CancelBubble(t)}A.style.display="none";g.style.height=K.height-parseInt(A.style.height)+"px";L=g.style.left;H=g.style.top;g.style.left=K.left+"px";g.style.top=K.top+"px";A.style.backgroundImage="url(images/spacer.gif)";A.style.backgroundRepeat="no-repeat";var s=document.getElementById(g.id+"_expandCollapse");s.src=K.expandButtonImg;s.onclick=m;p.style.display="none";T.style.display="none";a=true}function m(t){if(!a){return }t=_GetEvent(t);if(t){_CancelBubble(t)}A.style.display="block";g.style.height=K.height+"px";g.style.left=L;g.style.top=H;a=false;var s=document.getElementById(g.id+"_expandCollapse");s.src=K.collapseButtonImg;p.style.display="block";T.style.display="block";s.onclick=V}function V(t){t=_GetEvent(t);if(t){_CancelBubble(t)}A.style.display="none";L=g.style.left;H=g.style.top;g.style.height=K.height-parseInt(A.style.height)+"px";g.style.overflow="hidden";A.style.backgroundImage="url(images/spacer.gif)";A.style.backgroundRepeat="no-repeat";var s=document.getElementById(g.id+"_expandCollapse");s.src=K.expandButtonImg;s.onclick=m;p.style.display="none";T.style.display="none";a=true}function C(w){w=_GetEvent(w);var v=_GetTarget(w);_CancelBubble(w);var u=new SuperMap.IS.PanAction();b.SetAction(u);if(v.tagName=="IMG"||v.tagName=="SELECT"||v.tagName=="OPTION"){return }if(!K.draggable){return }var t=_GetMouseX(w);var s=_GetMouseY(w);I=t;G=s;A.style.backgroundImage="url(images/spacer.gif)";A.style.backgroundRepeat="no-repeat";h=true;p.style.display="block";T.style.display="block";return false}function J(v){if(!h){return false}v=_GetEvent(v);var u=_GetMouseX(v);var t=_GetMouseY(v);var s=u-I;var w=t-G;M=parseInt(g.style.left)+s;n=parseInt(g.style.top)+w;g.style.left=M+"px";g.style.top=n+"px";I=u;G=t;_CancelBubble(v);return false}function B(t){t=_GetEvent(t);var s=_GetTarget(t);_CancelBubble(t);if(s.tagName=="IMG"||s.tagName=="SELECT"||s.tagName=="OPTION"){return false}S();h=false;p.style.display="none";T.style.display="none";L=g.style.left;H=g.style.top;return false}function X(s){if(a){m(s)}else{V(s)}return false}function D(s){s=_GetEvent(s);_CancelBubble(s);return false}function W(t){A.style.backgroundImage="url("+t+")";A.style.backgroundRepeat="no-repeat";var s=_ygPos.browser;if(s=="opera"){c.removeChild(A);c.appendChild(A)}}function q(){}function Y(){var w=document.createElement("div");w.id=g.id+"_Head";w.style.backgroundColor=K.headBackColor;w.style.width=K.width+"px";w.style.height=K.headHeight+U+"px";if(K.headSeparatorLine){w.style.borderBottom="1px solid black"}if(K.headFont){w.style.fontFamily=K.headFont.fontFamily.name;w.style.fontSize=K.headFont.size;if(K.headFont.bold){w.style.fontWeight="bold"}if(K.headFont.italic){w.style.fontStyle="italic"}if(K.headFont.underline&&K.headFont.strikeout){w.style.textDecoration="underline line-through"}else{if(K.headFont.underline){w.style.textDecoration="underline"}else{if(K.headFont.strikeout){w.style.textDecoration="line-through"}}}}if(K.headBackgroundImage){w.style.backgroundImage="url("+K.headBackgroundImage+")"}var v="<table><tr><td width="+K.width*0.4+">";if(K.title){v+=K.title}v+="</td>";v+="<td  width="+K.width*0.3+" valign='top'>";v+="<select style='width:100%;font-family:宋体;font-size:"+K.headHeight*0.6+"px' id='"+g.id+"_ZoomRadio' >";for(var u=K.minZoomRadio;u<=K.maxZoomRadio;u++){v+="<option value="+u+" >"+u+"x</option>"}v+="</select>";v+="</td>";v+="<td align='right' valign='top' width="+K.width*0.3+" >";if(K.expandCollapseButton){v+="<img id='"+g.id+"_expandCollapse' src='"+K.collapseButtonImg+"' />"}if(K.closeButton){v+="<img id='"+g.id+"_close' src='"+K.closeButtonImg+"' />"}v+="</td>";v+="</tr></table>";w.innerHTML=v;c.appendChild(w);R(g.id+"_ZoomRadio",S);var s=document.getElementById(g.id+"_expandCollapse");if(s){s.onclick=V}s=document.getElementById(g.id+"_close");if(s){s.onclick=e}if(_ygPos.browser.indexOf("ie")==-1){var x=document.getElementById(g.id+"_close");x.style.MozUserSelect="none";var t=document.getElementById(g.id+"_expandCollapse");t.style.MozUserSelect="none"}}function R(u,t){var s=document.getElementById(u);if(s!=null){if(_ygPos.browser.indexOf("ie")!=-1||_ygPos.browser=="opera"){s.attachEvent("onchange",t)}else{s.addEventListener("change",t,true)}s=null}}function f(){A=document.createElement("div");A.style.width=K.width+"px";A.style.height=K.height-K.headHeight-U+"px";A.style.position="absolute";A.id=g.id+"_Body";p=document.createElement("div");p.style.width="20px";p.style.height="2px";p.style.fontSize=0;p.style.backgroundColor="red";p.style.position="absolute";p.id=g.id+"_vertCross";p.style.top=parseFloat(A.style.height)/2-parseFloat(p.style.height)/2+"px";p.style.left=parseFloat(A.style.width)/2-parseFloat(p.style.width)/2+"px";A.appendChild(p);T=document.createElement("div");T.style.width="2px";T.style.height="20px";T.style.backgroundColor="red";T.style.position="absolute";T.id=g.id+"_HorizCross";T.style.top=parseFloat(A.style.height)/2-parseFloat(T.style.height)/2+"px";T.style.left=parseFloat(A.style.width)/2-parseFloat(T.style.width)/2+"px";A.appendChild(T);A.style.backgroundImage="url(images/spacer.gif)";A.style.backgroundRepeat="no-repeat";c.appendChild(A)}function O(){Y();f();if(!K.expanded){V()}else{g.style.left=K.left+"px";g.style.top=K.top+"px"}}function j(){var u=new Object();u.width=K.width;u.height=K.height;u.headHeight=K.headHeight;u.minZoomRadio=K.minZoomRadio;u.maxZoomRadio=K.maxZoomRadio;u.closeButton=K.closeButton;u.draggable=K.draggable;u.expandCollapseButton=K.expandCollapseButton;u.expanded=K.expanded;u.title=K.title;var s=_ToJSON(u);var t=document.getElementById(g.id+"_hiddenProperty");if(t){t.value=s}}function Q(){Z();O();j()}}
