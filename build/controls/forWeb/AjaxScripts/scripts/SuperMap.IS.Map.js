//================================================================================ 
// SuperMap IS .NET 客户端程序，版权所有，北京超图软件股份有限公司，2000-2009。 
// 本程序只能在有效的授权许可下使用。未经许可，不得以任何手段擅自使用或传播。 
// 作 者:  SuperMap IS Web Team 
// 版 本:  $Id: SuperMap.IS.Map.js,v 1.73 2010/11/25 06:58:21 hubq Exp $
// 文 件:  SuperMap.IS.Map.js 
// 描 述:  AjaxScripts Map 类 
// 更 新:  $Date: 2010/11/25 06:58:21 $ 
//================================================================================ 
SuperMap.IS.Map=function(f){var F=this;var M=null,c=0,b=null,L=null;var H=f;var A=new Array();var Q=new Array(),a=new Array();var Z=new Date().getTime();var D=false;var T;this.layers=new Array();this.layersBackupForHandler=A;this.mapName="";this.mapScale=0;this.Init=function(m,k){if(!H.imageFormat){H.imageFormat="png"}if(typeof (H.antiAliases)!="undefined"&&H.antiAliases!=null){if(typeof (f.antiAliases[H.mapName])!="undefined"){T=f.antiAliases[H.mapName]}}else{if(typeof (H.antiAlias)!="undefined"){T=H.antiAlias}}if(!H.mapHandler){H.mapHandler="./"}if(!H.mapName){H.mapName=""}if(!H.mapScale){H.mapScale=null}if(H.useImageBuffer==undefined){H.useImageBuffer=true}if(!H.tileSize){H.tileSize=256}if(!H.layersKey){H.layersKey=0}if(H.redirect==undefined){H.redirect=true}if(H.returnLayers==undefined){H.returnLayers=false}if(H.returnThemes==undefined){H.returnThemes=false}if(!H.outputContextPath){H.outputContextPath="http://localhost/IS/output/"}this.mapName=H.mapName;this.mapScale=H.mapScale;h();U();function l(q){var o=eval("("+q+")");if(!o){return }var p=new SuperMap.IS.MapStatus();p.FromJSON(o);j(p);p.Destroy();p=null}function i(o){if(k){k(o)}}var n=false;if(f.mapStatuses&&f.mapStatuses[H.mapName]){mapStatus=f.mapStatuses[H.mapName];if(mapStatus.mapName&&mapStatus.referViewer&&mapStatus.mapBounds&&mapStatus.mapNames&&mapStatus.referScale&&mapStatus.referViewBounds&&mapStatus.referBounds&&mapStatus.imageFormat){if(mapStatus.referViewer.leftTop&&mapStatus.referViewer.rightBottom&&mapStatus.referBounds.leftBottom&&mapStatus.referBounds.rightTop&&mapStatus.referViewBounds.leftBottom&&mapStatus.referViewBounds.rightTop){n=true}}}if(!n){this.GetMapStatus(H.returnLayers,H.returnThemes,l,i)}else{mapStatus=new SuperMap.IS.MapStatus();mapStatus.FromJSON(f.mapStatuses[H.mapName]);j(mapStatus);mapStatus.Destroy();mapStatus=null}function j(o){if(H.x==null){H.x=o.referViewBounds.Center().x}if(H.y==null){H.y=o.referViewBounds.Center().y}if(H.mapScale==null){this.mapScale=H.mapScale=o.referScale}H.mapName=o.mapName;if(typeof (T)=="undefined"){if(typeof (o.antiAlias)=="boolean"){T=o.antiAlias}else{T=false}}if(M==null){M=new SuperMap.IS.MapRect()}if(L==null){L=new SuperMap.IS.MapRect()}M.FromJSON(o.referViewBounds);L.FromJSON(o.mapBounds);c=o.referScale;if(b==null){b=new SuperMap.IS.PixelRect()}b.FromJSON(o.referViewer);F.mapName=o.mapName;if(H.imageFormat.toLowerCase()=="default"){H.imageFormat=o.imageFormat}if(o.referBounds){D=true;H.useReferBounds=true}else{H.useReferBounds=false}if(m){m(o)}}};this.UpdateMapStatus=function(j){function i(m){var k=eval("("+m+")");if(!k){return }var l=new SuperMap.IS.MapStatus();l.FromJSON(k);if(M==null){M=new SuperMap.IS.MapRect()}if(L==null){L=new SuperMap.IS.MapRect()}M.FromJSON(l.referViewBounds);L.FromJSON(l.mapBounds);c=l.referScale;if(b==null){b=new SuperMap.IS.PixelRect()}b.FromJSON(l.referViewer);F.mapName=l.mapName;if(l.referBounds){D=true;H.useReferBounds=true}else{H.useReferBounds=false}if(j){j(l)}}this.GetMapStatus(false,false,i)};this.Destroy=function(){if(this.layers!=null){while(this.layers.length>0){var i=this.layers.pop();if(i){i.Destroy();i=null}}this.layers=null}if(this.layersBackupForHandler!=null){while(this.layersBackupForHandler.length>0){var k=this.layersBackupForHandler.pop();if(k){k.Destroy();k=null}}this.layersBackupForHandler=null}if(this.referViewBounds!=null){this.referViewBounds.Destroy();this.referViewBounds=null}if(this.mapBounds!=null){this.mapBounds.Destroy();this.mapBounds=null}if(this.referViewer!=null){this.referViewer.Destroy();this.referViewer=null}if(Q!=null){while(Q.length>0){var l=Q.pop();l=null}Q=null}if(a!=null){while(a.length>0){var j=a.pop();j=null}a=null}};function K(k,j,i){return true}function P(o,n,l){var j="";if(f.customKeys){for(var m=0;m<f.customKeys.length;m++){j+="&"+f.customKeys[m]+"="+f.customValues[m]}}var p=false;if(f.transparent){p=f.transparent}var k=_GetCurrentHandler(H.mapHandler)+"ajax/"+encodeURI(H.mapName)+"/"+l+"/"+o+"/"+n+"/"+H.tileSize+"/"+H.imageFormat+"/"+H.layersKey+"/"+T+"/"+D+"/map.ashx?t="+Z+"&redirect="+H.redirect+j+"&transparent="+p;return k}function I(k,i,j){return H.outputContextPath+"simpleCache/"+H.mapName+"_"+H.tileSize+"x"+H.tileSize+"/"+Math.round(1/j)+"/"+k+"/"+i+"."+H.imageFormat}function S(i,j,k){if(M==null||b==null){return }if(k){return(c/j)*M.Height()/b.Height()*i}else{return(c/j)*M.Width()/b.Width()*i}}function e(i,j,k){var l=1;if(M==null||b==null){return }if(this.mapScale!=null){l=c/j}if(k){return b.Height()*i/(l*M.Height())}else{return b.Width()*i/(l*M.Width())}}function W(j,k,i){return(c/k)*M.Width()/b.Width()*i}function N(j,i){if(i==null){i=this.mapScale}var m=S(1,i);var k=S(1,i,true);var l=new SuperMap.IS.MapCoord();if(m==null||k==null){return l}l.x=L.leftBottom.x+(j.x*m);l.y=L.rightTop.y-(j.y*k);return l}function d(l,j){if(j==null){j=this.mapScale}var m=S(1,j);var k=S(1,j,true);var i=new SuperMap.IS.PixelCoord();if(m==null||k==null){return i}i.x=parseInt((l.x-L.leftBottom.x)/m);i.y=parseInt((L.rightTop.y-l.y)/k);return i}function V(){return L}function J(i){if(i.mapScale<=0){i.SetMapScale(1)}}function X(){return T}this.GetCurrentAntiAlias=X;this.IsValidTile=K;this.GetTileUrl=P;this.GetTileSimpleCacheUrl=I;this.PixelToMapDistance=S;this.MapDistanceToPixel=e;this.PixelToMapCoord=N;this.MapCoordToPixel=d;this.GetBounds=V;this.ValidateMapScale=J;this.ComputeMapScaleByDistance=W;this.Update=function(j,m,p){if(!A){_BackupLayers(A,H.layers)}var i=_FindDifference(A,H.layers);var r="UpdateLayers";var k=false;if(H.bModifiedByServer==true){k=true;H.bModifiedByServer=false}var q=H.mapHandler+"common.ashx";var n=H.mapName;function o(s){if(!s){if(j){j(null,p)}return }var t=H.layersKey;H.layersKey=eval("("+s+")");if(t!=0&&t==H.layersKey){t=0}g(H.layersKey);_BackupLayers(A,H.layers);O();Z=new Date().getTime();if(t!=0){B("onchangelayer")}if(j){j(H.layersKey,p)}}var l=new SuperMap.IS.RequestManager(q,o,m,p);l.AddQueryString("map",n);l.AddQueryString("method",r);l.AddQueryString("layers",i);l.AddQueryString("layersKey",H.layersKey);l.AddQueryString("bModifiedByServer",k);if(H.customKeys){requestManager.AddQueryStrings(H.customKeys,H.customValues)}l.Send();l.Destroy();l=null};this.MeasureDistance=function(v,l,k,n,q){var t="MeasureDistance";var i=null;var r=null;if(arguments[1]==null||arguments[1].constructor==SuperMap.IS.Highlight){var j=l;i=["points","highlight","trackingLayerIndex","userID"];r=[v,j,H.trackingLayerIndex,H.userID]}else{i=["points","isHighlight","trackingLayerIndex","userID"];r=[v,l,H.trackingLayerIndex,H.userID]}var s=H.mapHandler+"common.ashx";var o=H.mapName;var u=true;if(H.keepHighlight!=null){u=H.keepHighlight}function p(y){var x=eval("("+y+")");if(x==null){if(k){k(null,q)}return }var w=new SuperMap.IS.MeasureResult();w.FromJSON(x);R(w.trackingLayerIndex,w.userID,true);if(k){k(w,q)}}var m=new SuperMap.IS.RequestManager(s,p,n,q);m.AddQueryString("map",o);m.AddQueryString("method",t);m.AddQueryString("keepHighlight",u);m.AddQueryStrings(i,r);m.Send();m.Destroy();m=null;while(i.length>0){i.pop();r.pop()}i=null;r=null};this.MeasureArea=function(v,l,k,n,q){var t="MeasureArea";var i=null;var r=null;if(arguments[1]==null||arguments[1].constructor==SuperMap.IS.Highlight){var j=l;i=["points","highlight","trackingLayerIndex","userID"];r=[v,j,H.trackingLayerIndex,H.userID]}else{i=["points","isHighlight","trackingLayerIndex","userID"];r=[v,l,H.trackingLayerIndex,H.userID]}var s=H.mapHandler+"common.ashx";var o=H.mapName;var u=true;if(H.keepHighlight!=null){u=H.keepHighlight}function p(y){var x=eval("("+y+")");if(x==null){if(k){k(null,q)}return }var w=new SuperMap.IS.MeasureResult();w.FromJSON(x);R(w.trackingLayerIndex,w.userID,true);if(k){k(w,q)}}var m=new SuperMap.IS.RequestManager(s,p,n,q);m.AddQueryString("map",o);m.AddQueryString("method",t);m.AddQueryString("keepHighlight",u);m.AddQueryStrings(i,r);m.Send();m.Destroy();m=null;while(i.length>0){i.pop();r.pop()}i=null;r=null};this.CustomInvoke=function(j,o,k,m,q){var t="CustomInvoke";var i=["customParams","identifier"];var r=[j,o];var s=H.mapHandler+"common.ashx";var n=H.mapName;function p(u){if(k){k(u,q)}}var l=new SuperMap.IS.RequestManager(s,p,m,q);l.AddQueryString("map",n);l.AddQueryString("method",t);l.AddQueryStrings(i,r);l.Send();l.Destroy();l=null;while(i.length>0){i.pop();r.pop()}i=null;r=null};this.GetOverview=function(s,j,l,o){var r="GetOverview";var i=["overview"];var p=[s];var q=H.mapHandler+"common.ashx";var m=H.mapName;function n(v){var u=eval("("+v+")");if(u==null){if(j){j(null,o)}return }var t=new SuperMap.IS.Overview();t.FromJSON(u);if(j){j(t,o)}}var k=new SuperMap.IS.RequestManager(q,n,l,o);k.AddQueryString("map",m);k.AddQueryString("method",r);k.AddQueryStrings(i,p);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();p.pop()}i=null;p=null};this.GetMapImage=function(m,j,l,p){var s="GetMapImage";var i=["mapParam"];var q=[m];var r=H.mapHandler+"common.ashx";var n=H.mapName;function o(t){if(j){j(t,p)}}var k=new SuperMap.IS.RequestManager(r,o,l,p);k.AddQueryString("map",n);k.AddQueryString("method",s);k.AddQueryString("layersKey",H.layersKey);k.AddQueryString("userId",H.userID);k.AddQueryString("trackingLayerHistoryIndex",H.trackingLayerIndex);k.AddQueryStrings(i,q);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.GetMapImageByDpi=function(m,t,j,l,p){var s="GetMapImageByDpi";var i=["mapParam","imageDpi"];var q=[m,t];var r=H.mapHandler+"common.ashx";var n=H.mapName;function o(u){if(j){j(u,p)}}var k=new SuperMap.IS.RequestManager(r,o,l,p);k.AddQueryString("map",n);k.AddQueryString("method",s);k.AddQueryStrings(i,q);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.GetResource=function(n,k,j,m,p){var s="GetResource";var i=["resourceParam"];var q=[k];var r=H.mapHandler+"common.ashx";function o(t){if(!t){if(j){j(null,p)}return }if(j){j(t,p)}}var l=new SuperMap.IS.RequestManager(r,o,m,p);l.AddQueryString("map",n);l.AddQueryString("method",s);l.AddQueryStrings(i,q);l.Send();l.Destroy();l=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.GetGeometryImage=function(m,q,j,l,o){var s="GetGeometryImage";var i=["geometryParam"];var p=[q];var r=H.mapHandler+"common.ashx";function n(v){var u=eval("("+v+")");if(u==null){if(j){j(null,o)}return }var t=new SuperMap.IS.GeometryImage();t.FromJSON(u);if(j){j(t,o)}}var k=new SuperMap.IS.RequestManager(r,n,l,o);k.AddQueryString("map",m);k.AddQueryString("method",s);k.AddQueryStrings(i,p);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();p.pop()}i=null;p=null};this.ClearHighlight=function(j,l,o){var r="ClearHighlight";var i=["trackingLayerIndex","userID"];var p=[H.trackingLayerIndex,H.userID];var q=H.mapHandler+"common.ashx";var m=H.mapName;function n(){R(H.trackingLayerIndex+1,H.userID,true);if(j){j(o)}}var k=new SuperMap.IS.RequestManager(q,n,l,o);k.AddQueryString("map",m);k.AddQueryString("method",r);k.AddQueryStrings(i,p);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();p.pop()}i=null;p=null};this.GetEntity=function(o,n,i,k,m,r){var t="GetEntity";var j=["layerName","id"];var q=[n,i];var s=H.mapHandler+"common.ashx";var o=H.mapName;function p(v){var w=eval("("+v+")");if(w==null){k(null,r);return }var u=new SuperMap.IS.Entity();u.FromJSON(w);if(k){k(u,r);u.Destroy();u=null}}var l=new SuperMap.IS.RequestManager(s,p,m,r);l.AddQueryString("map",o);l.AddQueryString("method",t);l.AddQueryStrings(j,q);l.Send();l.Destroy();l=null;while(j.length>0){j.pop();q.pop()}j=null;q=null};this.GetEntities=function(o,n,i,k,m,r){var t="GetEntities";var j=["layerName","ids"];var q=[n,i];var s=H.mapHandler+"common.ashx";var o=H.mapName;function p(x){var w=eval("("+x+")");if(w==null){k(null,r);return }var y=new Array();for(var v=0;v<w.length;v++){y[v]=new SuperMap.IS.Entity();y[v].FromJSON(w[v])}if(k){k(y,r)}while(y.length>0){var u=y.pop();u.Destroy();u=null}y=null}var l=new SuperMap.IS.RequestManager(s,p,m,r);l.AddQueryString("map",o);l.AddQueryString("method",t);l.AddQueryStrings(j,q);l.Send();l.Destroy();l=null;while(j.length>0){j.pop();q.pop()}j=null;q=null};this.GetWorkspaceInfo=function(o,m,p){var i="GetWorkspaceInfo";var j=H.mapHandler+"common.ashx";var l=H.mapName;function n(s){if(!s){if(o){o(null,p)}return }var r=eval("("+s+")");if(!r){o(null,p);return }var q=new SuperMap.IS.Workspace();q.FromJSON(r);if(o){o(q,p)}q.Destroy();q=null}var k=new SuperMap.IS.RequestManager(j,n,m,p);k.AddQueryString("map",l);k.AddQueryString("method",i);k.Send();k.Destroy();k=null};this.GetDatasetInfo=function(i,m,k,n,q){var t="GetDatasetInfo";var j=["datasource","dataset"];var r=[i,m];var s=H.mapHandler+"common.ashx";var o=H.mapName;function p(w){if(!w){if(k){k(null,q)}return }var v=eval("("+w+")");if(!v){k(null,q);return }var u=new SuperMap.IS.Dataset();u.FromJSON(v);if(k){k(u,q)}u.Destroy();u=null}var l=new SuperMap.IS.RequestManager(s,p,n,q);l.AddQueryString("map",o);l.AddQueryString("method",t);l.AddQueryStrings(j,r);l.Send();l.Destroy();l=null;while(j.length>0){j.pop();r.pop()}j=null;r=null};this.ClearCache=function(n,j,k,m,p){var s="ClearCache";var i=["mapName","mapRect"];var q=[n,j];var r=H.mapHandler+"common.ashx";var n=H.mapName;function o(t){if(!t){if(k){k(null,p)}return }var u=eval("("+t+")");if(k){k(u,p)}}var l=new SuperMap.IS.RequestManager(r,o,m,p);l.AddQueryString("map",n);l.AddQueryString("method",s);l.AddQueryStrings(i,q);l.Send();l.Destroy();l=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.ConnectDatasources=function(o,m,p){var i="ConnectDatasources";var j=H.mapHandler+"common.ashx";var l=H.mapName;function n(q){if(!q){if(o){o(null,p)}return }var r=eval("("+q+")");if(o){o(r,p)}}var k=new SuperMap.IS.RequestManager(j,n,m,p);k.AddQueryString("map",l);k.AddQueryString("method",i);k.Send();k.Destroy();k=null};this.OpenDatasource=function(k,j,m,p){var s="OpenDatasource";var i=["datasourceParam"];var q=[k];var r=H.mapHandler+"common.ashx";var n=H.mapName;function o(t){if(!t){if(j){j(null,p)}return }var u=eval("("+t+")");if(j){j(u,p)}}var l=new SuperMap.IS.RequestManager(r,o,m,p);l.AddQueryString("map",n);l.AddQueryString("method",s);l.AddQueryStrings(i,q);l.Send();l.Destroy();l=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.CloseDatasource=function(m,j,l,p){var s="CloseDatasource";var i=["alias"];var q=[m];var r=H.mapHandler+"common.ashx";var n=H.mapName;function o(t){if(!t){if(j){j(null,p)}return }var u=eval("("+t+")");if(j){j(u,p)}}var k=new SuperMap.IS.RequestManager(r,o,l,p);k.AddQueryString("map",n);k.AddQueryString("method",s);k.AddQueryStrings(i,q);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.RefreshDatasource=function(o,m,p){var i="RefreshDatasource";var j=H.mapHandler+"common.ashx";var l=H.mapName;function n(q){if(!q){if(o){o(null,p)}return }var r=eval("("+q+")");if(o){o(r,p)}}var k=new SuperMap.IS.RequestManager(j,n,m,p);k.AddQueryString("map",l);k.AddQueryString("method",i);k.Send();k.Destroy();k=null};this.GetFieldInfo=function(l,t,j,m,p){var s="GetFieldInfo";var i=["dataset","fieldName"];var q=[l,t];var r=H.mapHandler+"common.ashx";var n=H.mapName;function o(w){if(!w){if(j){j(null,p)}return }var v=eval("("+w+")");if(!v){j(null,p);return }var u=new SuperMap.IS.GetFieldResult();u.FromJSON(v);if(j){j(u,p)}u.Destroy();u=null}var k=new SuperMap.IS.RequestManager(r,o,m,p);k.AddQueryString("map",n);k.AddQueryString("method",s);k.AddQueryStrings(i,q);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.MakeDefaultDotDensityTheme=function(m,r,u,j,l,q){var t="MakeDefaultDotDensityTheme";var i=["layerName","expression","colorSet"];var p=[m,r,u];var s=H.mapHandler+"common.ashx";var n=H.mapName;function o(x){if(!x){if(j){j(null,q)}return }var w=eval("("+x+")");if(!w){j(null,q);return }var v=new SuperMap.IS.DotDensityTheme();v.FromJSON(w);if(j){j(v,q)}v.Destroy();v=null}var k=new SuperMap.IS.RequestManager(s,o,l,q);k.AddQueryString("map",n);k.AddQueryString("method",t);k.AddQueryStrings(i,p);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();p.pop()}i=null;p=null};this.MakeDefaultGraduatedSymbolTheme=function(m,r,u,j,l,q){var t="MakeDefaultGraduatedSymbolTheme";var i=["layerName","expression","colorSet"];var p=[m,r,u];var s=H.mapHandler+"common.ashx";var n=H.mapName;function o(x){if(!x){if(j){j(null,q)}return }var w=eval("("+x+")");if(!w){j(null,q);return }var v=new SuperMap.IS.GraduatedSymbolTheme();v.FromJSON(w);if(j){j(v,q)}v.Destroy();v=null}var k=new SuperMap.IS.RequestManager(s,o,l,q);k.AddQueryString("map",n);k.AddQueryString("method",t);k.AddQueryStrings(i,p);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();p.pop()}i=null;p=null};this.MakeDefaultGraphTheme=function(n,m,u,j,l,r){var t="MakeDefaultGraphTheme";var i=["layerName","expressions","colorSet"];var q=[n,m,u];var s=H.mapHandler+"common.ashx";var o=H.mapName;function p(x){if(!x){if(j){j(null,r)}return }var w=eval("("+x+")");if(!w){j(null,r);return }var v=new SuperMap.IS.GraphTheme();v.FromJSON(w);if(j){j(v,r)}v.Destroy();v=null}var k=new SuperMap.IS.RequestManager(s,p,l,r);k.AddQueryString("map",o);k.AddQueryString("method",t);k.AddQueryStrings(i,q);k.Send();k.Destroy();k=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.MakeDefaultRangeTheme=function(n,s,j,v,k,m,r){var u="MakeDefaultRangeTheme";var i=["layerName","expression","breakCount","colorSet"];var q=[n,s,j,v];var t=H.mapHandler+"common.ashx";var o=H.mapName;function p(y){if(!y){if(k){k(null,r)}return }var x=eval("("+y+")");if(!x){k(null,r);return }var w=new SuperMap.IS.RangeTheme();w.FromJSON(x);if(k){k(w,r)}w.Destroy();w=null}var l=new SuperMap.IS.RequestManager(t,p,m,r);l.AddQueryString("map",o);l.AddQueryString("method",u);l.AddQueryStrings(i,q);l.Send();l.Destroy();l=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.MakeDefaultUniqueTheme=function(n,s,w,j,t,k,m,r){var v="MakeDefaultUniqueTheme";var i=["layerName","expression","expectCount","colorSet","startSmID"];var q=[n,s,t,w,j];var u=H.mapHandler+"common.ashx";var o=H.mapName;function p(z){if(!z){if(k){k(null,r)}return }var y=eval("("+z+")");if(!y){k(null,r);return }var x=new SuperMap.IS.UniqueTheme();x.FromJSON(y);if(k){k(x,r)}x.Destroy();x=null}var l=new SuperMap.IS.RequestManager(u,p,m,r);l.AddQueryString("map",o);l.AddQueryString("method",v);l.AddQueryStrings(i,q);l.Send();l.Destroy();l=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.MakeDefaultGridRangeTheme=function(n,j,u,k,m,r){var t="MakeDefaultGridRangeTheme";var i=["layerName","breakCount","colorSet"];var q=[n,j,u];var s=H.mapHandler+"common.ashx";var o=H.mapName;function p(x){if(!x){if(k){k(null,r)}return }var w=eval("("+x+")");if(!w){k(null,r);return }var v=new SuperMap.IS.GridRangeTheme();v.FromJSON(w);if(k){k(v,r)}v.Destroy();v=null}var l=new SuperMap.IS.RequestManager(s,p,m,r);l.AddQueryString("map",o);l.AddQueryString("method",t);l.AddQueryStrings(i,q);l.Send();l.Destroy();l=null;while(i.length>0){i.pop();q.pop()}i=null;q=null};this.GetMapBounds=function(){var i=new SuperMap.IS.MapRect();i.Copy(L);return i};this.GetMapStatus=function(l,n,m,k,o){var j=H.mapHandler+"common.ashx";var i=new SuperMap.IS.RequestManager(j,m,k,o);i.AddQueryString("map",H.mapName);i.AddQueryString("method","GetMapStatus");i.AddQueryString("tileSize",H.tileSize);i.AddQueryString("returnLayers",l);i.AddQueryString("returnThemes",n);if(H.customKeys){i.AddQueryStrings(H.customKeys,H.customValues)}if(H.timeout){i.SetTimeout(H.timeout)}i.Send();i.Destroy();i=null};this.GetDefaultMapStatus=function(m,r,l,q,j,k,n){var i=H.mapHandler+"common.ashx";function p(u){if(!u){if(j){j(null,n)}return }var s=eval("("+u+")");if(!s){j(null,n);return }var t=new SuperMap.IS.MapStatus();t.FromJSON(s);if(j){j(t,n)}t.Destroy();t=null}var o=new SuperMap.IS.RequestManager(i,p,k,n);o.AddQueryString("map",m);o.AddQueryString("method","GetMapStatus");o.AddQueryString("tileSize",r);o.AddQueryString("returnLayers",l);o.AddQueryString("returnThemes",q);o.Send();o.Destroy();o=null};function g(j){var i=document.getElementById(H.id+"_hiddenLayersKey");if(i){i.value=j}}function O(){var i=document.getElementById(H.id+"_hiddenHandlerLayers");if(i){i.value=_ToJSON(A)}}function h(){var j;var i=document.getElementById(H.id+"_hiddenLayersKey");if(i){j=i.value}if(!j){H.layersKey=0}else{H.layersKey=j}}function U(){var l;var k=document.getElementById(H.id+"_hiddenHandlerLayers");if(k){l=k.value}if(l){var m=eval(l);if(m){for(var j=0;j<m.length;j++){A[j]=new SuperMap.IS.Layer();A[j].FromJSON(m[j])}}}}function C(i,j){H.trackingLayerIndex=i;H.userID=j}function R(i,j,k){if(H.trackingLayerIndex!=i||H.userID!=j){H.trackingLayerIndex=i;H.userID=j;var l=new Object();l.trackingLayerIndex=H.trackingLayerIndex;l.userID=H.userID;l.bSaveHistory=k;B("onchangetrackinglayer",l)}}function G(l,m){if(Q==null){return }var k=Q[l];if(!k){k=new Array();Q[l]=k;a.push(l)}for(var j=0;j<k.length;j++){if(k[j]==m){return true}}k.push(m)}function E(l,m){if(Q==null){return }var k=Q[l];if(!k){return }for(var j=0;j<k.length;j++){if(k[j]==m){k.splice(j,1)}}}function B(m,n,o){if(Q==null){return }var l=Q[m];if(!l){return }if(!n){n=Y()}var j=l.concat();for(var k=0;k<j.length;k++){if(j[k]){j[k](n,o)}}while(j.length>0){j.pop()}}function Y(i,j){var k=new Object();k.trackingLayerIndex=H.trackingLayerIndex;k.userID=H.userID;if(!i){i=""}return new EventArguments(k,i,j)}this.AttachEvent=G;this.DetachEvent=E;this.ChangeTrackingLayerKey=C}
