//================================================================================ 
// SuperMap IS .NET 客户端程序，版权所有，北京超图软件股份有限公司，2000-2009。 
// 本程序只能在有效的授权许可下使用。未经许可，不得以任何手段擅自使用或传播。 
// 作 者:  SuperMap IS Web Team 
// 版 本:  $Id: SuperMap.IS.MapControl.js,v 1.293 2011/03/15 06:10:22 zhanghui2 Exp $
// 文 件:  SuperMap.IS.MapControl.js 
// 描 述:  AjaxScripts 地图控件 
// 更 新:  $Date: 2011/03/15 06:10:22 $  
//================================================================================ 
SuperMap.IS.MapControl=function(Aj,Db){var DQ=this;var ES=null,Dl=null,g=null,AD=null;var E9=null;var CW="";var El="png";var AX="/mapHandler/";var AQ="";var E8;Aj=_GetDomElement(Aj);var Dw=5,CZ=15,DV=15;if(_GetBrowser()!="ie"){Dw=3;CZ=45;DV=45}var Do=0;var Bz="images/spacer.gif";var A4=256;var Y=1,x=2;var DX=11,BR=20;var CL=true;var Ac=new SuperMap.IS.MapParam(),Bx=new SuperMap.IS.MapParam();var B=0,A=0,E=0,Q=0;var Eq=new Array();var En=new Array();var FA=new Array();var E2=new Array(),DR=null,t=new Array();var y=new Array(),DT=null,Er=new Array();var F=0,C=0;var Cv=0,Cu=0;var ET=new Array(),D8=new Array(),ER=new Array(),D7=new Array();var X=new Array(),U=new Array();var DO=false,Bo=false;var M=0,L=0;var D=false;var CS=0;var Ds=false;var E4=0;var A3=0,A2=0;var CK=null,CH=null;var A8=null;var CT=null,FH=null,C3=null;var CG=null;var N=null;var FI=null,D5=null,i=null;var a=new Array(),AA=new Array();var FE=new Array();var P=new Array();var BH=Aj.id+"_mapDiv";var Cx=document.createElement("div");Cx.id=BH;var Eb=Aj.id+"_trackingLayerDiv";var AY=document.createElement("div");AY.id=Eb;var DA=Aj.id+"_geometryLayerDiv";var BP=document.createElement("div");BP.id=DA;var BU=document.createElement("div");BU.id=Aj.id+"_workLayer";BU.style.textAlign="left";var Cd=document.createElement("input");Cd.id=Aj.id+"_kbInput";var A0=null;var Bn=new Array(),FK=new Array(),FQ=new Array(),Bw=new Array(),Cb=new Array();var o=new Array();var AU=64;var Cy=true;var S=false;var B9=false;var n=false;var AB=false;var BD=null;var Ep=null;var BF=null;var Cs=null;var Dp=null;var Ew=null;var Cc=0;var BN=new Array();var BY=new Array();var Dc=null;var DI=-1;var Aq="";var BV=new Array();var BE=new Array();var Dm=new Array();var Av=new Array();var Cz=null;var Em=5;var Ap=true;var CM="";var Cl=new Array();var Co=new Array();var EW=new Array();var AK=new Array();var CD=new Array();var CO=null,DM=null,Bf=null;var Eh=false;var C8=false;this.workLayer=BU;this.container=Aj;this.id=Aj.id;this.mapName="";this.layers=new Array();var I=new Date().getTime();var BL=new Array();var DN=new Array();this.mapDiv=null;var Dv=0;var G=10;var EH=false;var Ey=new Array();var CV=false;var FM=0;var j=false;var s=navigator.userAgent.toLowerCase();if(s.indexOf("msie 6.0")!=-1){CV=true}var Dy=false;var Ex;var ED=false;this.wheelZoomByMouse=false;this.imageFormat;this.tileSize;this.customBounds=new SuperMap.IS.MapRect();var CR=null;this.storeClientInfo=false;var DL=0.5;var EM=new Array();var Eu=new Array();var DH=new Array();var Ae=64;var AJ;var Ai;var Ce;var DP=1;var Bj=Db.mapHandler;var CJ=true;var BC=_isMobile();if(Db.handlerSecurityFunction){SuperMap.IS.RequestManager.prototype.AddHandlerSecurityQueryString=Db.handlerSecurityFunction}this.Init=function(){window.curMapControl=DQ;if(Db.mapScales&&Db.mapScales.length>0){E9=Db.mapScales}if(Db.allMapScales){Dc=Db.allMapScales}if(!Db.imageFormat){Db.imageFormat=El}if(DQ.imageFormat){Db.imageFormat=DQ.imageFormat;El=DQ.imageFormat}if(Bj){if(typeof (Bj)=="object"){AX=Bj[Db.mapName];Db.mapHandler=AX}else{AX=Bj}}else{Db.mapHandler=AX}if(Db.mapName){DQ.mapName=CW=Db.mapName}else{Db.mapName=""}if(Db.mapScale){AQ=Db.mapScale}else{Db.mapScale=""}if(Db.useImageBuffer){Cy=Db.useImageBuffer}else{Db.useImageBuffer=Cy}if(Db.tileSize){A4=Db.tileSize}else{Db.tileSize=A4}if(DQ.tileSize){Db.tileSize=DQ.tileSize;A4=DQ.tileSize}if(!Db.layersKey){Db.layersKey=0}if(typeof (Db.trackingLayerIndex)!="undefined"){DI=Db.trackingLayerIndex}else{Db.trackingLayerIndex=DI}if(Db.userID){Aq=Db.userID}else{Db.userID=Aq}if(Db.zoomLevel){if(Db.zoomLevel>0&&E9&&Db.zoomLevel<=E9.length){Db.mapScale=E9[Db.zoomLevel-1]}}if(Db.customQueryString){var FT=Db.customQueryString.split("&");if(FT){if(!Db.customKeys){Db.customKeys=new Array()}if(!Db.customValues){Db.customValues=new Array()}for(var FR=0;FR<FT.length;FR++){var FS=FT[FR].split("=");if(FS&&FS.length==2){Db.customKeys.push(FS[0]);Db.customValues.push(FS[1])}}}}if(Db.fixPngTransparentForIe6){ED=Db.fixPngTransparentForIe6}else{Db.fixPngTransparentForIe6=ED}if(Db.wheelZoomByMouse){DQ.wheelZoomByMouse=Db.wheelZoomByMouse}if(Db.tileCheckTime){G=Db.tileCheckTime*1000/200}if(Db&&typeof (Db.switchMapMode)!="undefined"){FM=Db.switchMapMode}if(typeof (Db.storeClientInfo)!="undefined"&&Db.storeClientInfo){DQ.storeClientInfo=Db.storeClientInfo}if(Db.markBuffer!=null&&!isNaN(Db.markBuffer)){DL=Db.markBuffer}if(Db.gridSize!=null&&!isNaN(Db.gridSize)){Ae=Db.gridSize}if(Db.maxFilterScale!=null&&!isNaN(Db.maxFilterScale)){DP=Db.maxFilterScale}if(Db.keepHighlight!=null){CJ=Db.keepHighlight}else{Db.keepHighlight=CJ}Db.id=Aj.id;CG=new SuperMap.IS.Map(Db);CG.Init(BZ,AE)};function AE(FR){Dq("onerror",FR);return false}function BZ(FV){var FT;if(N!=null&&N.mapName!=CG.mapName){FT=N.mapName}if(N){N.Destroy();N=null}N=CG;if(Db&&typeof (Db.customBounds)!="undefined"){CR=Db.customBounds[N.mapName];DQ.customBounds.Copy(CR)}N.AttachEvent("onchangetrackinglayer",C9);N.AttachEvent("onchangelayer",DY);if(Db.useSimpleCache){Dg(BH,Ak,Af,null,0,0,0,1,1,A4,A4,FV.referBounds,Cy)}else{Dg(BH,Ak,CQ,null,0,0,0,1,1,A4,A4,FV.referBounds,Cy)}Dg(Eb,BM,Al,null,0,0,0,1,2,A4,A4,null,false);Dg(DA,CE,DK,null,0,0,0,1,3,A4,A4,FV.referBounds,false);A1();DQ.mapDiv=DN[BH].container;var FR=true;if(FV){if(Eh){Db.mapBounds=FV.mapBounds;switch(FM){case 0:if(Db.x==null||Db.y==null){Db.x=FV.mapBounds.Center().x;Db.y=FV.mapBounds.Center().y}break;case 1:default:break}}DQ.mapName=FV.mapName;if(FV.mapNames&&FV.mapNames.length>0){if(DQ.mapNames==null){DQ.mapNames=new Array()}for(var FU=0;FU<FV.mapNames.length;FU++){DQ.mapNames[FU]=FV.mapNames[FU]}}if(!Db.layers||Db.layers.length==0){Db.layers=FV.layers}if(FV.mapBounds){if(AD==null){AD=new SuperMap.IS.MapRect()}AD.Copy(FV.mapBounds)}FR=false}if(FR){Dq("onerror",new EventArguments(null,SuperMap.IS.MapControlResource.mapInitError));return false}function FS(){if(!Eh){_BackupLayers(BN,N.layers)}DQ.layers=N.layers}if(!Db.layers||Db.layers.length==0){CG.GetMapStatus(true,true,function(Fa){var FW=eval("("+Fa+")");if(!FW){return }var FY=new SuperMap.IS.MapStatus();FY.FromJSON(FW);if(FY.layers){var FZ=FY.layers.length;if(N.layers==null){N.layers=new Array()}for(var FX=0;FX<FZ;FX++){if(N.layers[FX]==null){N.layers[FX]=new SuperMap.IS.Layer()}N.layers[FX].Copy(FY.layers[FX])}Db.layers=N.layers}FS();var Fb=_FindDifference(BN,N.layers);CA(Fb);B9=true;if(n){Dq("oninit",null)}if(FT&&FT!=N.mapName){Dq("onendswitchmap")}FY.Destroy();FY=null},function(FW){Dq("onerror",FW);return false})}else{N.layers=Db.layers;FS();B9=true}if(document.readyState=="complete"){Dy=_EnableVML()}else{document.onreadystatechange=function(){if(document.readyState=="complete"){Dy=_EnableVML();document.onreadystatechange=null}}}BS(null,false,false,EA);if(B9){if(FT&&FT!=N.mapName){Dq("onendswitchmap")}}}function EA(){BU.style.width="100%";BU.style.height="100%";BU.style.overflow="hidden";BU.style.border="0px";BU.style.padding="0px";BU.style.margin="0px";BU.style.position="relative";Aj.appendChild(BU);Bi();if(E<100){Aj.style.width="100px";BU.style.width="100%"}if(Q<100){Aj.style.height="100px";BU.style.height="100%"}Aj.style.overflow="hidden";Bi();BU.style.width=E+"px";BU.style.height=Q+"px";Bi();FJ();Cd.value="";Cd.readOnly=true;var FT=Cd.style;FT.position="absolute";FT.top=Q/2+"px";FT.left=E/2+"px";if(_GetBrowser()=="ie"||_GetBrowser()=="gecko"||BC){FT.width="0px";FT.height="0px"}FT.padding="0px";FT.margin="0px";FT.border="0px solid white";FT.zIndex=-1;FT=null;BU.appendChild(Cd);if(!Db.fixedView){CT=new SuperMap.IS.ZoomInAction();CT.Init(DQ);FH=new SuperMap.IS.PanAction();FH.Init(DQ);C3=FH;if(!Eh){Aj.attachEvent("onmousedown",BA);Aj.attachEvent("onmouseup",f);Aj.attachEvent("onmousemove",Da);Aj.attachEvent("ondblclick",De);Aj.attachEvent("onclick",DG);if(!BC){Aj.attachEvent("onmousewheel",Bc);Aj.attachEvent("oncontextmenu",E3);Cd.attachEvent("onkeydown",BX);Cd.attachEvent("onkeyup",CP)}else{_AddEvent(Aj,"touchstart",E1);_AddEvent(Aj,"touchmove",Z);_AddEvent(Aj,"touchend",Bs)}}Eh=false;Do=A4}if(Db.buffer!=undefined&&Db.buffer!=null){Do=Db.buffer}if(Db.x!=null&&Db.y!=null&&Db.mapScale){try{var FR=new SuperMap.IS.MapParam(CW,AQ,E9);FR.SetMapScale(eval(Db.mapScale));FR.SetMapCenter(new SuperMap.IS.MapCoord(Db.x,Db.y));if(C8){switch(FM){case 0:if(Ey[CW]&&j==false){FR.SetMapScale(eval(Ey[CW].mapScale));FR.SetMapCenter(new SuperMap.IS.MapCoord(Ey[CW].mapCenter.x,Ey[CW].mapCenter.y))}break;default:break}}AV(FR)}catch(FS){Be()}}else{Be()}if(!Db.disableLogo){A8=new DU(BU);A8.Init()}Ex=Dk();Dt();Bq();FO();Dd();AW();z();n=true;j=false;if(B9){Dq("oninit",null)}}this.Destroy=function(){Dq("ondestroying",null);A9();window.curMapControl=null;B9=false;n=false;Ey=null;if(!Db.fixedView){Aj.detachEvent("onmousedown",BA);Aj.detachEvent("onmouseup",f);Aj.detachEvent("onmousemove",Da);Aj.detachEvent("onmousewheel",Bc);Aj.detachEvent("ondblclick",De);Aj.detachEvent("oncontextmenu",E3);Aj.detachEvent("onclick",DG);Cd.detachEvent("onkeydown",BX);Cd.detachEvent("onkeyup",CP)}while(Eq.length>0){var FS=Eq.pop();while(FS.length>0){var FU=FS.pop();if(FU!=null){FU.RemoveFromMap();FU=null}}FS=null}Eq=null;while(FA.length>0){var FR=FA.pop();while(FR.length>0){var FV=FR.pop();if(FV!=null){FV.RemoveFromMap();FV=null}}FR=null}FA=null;if(A8){A8.Destroy();A8=null}if(CG){CG.Destroy();CG=null}if(CT){CT.Destroy();CT=null}if(FH){FH.Destroy();FH=null}if(C3){C3.Destroy();C3=null}Ax();Bn=null;D6();FK=null;Ct();FQ=null;K();Bw=null;AR();Cb=null;AM();BV=null;Av=null;BE=null;Dm=null;Co=null;EW=null;AK=null;CD=null;Cz=null;Eo(true);BL=null;DN=null;o=null;EE();if(A0&&A0.parentNode){A0.parentNode.removeChild(A0)}DQ.workLayer=null;DQ.container=null;Cd=A0=BU=Aj=DQ=null;if(Db.layers){while(Db.layers.length>0){var FT=Db.layers.pop();FT.Destroy();FT=null}Db.layers=null}if(this.layers){while(this.layers.length>0){var FT=this.layers.pop();FT.Destroy();FT=null}this.layers=null}Db=null};function BS(FT,FU,Fj,Fi,FW,FS){var FV=FU;var Fd=Fj;if(DQ.mapName!=N.mapName||(DQ.imageFormat!=""&&DQ.imageFormat!=null&&DQ.imageFormat!=El)||(DQ.tileSize!=null&&DQ.tileSize!=A4)){if(C8){return }B9=false;n=false;C8=true;if(Ey[N.mapName]==null){Ey[N.mapName]=new Object()}Db.mapName=DQ.mapName;Db.x=null;Db.y=null;Db.mapScale=null;if(Db.mapScales){while(Db.mapScales.length>0){var Fe=Db.mapScales.pop();Fe=null}Db.mapScales=null}if(Db.layers){while(Db.layers.length>0){var Fk=Db.layers.pop();Fk.Destroy();Fk=null}Db.layers=null}Db.zoomLevel=null;var Fb=B7();switch(FM){case 0:Ey[N.mapName].mapCenter=new SuperMap.IS.MapCoord();Ey[N.mapName].mapCenter.x=Fb.mapCenter.x;Ey[N.mapName].mapCenter.y=Fb.mapCenter.y;Ey[N.mapName].mapScale=Fb.mapScale;break;case 1:Db.x=Fb.mapCenter.x;Db.y=Fb.mapCenter.y;Db.mapScale=Fb.mapScale;break;default:break}if(FT){if(FT.mapName){Db.mapName=FT.mapName}if(FT.center){Db.x=FT.center.x;Db.y=FT.center.y}if(FT.mapScale){Db.mapScale=FT.mapScale}j=true}Fb.Destroy();Fb=null;Dq("onstartswitchmap",new EventArguments(Db,""));while(E9&&E9.length>0){var Fc=E9.pop();Fc=null}if(Dc&&Dc[DQ.mapName]){var FZ=Dc[DQ.mapName].split(",");if(!E9){E9=new Array()}for(var Fg=0;Fg<FZ.length;Fg++){E9.push(1/parseFloat(FZ[Fg]))}while(FZ.length>0){var FX=FZ.pop();FX=null}FZ=null}function Fa(){if(Fi){Fi(Db.layersKey,FS)}DF("oninit",Fa)}var Ff=document.getElementById(Aj.id+"_hiddenLayersKey");if(Ff){Ff.value=""}try{Db.trackingLayerIndex=-1;EI("oninit",Fa);A7()}catch(Fh){if(FW){FW(Fh.message,FS)}return }return }else{var FY=_FindDifference(BN,N.layers);CA(FY);function FR(Fp,Fo){if(Db.layersKey!=Fp||FV){while(o.length>0){var Fm=o.pop();while(Fm&&Fm.length>0){var Fn=Fm[0];delete Fm[Fn];Fm.shift()}}}Db.layersKey=Fp;if(FV){if(Fd){N.UpdateMapStatus(Fl);function Fl(Fr){for(var Fq=0;Fq<BL.length;Fq++){var Ft=DN[BL[Fq]].layerBounds=N.GetMapBounds()}var Fs=new SuperMap.IS.MapParam();Fs.Copy(Ac);Fs.Resolve(N,E,Q);N.ValidateMapScale(Fs);FI=N.GetBounds();A6(Fs,FI);Fs.Resolve(N,E,Q);Ac.Destroy();Ac=Fs;Ck();if(Fi){Fi(Fp,Fo)}}}else{Ck();if(Fi){Fi(Fp,Fo)}}}else{if(Fi){Fi(Fp,Fo)}}_BackupLayers(N.layersBackupForHandler,N.layers);C8=false}N.Update(FR,FW,FS)}}this.Update=function(FS,FR,FT){BS(null,true,false,FS,FR,FT)};this.UpdateByServerMapStatus=function(FS,FR,FT){BS(null,true,true,FS,FR,FT)};this.SwitchMap=function(FS,FT,FR,FU){if(FS&&FS.mapName){DQ.mapName=FS.mapName}BS(FS,true,false,FT,FR,FU)};function A9(){if(BD){window.clearTimeout(BD);BD=null}if(Ep){window.clearTimeout(Ep);Ep=null}if(BF){window.clearTimeout(BF);BF=null}if(Cs){window.clearTimeout(Cs);Cs=null}if(Dp){window.clearTimeout(Dp);Dp=null}if(Ew){window.clearTimeout(Ew);Ew=null}}function Bi(){B=_GetElementX(BU);A=_GetElementY(BU);E=BU.offsetWidth;Q=BU.offsetHeight}function Be(){var FR=new SuperMap.IS.MapParam(CW,AQ,E9);FR.SetMapCenter(new SuperMap.IS.MapCoord(0,0));FR.SetMapScale(1);AV(FR)}function r(){return Ac.center.x}function p(){return Ac.center.y}function As(){return Ac.pixelCenter.x}function Ar(){return Ac.pixelCenter.y}function EG(FR){Ac.center=N.PixelToMapCoord(Ac.pixelCenter,Ac.mapScale);if(FR){Bx.Copy(Ac)}}function B2(){return Ac.mapScale}function DS(){return Ac.zoomLevel}function BI(FS){var FR=N.MapCoordToPixel(FS,Ac.mapScale);FR.x-=F+Cv;FR.y-=C+Cu;return FR}function R(FR){var FS=new SuperMap.IS.PixelCoord(FR.x+F+Cv,FR.y+C+Cu);var FT=N.PixelToMapCoord(FS,Ac.mapScale);return FT}function Ez(FR,FS,FT){return N.PixelToMapDistance(FR,FS,FT)}function CX(FR,FS,FT){return N.MapDistanceToPixel(FR,FS,FT)}function CN(){return new SuperMap.IS.PixelRect(0,0,E,Q)}function C4(FS,FR){if((!FS||FS<=0)&&(!FR||FR<=0)){return }if(FS&&FS>0){E=FS}if(FR&&FR>0){Q=FR}Aj.style.width=E+"px";Aj.style.height=Q+"px";BU.style.width=E+"px";BU.style.height=Q+"px";Bi();v(Ac);if(A8){A8.Reposition()}Dj();Dq("onresize")}function AG(FR){CL=FR}function EV(){return CL}function CY(FR){S=FR;for(var FS=0;FS<E2.length;FS++){E2[FS].Debug(FR)}}function A6(FS,FR){if(CR!=null){Bv(FS,FR,0,0)}else{CB(FS,FR,0,0)}}function CB(FX,FV,FS,FR){var FT=N.PixelToMapCoord(new SuperMap.IS.PixelCoord(FS+FX.pixelCenter.x,FR+FX.pixelCenter.y),FX.mapScale);if(S){window.status="oldX:"+FT.x}var FW=false;if(FV==null){return }if(FT.x<FV.leftBottom.x){FT.x=FV.leftBottom.x;FW=true}if(FT.y<FV.leftBottom.y){FT.y=FV.leftBottom.y;FW=true}if(FT.x>FV.rightTop.x){FT.x=FV.rightTop.x;FW=true}if(FT.y>FV.rightTop.y){FT.y=FV.rightTop.y;FW=true}if(FW){var FU=N.MapCoordToPixel(FT,FX.mapScale);FX.SetPixelCenter(FU)}else{FX.SetPixelCenter(new SuperMap.IS.PixelCoord(FX.pixelCenter.x+FS,FX.pixelCenter.y+FR))}FX.SetMapCenter(FT);if(S){window.status+="newX:"+FT.x}return }function Bv(FR,Fc,FX,FV){var FU=false;var FS=N.PixelToMapCoord(new SuperMap.IS.PixelCoord(FX+FR.pixelCenter.x,FV+FR.pixelCenter.y),FR.mapScale);if(S){window.status="oldX:"+FS.x}var FY=Ez(DQ.container.style.pixelHeight,FR.mapScale);var FZ=Ez(DQ.container.style.pixelWidth,FR.mapScale);var FT=new SuperMap.IS.MapRect(FS.x-FZ/2,FS.y-FY/2,FS.x+FZ/2,FS.y+FY/2);if(FT.Width()>Fc.Width()||FT.Height()>Fc.Height()){var FW=C2(FS,FR,Fc);FR.SetMapScale(FW);FY=Ez(DQ.container.style.pixelHeight,FR.mapScale);FZ=Ez(DQ.container.style.pixelWidth,FR.mapScale);FT=new SuperMap.IS.MapRect(FS.x-FZ/2,FS.y-FY/2,FS.x+FZ/2,FS.y+FY/2);Dq("onchangeview")}if(FT.leftBottom.x<Fc.leftBottom.x){var Fd=Fc.leftBottom.x-FT.leftBottom.x;FT.leftBottom.x+=Fd;FT.rightTop.x+=Fd}if(FT.rightTop.x>Fc.rightTop.x){var Fd=Fc.rightTop.x-FT.rightTop.x;FT.leftBottom.x+=Fd;FT.rightTop.x+=Fd}if(FT.rightTop.y>Fc.rightTop.y){var Fb=Fc.rightTop.y-FT.rightTop.y;FT.leftBottom.y+=Fb;FT.rightTop.y+=Fb}if(FT.leftBottom.y<Fc.leftBottom.y){var Fb=Fc.leftBottom.y-FT.leftBottom.y;FT.leftBottom.y+=Fb;FT.rightTop.y+=Fb}FS.x=FT.leftBottom.x+FT.Width()/2;FS.y=FT.leftBottom.y+FT.Height()/2;var Fa=N.MapCoordToPixel(FS,FR.mapScale);FR.SetPixelCenter(Fa);FR.SetMapCenter(FS);if(S){window.status+="newX:"+FS.x}}function DJ(FU,FT){var FS=FU.mapScales[0];for(var FR=0;FR<FU.mapScales.length;FR++){if(FT==FU.mapScales[FR]){return FT}if(FT>FU.mapScales[FR]){FS=_Min(FU.mapScales[FR],FS)}}return FS}function C2(Fb,FV,FR){var FW;var FT=DQ.container.style.pixelWidth;var Fg=DQ.container.style.pixelHeight;var FZ=N.PixelToMapDistance(FT,FV.mapScale);var Fe=N.PixelToMapDistance(Fg,FV.mapScale);var FU=FR.Width();var Ff=FR.Height();if(FV.mapScales==null||FV.mapScales.length<=0){var FY=0;var Fd=0;var FS=0;if(FT<Fg){FY=Fe;Fd=Ff;FS=Fg}else{FY=FZ;Fd=FU;FS=FT}FW=N.ComputeMapScaleByDistance(FY,Fd,FS);if(FV.mapScale>FW){FW=FV.mapScale}}else{for(var FX=0;FX<FV.mapScales.length;FX++){if(FV.mapScales[FX]>FV.mapScale){var Fa=Ez(DQ.container.style.pixelHeight,FV.mapScales[FX]);var Fc=Ez(DQ.container.style.pixelWidth,FV.mapScales[FX]);if(Fc<FR.Width()&&Fa<FR.Height()){FW=FV.mapScales[FX];break}}}}return FW}function EU(FV,FS,FR,FT){var FU=Ac.MakeCopy();if(FV){FU.center=FV}if(FS){FU.mapScale=FS}if(!FR){FR=""}return new EventArguments(FU,FR,FT)}function EI(FT,FU){var FS=a[FT];if(!FS){FS=new Array();a[FT]=FS;AA.push(FT)}for(var FR=0;FR<FS.length;FR++){if(FS[FR]==FU){return true}}FS.push(FU)}function DF(FT,FU){var FS=a[FT];if(!FS){return }for(var FR=0;FR<FS.length;FR++){if(FS[FR]==FU){FS.splice(FR,1)}}}function Dq(FU,FV,FW){var FT=a[FU];if(!FT){return }if(!FV){FV=EU()}var FR=FT.concat();for(var FS=0;FS<FR.length;FS++){if(FR[FS]){FR[FS](FV,FW)}}while(FR.length>0){FR.pop()}}function EE(){while(AA.length){var FR=a[AA.pop()];if(FR){while(FR.length){FR.pop()}FR=null}}a=null;AA=null}function Es(FR,FT){var FS=FE[FR];if(!FS){FE[FR]=new Array()}FE[FR].push(FT)}function Ei(FR,FU){var FT=FE[FR];if(!FT){return }for(var FS=0;FS<FT.length;FS++){if(FT[FS]==FU){FT.splice(FS,1)}}}function E6(FY,FX){var FS=new Array();var Fa=false;switch(FX){case"ondblclick":var Fb=FE["ondblclick"];if(Fb&&Fb.length>0){Fa=true;FS.push("ondblclick")}break;case"onclick":var Fb=FE["onclick"];if(Fb&&Fb.length>0){Fa=true;FS.push("onclick")}break;case"onmousemove":var Fb;Fb=FE["onmouseover"];if(Fb&&Fb.length>0){Fa=true;FS.push("onmouseover")}Fb=FE["onmouseout"];if(Fb&&Fb.length>0){Fa=true;FS.push("onmouseout")}break;case"onmousewheel":var Fb=FE["onmousewheel"];if(Fb&&Fb.length>0){Fa=true;FS.push("onmousewheel")}break;case"oncontextmenu":var Fb=FE["oncontextmenu"];if(Fb&&Fb.length>0){Fa=true;FS.push("oncontextmenu")}break;case"onmousedown":var Fb=FE["onmousedown"];if(Fb&&Fb.length>0){Fa=true;FS.push("onmousedown")}break;case"onmouseup":var Fb=FE["onmouseup"];if(Fb&&Fb.length>0){Fa=true;FS.push("onmouseup")}break;default:return }if(!Fa){return }var FR=new Array();var FU=new Array();FR=Cw(FY);for(var FW=0;FW<FS.length;FW++){switch(FS[FW]){case"ondblclick":if(FR&&FR.length>0){for(var FV=0;FV<FR.length;FV++){var Fb=FE["ondblclick"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=FR[FV];Fb[FT](FY)}}}}break;case"onclick":if(FR&&FR.length>0){for(var FV=0;FV<FR.length;FV++){var Fb=FE["onclick"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=FR[FV];Fb[FT](FY)}}}}break;case"onmouseover":if(FR.length==0){}else{for(var FV=0;FV<FR.length;FV++){var FZ=false;for(var FT=0;FT<P.length;FT++){if(FR[FV]==P[FT]){FZ=true;break}}if(!FZ){var Fb=FE["onmouseover"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=FR[FV];Fb[FT](FY)}}}}}break;case"onmouseout":if(P.length==0){}else{for(var FV=0;FV<P.length;FV++){var FZ=false;for(var FT=0;FT<FR.length;FT++){if(P[FV]==FR[FT]){FZ=true;break}}if(!FZ){var Fb=FE["onmouseout"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=P[FV];Fb[FT](FY)}}}}}break;case"onmousewheel":if(FR&&FR.length>0){for(var FV=0;FV<FR.length;FV++){var Fb=FE["onmousewheel"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=FR[FV];Fb[FT](FY)}}}}break;case"oncontextmenu":if(FR&&FR.length>0){for(var FV=0;FV<FR.length;FV++){var Fb=FE["oncontextmenu"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=FR[FV];Fb[FT](FY)}}}}break;case"onmousedown":if(FR&&FR.length>0){for(var FV=0;FV<FR.length;FV++){var Fb=FE["onmousedown"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=FR[FV];Fb[FT](FY)}}}}break;case"onmouseup":if(FR&&FR.length>0){for(var FV=0;FV<FR.length;FV++){var Fb=FE["onmouseup"];if(!Fb){break}for(var FT=0;FT<Fb.length;FT++){if(Fb[FT]!=null){FY.id=FR[FV];Fb[FT](FY)}}}}break;default:return }}P=FR}function Cw(Fi){var Fa=new Array();FC(Fi);var Ff=Ez(Em,Ac.mapScale);for(var Fe=0;Fe<Bn.length;Fe++){var FS=Math.sqrt(Math.pow(Bn[Fe].x-Fi.mapCoord.x,2)+Math.pow(Bn[Fe].y-Fi.mapCoord.y,2));if(FS<=Ff){Fa.push(Bn[Fe].id)}}for(var Fe=0;Fe<FK.length;Fe++){if(FK[Fe]){for(var Fd=0;Fd<FK[Fe].xs.length-1;Fd++){var Fl=new SuperMap.IS.MapCoord();Fl.x=FK[Fe].xs[Fd];Fl.y=FK[Fe].ys[Fd];var Fg=BI(Fl);Fl.x=FK[Fe].xs[Fd+1];Fl.y=FK[Fe].ys[Fd+1];var Fc=BI(Fl);Fl=null;var FS=DistPtToLine(Fg,Fc,Fi.offsetCoord);if(FS<=Em){Fa.push(FK[Fe].id);break}}}}for(var Fe=0;Fe<FQ.length;Fe++){var FZ=FQ[Fe];var Fb=new Array();var Fl=new SuperMap.IS.MapCoord();for(var Fd=0;Fd<FZ.xs.length;Fd++){Fl.x=FZ.xs[Fd];Fl.y=FZ.ys[Fd];var FR=BI(Fl);Fb.push(FR)}Fl=null;FZ.feature=SuperMap.IS.FeatureType.polygon;FZ.points=Fb;if(IsPointInPolygon(Fi.offsetCoord,FZ)){delete FZ.feature;delete FZ.points;Fa.push(FZ.id)}else{for(var Fd=0;Fd<FZ.xs.length-1;Fd++){var Fl=new SuperMap.IS.MapCoord();var Fg=new SuperMap.IS.PixelCoord();var Fc=new SuperMap.IS.PixelCoord();Fl.x=FZ.xs[Fd];Fl.y=FZ.ys[Fd];var Fg=BI(Fl);Fl.x=FZ.xs[Fd+1];Fl.y=FZ.ys[Fd+1];var Fc=BI(Fl);Fl=null;var FS=DistPtToLine(Fg,Fc,Fi.offsetCoord);if(FS>0&&FS<=Em){Fa.push(FZ.id);break}}var Fl=new SuperMap.IS.MapCoord();var Fg=new SuperMap.IS.PixelCoord();var Fc=new SuperMap.IS.PixelCoord();Fl.x=FZ.xs[FZ.xs.length-1];Fl.y=FZ.ys[FZ.ys.length-1];var Fg=BI(Fl);Fl.x=FZ.xs[0];Fl.y=FZ.ys[0];var Fc=BI(Fl);Fl=null;var FS=DistPtToLine(Fg,Fc,Fi.offsetCoord);if(FS>0&&FS<=Em){Fa.push(FZ.id);break}}delete FZ.feature;delete FZ.points}for(var Fe=0;Fe<Bw.length;Fe++){var Fj=BI(Bw[Fe].center);var FW=new SuperMap.IS.PixelCoord();var FV=new SuperMap.IS.PixelCoord();FW.x=Fj.x-Bw[Fe].semiMajorAxis;FW.y=Fj.y-Bw[Fe].semiMinorAxis;FV.x=Fj.x+Bw[Fe].semiMajorAxis;FV.y=Fj.y+Bw[Fe].semiMinorAxis;var FY=(FV.x-FW.x)/2;var FX=(FV.y-FW.y)/2;if(Math.pow(Fi.offsetCoord.x-Fj.x,2)+Math.pow(Fi.offsetCoord.y-Fj.y,2)*Math.pow(FY/FX,2)<=FY*FY){Fa.push(Bw[Fe].id)}}for(var Fe=0;Fe<Cb.length;Fe++){var FU=Cb[Fe];var Fj=BI(FU.center);var FT=Math.atan(-(Fi.offsetCoord.y-Fj.y)/(Fi.offsetCoord.x-Fj.x));var Fh=Math.atan(FU.semiMajorAxis*Math.tan(FT)/FU.semiMinorAxis)*180/Math.PI;if(Fi.offsetCoord.x<Fj.x){Fh=Fh+180}else{if(Fi.offsetCoord.x>Fj.x&&Fi.offsetCoord.y>Fj.y){Fh=Fh+360}}if(Fh<FU.startAngle||Fh>FU.endAngle){continue}var FW=new SuperMap.IS.PixelCoord();var FV=new SuperMap.IS.PixelCoord();FW.x=Fj.x-FU.semiMajorAxis;FW.y=Fj.y-FU.semiMinorAxis;FV.x=Fj.x+FU.semiMajorAxis;FV.y=Fj.y+FU.semiMinorAxis;var FY=(FV.x-FW.x)/2;var FX=(FV.y-FW.y)/2;var Fk=Math.sqrt(Math.pow(Fi.offsetCoord.x-Fj.x,2)*Math.pow(FX,2)+Math.pow(Fi.offsetCoord.y-Fj.y,2)*Math.pow(FY,2));if(Fk<=Math.sqrt(Math.pow(FY,2)*Math.pow(FX,2))+200&&Fk>=Math.sqrt(Math.pow(FY,2)*Math.pow(FX,2))-200){Fa.push(FU.id)}}return Fa}function BX(FT){FT=_GetEvent(FT);var FS=CZ;var FR=A3,FU=A2;switch(FT.keyCode){case 9:if(Ds&&Bo){k()}return true;case 37:FR=-FS;break;case 38:FU=-FS;break;case 39:FR=FS;break;case 40:FU=FS;break;case 107:case 187:case 61:case 43:FR=0;FU=0;AF();break;case 109:case 189:case 45:FR=0;FU=0;O();break;default:FT=_GetEvent(FT);_CancelBubble(FT);FC(FT);if(C3&&C3.OnKeyDown&&!EH){C3.OnKeyDown(FT)}return false}if(FR||FU){C5(FR,FU,null,true)}if(S){window.status="e.keyCode:"+FT.keyCode}return false}function CP(FS){FS=_GetEvent(FS);var FR=A3;var FT=A2;switch(FS.keyCode){case 37:FR=0;break;case 38:FT=0;break;case 39:FR=0;break;case 40:FT=0;break;default:FS=_GetEvent(FS);_CancelBubble(FS);FC(FS);if(C3&&C3.OnKeyUp&&!EH){C3.OnKeyUp(FS)}return false}C5(FR,FT,null,true);return false}function DU(FT){var FS=null;this.Init=function(){if(navigator.userAgent.toLowerCase().indexOf("msie")!=-1){FS=document.createElement("div");FS.id="logoSuperMap";FS.className="logoSuperMap logoSuperMap_IE";FS.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+_scriptLocation+"../images/supermapisnet.png', sizingMethod='scale')"}else{FS=document.createElement("img");FS.src=_scriptLocation+"../images/supermapisnet.png";FS.className="logoSuperMap";FS.onmousedown=function(FV){return false};FS.onselectstart=function(FV){return false};FS.ondrag=function(FV){return false};FS.ondragend=function(FV){return false};if(_ygPos.browser.indexOf("ie")==-1){FS.style.MozUserSelect="none"}}FU();FT.appendChild(FS)};this.Destroy=function(){BU.removeChild(FS);FS=null};function FU(){var FV=FS.style.pixelHeight;if(!FV){FV=30}FS.style.top=(Q-FV-3)+"px";FS.style.left="6px";FS.style.display="block"}function FR(){FU()}this.Reposition=FU;this.Update=FR}function FC(FR){FR.pixelCoord=new SuperMap.IS.PixelCoord(F+Cv+_GetMouseX(FR)-B,C+Cu+_GetMouseY(FR)-A);FR.mapCoord=N.PixelToMapCoord(FR.pixelCoord,Ac.mapScale);FR.offsetCoord=new SuperMap.IS.PixelCoord(FR.pixelCoord.x-F,FR.pixelCoord.y-C);FR.panOffset=new SuperMap.IS.PixelCoord(Cv,Cu);if(S){window.status="e.pixelCoord:"+FR.pixelCoord.x+","+FR.pixelCoord.y}}function BA(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);E6(FR,"onmousedown");if(C3&&C3.OnMouseDown&&!EH){C3.OnMouseDown(FR)}return false}function Da(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);E6(FR,"onmousemove");FR.cancelTriggerGeometryEvent=false;if(C3&&C3.OnMouseMove&&!EH){C3.OnMouseMove(FR)}Aw(FR,"ongeometrymousemove");return false}function f(FS){FS=_GetEvent(FS);_CancelBubble(FS);FC(FS);E6(FS,"onmouseup");if(C3&&C3.OnMouseUp&&!EH){C3.OnMouseUp(FS)}try{Cd.focus()}catch(FR){}return false}function DG(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);E6(FR,"onclick");FR.cancelTriggerGeometryEvent=false;if(C3&&C3.OnClick&&!EH){C3.OnClick(FR)}Aw(FR,"ongeometryclick")}function De(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);E6(FR,"ondblclick");FR.cancelTriggerGeometryEvent=false;if(C3&&C3.OnDblClick&&!EH){C3.OnDblClick(FR)}else{Bi();if(Ds||D){return false}var FS=Bx.MakeCopy();FS.SetPixelCenter(new SuperMap.IS.PixelCoord(F+Cv+_GetMouseX(FR)-B,C+Cu+_GetMouseY(FR)-A));if(!FR.altKey){if(FS.mapScales&&FS.mapScales.length>0){if(Ac.zoomLevel<FS.mapScales.length){FS.SetMapScale(FS.mapScales[Ac.zoomLevel])}else{FS.SetMapScale(FS.mapScales[FS.mapScales.length])}}else{FS.SetMapScale(Ac.mapScale*2)}}else{if(FS.mapScales&&FS.mapScales.length>0){if(Ac.zoomLevel>1){FS.SetMapScale(FS.mapScales[Ac.zoomLevel-2])}else{FS.SetMapScale(FS.mapScales[0])}}else{FS.SetMapScale(Ac.mapScale/2)}}AV(FS)}Aw(FR,"ongeometrydblclick")}function E1(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);if(C3&&C3.OnTouchStart&&!EH){C3.OnTouchStart(FR)}return false}function Z(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);if(C3&&C3.OnTouchMove&&!EH){C3.OnTouchMove(FR)}return false}function Bs(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);if(C3&&C3.OnTouchEnd&&!EH){C3.OnTouchEnd(FR)}return false}function E3(FR){FR=_GetEvent(FR);_CancelBubble(FR);FC(FR);E6(FR,"oncontextmenu");if(C3&&C3.OnContextMenu&&!EH){C3.OnContextMenu(FR)}if(FR.preventDefault){FR.preventDefault()}return false}function Bc(FR){if(EH){return false}FR=_GetEvent(FR);E6(FR,"onmousewheel");_CancelBubble(FR);if(Ds||D){return false}var FS=_GetMouseScrollDelta(FR);if(FS>0){if(!DQ.wheelZoomByMouse){AF()}else{Bb(FR)}}else{if(FS<0){if(!DQ.wheelZoomByMouse){O()}else{Ej(FR)}}}if(FR.preventDefault){FR.preventDefault()}return false}function Aw(FW,FT){if(FW.cancelTriggerGeometryEvent){return }if(!CM){return }var FX=new Array();var FR=false;switch(FT){case"ongeometrydblclick":var FV=a["ongeometrydblclick"];if(FV&&FV.length>=0){FR=true}if(!FR){for(var FU=0;FU<EW.length;FU++){if(EW[FU]!=null){FR=true;break}}}if(FR){FX.push("ongeometrydblclick")}break;case"ongeometryclick":var FV=a["ongeometryclick"];if(FV&&FV.length>=0){FR=true}if(!FR){for(var FU=0;FU<Co.length;FU++){if(Co[FU]!=null){FR=true;break}}}if(FR){FX.push("ongeometryclick")}break;case"ongeometrymousemove":var FV;FV=a["ongeometrymouseover"];if(FV&&FV.length>0){FR=true}FV=a["ongeometrymouseout"];if(FV&&FV.length>0){FR=true}if(!FR){for(var FU=0;FU<AK.length;FU++){if(AK[FU]!=null){FR=true;break}}}if(!FR){for(var FU=0;FU<CD.length;FU++){if(CD[FU]!=null){FR=true;break}}}if(FR){FX.push("ongeometrymouseover");FX.push("ongeometrymouseout")}break;default:return }if(!FR){return }function FS(FY,Fd){for(var Fb=0;Fb<FX.length;Fb++){var Fc;switch(FX[Fb]){case"ongeometrydblclick":Fc=FY.concat();break;case"ongeometryclick":Fc=FY.concat();break;case"ongeometrymouseover":Fc=new Array();if(FY.length==0){}else{for(var Fa=0;Fa<FY.length;Fa++){var Fe=false;for(var FZ=0;FZ<Cl.length;FZ++){if(FY[Fa]==Cl[FZ]){Fe=true;break}}if(!Fe){Fc.push(FY[Fa])}}}break;case"ongeometrymouseout":Fc=new Array();if(Cl.length==0){}else{for(var Fa=0;Fa<Cl.length;Fa++){var Fe=false;for(var FZ=0;FZ<FY.length;FZ++){if(Cl[Fa]==FY[FZ]){Fe=true;break}}if(!Fe){Fc.push(Cl[Fa])}}}break;default:return }FW.ids=Fc;for(var Fa=0;Fa<Fc.length;Fa++){for(var FZ=0;FZ<BV.length;FZ++){if(Fc[Fa]==BV[FZ]){switch(FX[Fb]){case"ongeometrydblclick":if(EW[FZ]){FW.id=Fc[Fa];EW[FZ](FW)}break;case"ongeometryclick":if(Co[FZ]){FW.id=Fc[Fa];Co[FZ](FW)}break;case"ongeometrymouseover":if(AK[FZ]){FW.id=Fc[Fa];AK[FZ](FW)}break;case"ongeometrymouseout":if(CD[FZ]){FW.id=Fc[Fa];CD[FZ](FW)}break;default:break}}}}var Fg=a[FX[Fb]];if(Fg&&Fg.length>=0){var Ff=Fg.concat();for(var Fa=0;Fa<Ff.length;Fa++){if(Ff[Fa]){Ff[Fa](FW,Fd)}}while(Ff.length>0){Ff.pop()}}}Cl=FY}CC(FW.mapCoord,Em,Ap,FS,null,null)}function Ao(FR){}function EB(FT,FS,FV){if(FT==0&&FS==0){return }if(CR!=null){Bv(Ac,CR,FT,FS)}else{CB(Ac,FI,FT,FS)}Cv=Ac.pixelCenter.x-F-E/2;Cu=Ac.pixelCenter.y-C-Q/2;for(var FU=0;FU<BL.length;FU++){DN[BL[FU]].container.style.top=-Cu+"px";DN[BL[FU]].container.style.left=-Cv+"px"}A0.style.top=-Cu+"px";A0.style.left=-Cv+"px";Ds=FV;var FR=function(){BQ(FV)};BF=window.setTimeout(FR,1)}function C5(FS,FR,FU,FT){if(D){return }if(!FU){FU=-1}A3=FS;A2=FR;E4=FU;if(!FS&&!FR){k();return }Bo=FT;if(!Ds){Ds=true;FF();Dq("onstartdynamicpan")}}function FF(){if(!Ds){return }EB(A3,A2,true);if(E4>0){E4--}if(E4!=0){Cs=window.setTimeout(FF,10)}else{Cs=window.setTimeout(k,10)}}function k(){if(CK!=null&&CH!=null){var FV=new SuperMap.IS.MapCoord(CK,CH);var FT=N.MapCoordToPixel(FV,Ac.mapScale);var FS=FT.x-(F+Cv+E/2);var FR=FT.y-(C+Cu+Q/2);EB(FS,FR,true);Bx.Copy(Ac);CK=null;CH=null}EG(true);if(S){window.status="_panning:"+Ds}if(Ds){var FU=Dk();if(!FU.Equals(Ex)){Dq("onenddynamicpan");Dq("onviewboundschanged");Dq("onchangeview");Ex=Dk()}Dv=0;if(BD){window.clearTimeout(BD);BD=null}BD=setTimeout(EZ,200)}A3=0;A2=0;Ds=false;Bo=false;D4()}function A5(FR,FS){CK=FR;CH=FS;w(N.MapCoordToPixel(new SuperMap.IS.MapCoord(FR,FS),Ac.mapScale))}function v(FR){w(FR.pixelCenter)}function w(FT){var FS=FT.x-(F+Cv+E/2);var FR=FT.y-(C+Cu+Q/2);var FY=Math.sqrt(FS*FS+FR*FR);if(!CL){var FX=Bx.MakeCopy();FX.SetPixelCenter(FT);AV(FX);return }var FW=Math.atan2(FR,FS);var FV=_Ceil(FY/DV);var FU=_Round(FY/FV);FS=_Round(Math.cos(FW)*FU);FR=_Round(Math.sin(FW)*FU);C5(FS,FR,FV)}function BK(FR,FV,FS,FU){var FT=new Ch(FU);FT.Init(FR,FV,FS,(FR*FU.tileWidth-FU.originX),(FV*FU.tileHeight-FU.originY));return FT}function Dn(FR){while(FR.length>0){var FT=FR.pop();if(FT==null){continue}while(FT.length>0){var FS=FT.pop();if(FS!=null){FS.Destroy();FS=null}}}}function b(FR){while(FR.length>0){var FT=FR.pop();if(FT==null){continue}while(FT.length>0){var FS=FT.pop();if(FS!=null){FS.Display()}}}}function Ch(Fx){var FT=null;var F2=null;var Fa=document.createElement("div");Fa.id="_overlay.unInited";var Fw=0;var Fv=0;var FU=0;var Ff=0;var Fq=Dw+1;var Fj=new Array(Fq);var FY=new Array(Fq);var Fz=new Array(Fq);var Fs=new Array(Fq);var FX=false;var Fd=0,Fc=0,Fe=0,Fi=0;var Fr=0,Fp=0,Ft=0,FR=0;var FS=null;var F0=this;this.Init=function(F4,GC,F7,GB,GA){Fw=F4;Fv=GC;FU=F7;Fa.style.font="7pt Verdana, sans-sansserif";Fa.style.color="Red";Fa.style.backgroundColor="White";if(!N.IsValidTile(Fw,Fv,FU)){return }FV(GB,GA,Fx.tileWidth,Fx.tileHeight);Fg(GB,GA,Fx.tileWidth,Fx.tileHeight);Fb();var F5=Fx.GetTileID(Fw,Fv,FU);F0.id=F5;Fa.id="_overlay."+F5;var GD=null;for(var F6=0;F6<BL.length;F6++){if(BL[F6]==Fx.id){GD=o[F6];break}}if(GD&&GD[F5]){FT=GD[F5];FT.onmousedown=function(GE){return false};if(!D){Fk(CS)}F0.Loaded=true}else{F2=new Image(Fx.tileWidth,Fx.tileHeight);F2.id=F5;F2.onload=FZ;F2.onerror=Fy;if(BC){F2.style["-webkit-tap-highlight-color"]="rgba(0,0,0,0)"}if(Fx.opacity!=1){F2.style.filter="alpha(opacity="+Fx.opacity*100+")";F2.style.opacity=Fx.opacity}FS=new Date();if(CV&&ED){var F3=Fx.GetTileUrl(Fw,Fv,FU);F2.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+decodeURI(F3)+"', sizingMethod='scale')";F2.src="images/spacer.gif"}else{if(Db.useSimpleCache){var F9=N.GetMapBounds();var F8=A4*Ez(1,FU);if(Fw<0||Fv<0||Fw*F8+F9.leftBottom.x>F9.rightTop.x||F9.rightTop.y-Fv*F8<F9.leftBottom.y){F2.src="images/blank.gif";return }}F2.src=Fx.GetTileUrl(Fw,Fv,FU)}}};function F1(){FS=new Date();var F3=document.getElementById(Fx.GetTileID(Fw,Fv,FU));var F4=Fx.GetTileUrl(Fw,Fv,FU);if(F4.indexOf("?")==-1){F4+="?refreshTime="+FS.getTime()}else{F4+="&refreshTime="+FS.getTime()}if(F3){if(CV&&ED){F3.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+decodeURI(F4)+"', sizingMethod='scale')";F3.src="images/spacer.gif"}else{F3.src=F4}}else{if(F2){if(CV&&ED){F2.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+decodeURI(F4)+"', sizingMethod='scale')";F2.src="images/spacer.gif"}else{F2.src=F4}}}}this.Display=function(){if(FT){FT.style.display="none"}};this.Destroy=function(){if(FT){FT.onmousedown=null;if(!Fx.useImageBuffer){var F3=FT.style;F3.left=Fj[0]+"px";F3.top=FY[0]+"px";F3.width=Fz[0]+"px";F3.height=Fs[0]+"px"}}Fl();while(Fj.length>0){Fj.pop()}while(FY.length>0){FY.pop()}while(Fz.length>0){Fz.pop()}while(Fs.length>0){Fs.pop()}Fj=FY=Fz=Fs=null;F0=null};function FV(F4,F6,F5,F3){Fd=F4;Fc=F6;Fe=F5;Fi=F3}function Fg(F4,F6,F5,F3){Fr=F4;Fp=F6;Ft=F5;FR=F3}function Fu(){for(var F3=0;F3<=Dw;F3++){Fj[F3]=Fd;FY[F3]=Fc;Fz[F3]=Fe;Fs[F3]=Fi}}function Fb(){for(var F5=0;F5<=Dw;F5++){var F4=F5/Dw;var F3=1-F4;Fj[F5]=_Floor(F3*Fd+F4*Fr);FY[F5]=_Floor(F3*Fc+F4*Fp);Fz[F5]=_Ceil(F3*Fe+F4*Ft);Fs[F5]=_Ceil(F3*Fi+F4*FR)}}function Fk(F3){if(FT==null||(D&&!FX)){return }var F4=FT.style;F4.left=Fj[F3]+"px";F4.top=FY[F3]+"px";F4.width=Fz[F3]+"px";F4.height=Fs[F3]+"px";F4.zIndex=Ff;F4.display="block";if(FT.parentNode!=Fx.container){F4.position="absolute";Fx.container.appendChild(FT)}var F5=Fa.style;if(S&&F3==0){F4.border="1px dashed red";F5.left=Fj[F3]+"px";F5.top=FY[F3]+"px"}if(S&&Fa.parentNode!=Fx.container){Fa.innerHTML=FT.id;F5.position="absolute";F5.zIndex=(Ff+1);Fx.container.appendChild(Fa)}}function Fh(){var F3=0;F3=Fd;Fd=Fr;Fr=F3;F3=Fc;Fc=Fp;Fp=F3;F3=Fe;Fe=Ft;Ft=F3;F3=Fi;Fi=FR;FR=F3}function Fl(){if(!Fx.useImageBuffer){return Fo()}if(t.length>36){var F4=t.splice(0,18);while(F4.length>0){var F5=F4.pop();F5.RemoveFromMapTrue();F5=null}F4=null}if(!D){while(t.length>0){var F7=t.pop();F7.RemoveFromMapTrue();F7=null}Fo();return }if(!FT){Fo();return }FT.style.zIndex=-1;if(Db.transparent){FT.style.display="none"}var F3=CG;var F6=this._overlay;F3=null;F6=null;F0.unused=true;t.push(F0);if(S){window.status="preTiles:"+t.length}return ;if(F2){F2.onload=null;F2.onerror=null;delete F2;F2=null}if(FT){if(FT.parentNode==Fx.container){Fx.container.removeChild(FT)}delete FT;FT=null}if(Fa){if(Fa.parentNode==Fx.container){Fx.container.removeChild(Fa)}Fa=null}}function Fo(){for(var F3=0;F3<t.length;F3++){if(t[F3].id==this.id){t.splice(F3,1);break}}if(F2){F2.onload=null;F2.onerror=null;delete F2;F2=null}if(FT){if(FT.parentNode==Fx.container){Fx.container.removeChild(FT)}delete FT;FT=null}if(Fa){if(Fa.parentNode==Fx.container){Fx.container.removeChild(Fa)}Fa=null}}function FZ(){if(FU!=Ac.mapScale||F2==null){return }var F4=0;for(var F5=0;F5<BL.length;F5++){if(BL[F5]==Fx.id){F4=F5;break}}if(o[F4]==null){o[F4]=new Array()}if(o[F4].length>AU){for(var F5=0;F5<AU/3;F5++){delete o[F4][o[F4][0]];o[F4].shift()}}o[F4][F2.id]=F2;o[F4].push(F2.id);if(S){var F6=new Date();var F3=F6.getTime()-FS.getTime();window.status="elapsedTime="+F3}F2.onload=null;F2.onerror=null;FT=F2;FT.onmousedown=function(F7){return false};FT.onselectstart=function(F7){return false};FT.ondrag=function(F7){return false};FT.ondragend=function(F7){return false};if(_ygPos.browser.indexOf("ie")==-1){FT.style.MozUserSelect="none"}delete F2;F2=null;if(!D){Fk(CS)}F0.Loaded=true}function Fy(){if(FU!=Ac.mapScale||F2==null){return }if(S){var F4=new Date();var F3=F4.getTime()-FS.getTime();window.status="elapsedTime="+F3}}function Fm(F4,F3,F6,F8,F7,F9){FV(Fd-Cv,Fc-Cu,Fe,Fi);var F5=F9/F6;Fr=_Floor((F4+Fd)*F5-F8);Fp=_Floor((F3+Fc)*F5-F7);Ft=_Ceil((F4+Fd+Fe)*F5-F8)-Fr;FR=_Ceil((F3+Fc+Fi)*F5-F7)-Fp;FX=true;Fb();Ff=x;if(FT!=null){FT.style.zIndex=Ff;FT.style.display="block"}}function Fn(GB,F9,F4,F3,GA,F5){var F6=F5/F4;Fr=_Floor((GB+Fd)*F6-F3);Fp=_Floor((F9+Fc)*F6-GA);Ft=_Ceil((GB+Fd+Fe)*F6-F3)-Fr;FR=_Ceil((F9+Fc+Fi)*F6-GA)-Fp;var F8=_Ceil(X*0.25);var F7=_Ceil(U*0.25);FX=(F5>F4)&&(Fw<ET+F8||Fw>ER-F8||Fv<D8+F7||Fv>D7-F7);FX=false;Fh();Fb();Ff=Y;if(FT!=null){FT.style.zIndex=Ff;FT.style.display="block"}}function FW(F3){if(FT!=null){FT.style.border=F3?"1px dashed blue":"0px"}Fa.style.display=F3?"block":"none"}this.ClearSteps=Fu;this.SetFactor=Fk;this.SwapStates=Fh;this.RemoveFromMap=Fl;this.RemoveFromMapTrue=Fo;this.PrepareBaseTile=Fm;this.PrepareSwapTile=Fn;this.Debug=FW;this.RefreshUrl=F1}this.TriggerServerCompletedEvent=function(FT,FS){var FY="";var FR=document.getElementById(Aj.id+"_hiddenServerEventsInfo");if(FR){FY=FR.value}var FV=eval("("+FY+")");var FU;var FW=false;switch(FT){case"DistanceMeasured":if(FV.distanceMeasuredRegisted){FU=new SuperMap.IS.MeasuredEventArgs();FU.distance=FS.distance;FW=true}break;case"AreaMeasured":if(FV.areaMeasuredRegisted){FU=new SuperMap.IS.MeasuredEventArgs();FU.area=FS.area;FW=true}break;case"PathFound":if(FV.pathFoundRegisted){FU=new SuperMap.IS.PathFoundEventArgs(FS);FW=true}break;case"QueryCompleted":if(FV.queryCompletedRegisted){FU=new SuperMap.IS.QueryCompletedEventArgs(FS);FW=true}break;case"ClosestFacilityFound":if(FV.closestFacilityFoundRegisted){FU=new SuperMap.IS.ClosestFacilityFoundEventArgs(FS);FW=true}break;case"CustomEvent":if(FV.customEventRegisted){FU=new SuperMap.IS.CustomEventArgs(FS);FW=true}break;default:break}if(FW){var FX=_ToJSON(FU);eval(Aj.id+"_doPostBack('"+Aj.id+"', '"+FT+"|"+FX+"')")}};this.TriggerServerStartingEvent=function(FU,FV,FS){var FX=false;var FY=document.getElementById(Aj.id+"_hiddenServerEventsInfo");if(FY){try{var FT=FY.value;var FZ=eval("("+FT+")");switch(FU){case"DistanceMeasuring":if(FZ.distanceMeasuringRegisted){FX=true}break;case"AreaMeasuring":if(FZ.areaMeasuringRegisted){FX=true}break;case"PathFinding":if(FZ.pathFindingRegisted){FX=true}break;case"Querying":if(FZ.queryingRegisted){FX=true}break;case"ClosestFacilityFinding":if(FZ.closestFacilityFindingRegisted){FX=true}break;default:break}}catch(FW){}}var FR=_ToJSON(FV);if(FX){eval(Aj.id+"_CallBack(arguments[0]+'|'+_ToJSON(arguments[1]),arguments[2],null)")}else{FS(FR)}};function EC(){Dn(Eq);A0.style.top="0px";A0.style.left="0px";for(var Fh=0;Fh<BL.length;Fh++){var FU=Ez(1,Ac.mapScale);var Fj=Ez(1,Ac.mapScale,true);var Fb=parseInt((Ac.center.x-DN[BL[Fh]].layerBounds.leftBottom.x)/FU);var Fa=parseInt((DN[BL[Fh]].layerBounds.rightTop.y-Ac.center.y)/Fj);DN[BL[Fh]].originX=_Round(Fb-E/2);DN[BL[Fh]].originY=_Round(Fa-Q/2)}F=_Round(Ac.pixelCenter.x-E/2);C=_Round(Ac.pixelCenter.y-Q/2);Cv=0;Cu=0;for(var Fh=0;Fh<BL.length;Fh++){var FR=DN[BL[Fh]].tileWidth;var FY=DN[BL[Fh]].tileHeight;var Fd=DN[BL[Fh]].originX;var Fc=DN[BL[Fh]].originY;DN[BL[Fh]].container.style.top="0px";DN[BL[Fh]].container.style.left="0px";ET[Fh]=_Floor((Fd-Do)/FR);D8[Fh]=_Floor((Fc-Do)/FY);ER[Fh]=_Floor((Fd+E+Do)/FR);D7[Fh]=_Floor((Fc+Q+Do)/FY);X[Fh]=ER[Fh]-ET[Fh]+1;U[Fh]=D7[Fh]-D8[Fh]+1}for(var Fh=0;Fh<BL.length;Fh++){if(Fh==1&&DI<0){if(!Eq[Fh]){Eq[Fh]=new Array()}continue}if(Fh==2&&CM==""){if(!Eq[Fh]){Eq[Fh]=new Array()}continue}var Fe=DN[BL[Fh]].visibleBounds;var FW=DN[BL[Fh]].maxScale;var FS=DN[BL[Fh]].minScale;var FZ=_Floor((X[Fh]-1)/2);var FX=_Floor((U[Fh]-1)/2);var FV=0;var Fg=0;var Fk=0;var Fi=0;var Fb=0;var Fa=0;while(FZ+FV<X[Fh]||FX+FV<U[Fh]){Fk=FZ+FV;Fi=FX-FV;Fb=Fk;Fa=Fi;Fg=1;do{if(Fb>=0&&Fb<X[Fh]&&Fa>=0&&Fa<U[Fh]){var FT=V(Fb+ET[Fh],Fa+D8[Fh],DN[BL[Fh]].tileWidth,DN[BL[Fh]].tileHeight,DN[BL[Fh]].layerBounds);var Fl=null;if((!FW||Ac.mapScale<FW)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fl=BK(Fb+ET[Fh],Fa+D8[Fh],Ac.mapScale,DN[BL[Fh]])}if(!Eq[Fh]){Eq[Fh]=new Array()}var Ff=Fb+Fa*X[Fh];Eq[Fh][Ff]=Fl}if(Fb==FZ+FV&&Fa==FX+FV){Fg=0}else{if(Fb==FZ-FV&&Fa==FX+FV){Fg=3}else{if(Fb==FZ-FV&&Fa==FX-FV){Fg=2}else{if(Fb==FZ+FV&&Fa==FX-FV){Fg=1}}}}if(FV>0){if(Fg==0){Fb--}else{if(Fg==1){Fa++}else{if(Fg==2){Fb++}else{if(Fg==3){Fa--}}}}}}while(Fk!=Fb||Fi!=Fa);FV++}}if(i){T()}}function BQ(Fd){if(D){return }for(var Fg=0;Fg<BL.length;Fg++){if(Fg==1&&DI<0){continue}if(Fg==2&&CM==""){continue}var FR=DN[BL[Fg]].tileWidth;var FY=DN[BL[Fg]].tileHeight;var FV=DN[BL[Fg]].originX+Cv;var FU=DN[BL[Fg]].originY+Cu;var Fh=_Floor((FV-Do)/FR);var Ff=_Floor((FU-Do)/FY);var Fc=_Floor((FV+E+Do)/FR);var Fa=_Floor((FU+Q+Do)/FY);var Fe=DN[BL[Fg]].visibleBounds;var FX=DN[BL[Fg]].maxScale;var FS=DN[BL[Fg]].minScale;while(ET[Fg]<Fh){for(var FZ=U[Fg]-1;FZ>=0;FZ--){var FT=V(ET[Fg],D8[Fg]+FZ,FR,FY,DN[BL[Fg]].layerBounds);var Fi=Eq[Fg].splice(FZ*X[Fg],1)[0];if(Fi&&(!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi.RemoveFromMap()}}ET[Fg]++;X[Fg]--}while(ET[Fg]>Fh){ET[Fg]--;X[Fg]++;for(var FZ=0;FZ<U[Fg];FZ++){var FT=V(ET[Fg],D8[Fg]+FZ,FR,FY,DN[BL[Fg]].layerBounds);var Fi=null;if((!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi=BK(ET[Fg],D8[Fg]+FZ,Ac.mapScale,DN[BL[Fg]])}Eq[Fg].splice(FZ*X[Fg],0,Fi)}}while(D8[Fg]<Ff){for(var Fb=0;Fb<X[Fg];Fb++){var FT=V(ET[Fg]+Fb,D8[Fg],FR,FY,DN[BL[Fg]].layerBounds);var Fi=Eq[Fg].shift();if(Fi&&(!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi.RemoveFromMap()}}D8[Fg]++;U[Fg]--}while(D8[Fg]>Ff){D8[Fg]--;U[Fg]++;for(var Fb=X[Fg]-1;Fb>=0;Fb--){var FT=V(ET[Fg]+Fb,D8[Fg],FR,FY,DN[BL[Fg]].layerBounds);var Fi=null;if((!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi=BK(ET[Fg]+Fb,D8[Fg],Ac.mapScale,DN[BL[Fg]])}Eq[Fg].unshift(Fi)}}while(ER[Fg]>Fc){for(var FZ=U[Fg]-1;FZ>=0;FZ--){var FT=V(ER[Fg],D8[Fg]+FZ,FR,FY,DN[BL[Fg]].layerBounds);var Fi=Eq[Fg].splice(FZ*X[Fg]+X[Fg]-1,1)[0];if(Fi&&(!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi.RemoveFromMap()}}ER[Fg]--;X[Fg]--}while(ER[Fg]<Fc){ER[Fg]++;X[Fg]++;for(var FZ=0;FZ<U[Fg];FZ++){var FT=V(ER[Fg],D8[Fg]+FZ,FR,FY,DN[BL[Fg]].layerBounds);var Fi=null;if((!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi=BK(ER[Fg],D8[Fg]+FZ,Ac.mapScale,DN[BL[Fg]])}Eq[Fg].splice(FZ*X[Fg]+X[Fg]-1,0,Fi)}}while(D7[Fg]>Fa){for(var Fb=0;Fb<X[Fg];Fb++){var FT=V(ER[Fg]-Fb,D7[Fg],FR,FY,DN[BL[Fg]].layerBounds);var Fi=Eq[Fg].pop();if(Fi&&(!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi.RemoveFromMap()}}D7[Fg]--;U[Fg]--}while(D7[Fg]<Fa){D7[Fg]++;U[Fg]++;for(var Fb=0;Fb<X[Fg];Fb++){var FT=V(ET[Fg]+Fb,D7[Fg],FR,FY,DN[BL[Fg]].layerBounds);var Fi=null;if((!FX||Ac.mapScale<FX)&&(!FS||Ac.mapScale>FS)&&(!Fe||Bp(FT,Fe))){Fi=BK(ET[Fg]+Fb,D7[Fg],Ac.mapScale,DN[BL[Fg]])}Eq[Fg].push(Fi)}}}T();if(!Fd){var FW=Dk();if(!FW.Equals(Ex)){Dq("onviewboundschanged");Dq("onchangeview");Ex=Dk()}}}function AV(FV){if(D||Ds||DO){return }var Fk=FV.center;if(FV.GetViewType()=="mr"){Fk=FV.mapRect.Center()}N=CG;i=Dk();Aj.style.backgroundColor="#eeeeee";FV.Resolve(N,E,Q);Fk=FV.center;Bx.Copy(FV);N.ValidateMapScale(FV);if(CR!=null){FI=CR}else{FI=N.GetBounds()}A6(FV,FI);FV.Resolve(N,E,Q);var Fl=FV.GetPixelX(Ac.mapScale)-Ac.pixelCenter.x;var Fj=FV.GetPixelY(Ac.mapScale)-Ac.pixelCenter.y;var FS=Math.sqrt(Fl*Fl+Fj*Fj);var FU=(FS<E&&FS<Q)&&(FV.mapScale==Ac.mapScale)&&CL;if(FU&&!C8){if(Fl==0&&Fj==0){return }A5(Fk.x,Fk.y);return }AQ=Ac.mapScale;E8=Ac.mapName;if(Ac.mapScale!=FV.mapScale&&Ac.mapName==FV.mapName&&AQ){N.mapScale=FV.mapScale;Dq("onstartzoom");D=true}var Fb=FV.mapScale/Ac.mapScale;var FT=(FS<E&&FS<Q)&&CL&&Fb>1/8&&Fb<8;if(FT&&!C8){var FR=Ac.mapScale;var Fa=FV.mapScale;En=Eq;Eq=new Array();for(var Ff=0;Ff<En.length;Ff++){var Fg=En[Ff];var FZ=DN[BL[Ff]].originX+Cv;var FX=DN[BL[Ff]].originY+Cu;var FS=Ez(1,FV.mapScale);var Fh=Ez(1,FV.mapScale,true);var FY=parseInt((FV.center.x-DN[BL[Ff]].layerBounds.leftBottom.x)/FS);var FW=parseInt((DN[BL[Ff]].layerBounds.rightTop.y-FV.center.y)/Fh);var Fd=_Round(FY-E/2);var Fc=_Round(FW-Q/2);for(var Fe=0;Fe<Fg.length;Fe++){if(Fg[Fe]!=null){Fg[Fe].PrepareBaseTile(FZ,FX,FR,Fd,Fc,Fa)}}if(Ff==0){for(var Fe=0;Fe<Bn.length;Fe++){Bn[Fe].PrepareForZoom(Fd,Fc,Fa)}}}By();Ac.Destroy();Ac=FV;EC();for(var Ff=0;Ff<Eq.length;Ff++){var Fi=Eq[Ff];for(var Fe=0;Fe<Fi.length;Fe++){if(Fi[Fe]!=null){Fi[Fe].PrepareSwapTile(FZ,FX,FR,Fd,Fc,Fa)}}}if(BC){b(En)}CS=1;D9();D4();return }En=Eq;Eq=new Array();Ac.Destroy();Ac=FV;By();EC();DE();D4();Br();B6();Eg();At()}function D9(){if(!D){return }if(!BC){for(var FT=0;FT<En.length;FT++){var FU=En[FT];for(var FS=0;FS<FU.length;FS++){if(FU[FS]!=null){FU[FS].SetFactor(CS)}}}}for(var FT=0;FT<Eq.length;FT++){var FR=Eq[FT];for(var FS=0;FS<FR.length;FS++){if(FR[FS]!=null){FR[FS].SetFactor(CS)}}}for(var FT=0;FT<Bn.length;FT++){Bn[FT].SetFactor(CS)}if(CS<Dw){CS++;Dp=window.setTimeout(D9,1)}else{CS=0;DE()}}function DE(){Dn(En);En=null;D=false;for(var FU=0;FU<Eq.length;FU++){var FR=Eq[FU];if(FR==null){continue}for(var FS=0;FS<FR.length;FS++){if(FR[FS]!=null){FR[FS].SwapStates();FR[FS].ClearSteps();FR[FS].SetFactor(0)}}}for(var FU=0;FU<Bn.length;FU++){Bn[FU].SwapStates();Bn[FU].ClearSteps();Bn[FU].SetFactor(0)}Ep=window.setTimeout(EQ,250);if(AQ!=Ac.mapScale&&AQ&&!C8&&E8==Ac.mapName){AQ=Ac.mapScale;Dq("onendzoom")}if(!C8){var FV=Dk();if(!FV.Equals(Ex)&&Ex){Dq("onviewboundschanged");Ex=Dk()}if(Ex){Dq("onchangeview")}}else{Dq("onchangeview")}Dv=0;if(BD){window.clearTimeout(BD);BD=null}BD=setTimeout(EZ,200);try{CollectGarbage()}catch(FT){}}this.ViewEntire=function(){var FX=Bx.MakeCopy();var FR=BW();if(CR!=null){Am(CR.leftBottom.x,CR.leftBottom.y,CR.rightTop.x,CR.rightTop.y);return }var FW=Dk();var FU=FR.Width()/FW.Width();var FS=FR.Height()/FW.Height();var FT=FU>FS?FU:FS;if(Math.abs(1-FT)<Math.pow(10,-13)){FT=1}var FV=FX.mapScale/FT;FX.SetMapScale(FV);FX.SetMapCenter(FR.Center());AV(FX)};function Am(FS,FU,FR,FT){var FV=Bx.MakeCopy();FV.SetMapRect(new SuperMap.IS.MapRect(FS,FU,FR,FT));AV(FV)}function DB(FX){if(!FX||FX.constructor!=Array){return }var FT=FX[0].x;var FR=FX[0].y;var FY=FT;var FW=FR;for(var FV=1;FV<FX.length;FV++){FT=_Min(FT,FX[FV].x);FR=_Min(FR,FX[FV].y);FY=_Max(FY,FX[FV].x);FW=_Max(FW,FX[FV].y)}var FU=(FY-FT)*0.1;var FS=(FW-FR)*0.1;FT-=FU;FR-=FS;FY+=FU;FW+=FS;Am(B1(FT),B0(FR),B1(FY),B0(FW))}function DD(FR,FX){var FU=new SuperMap.IS.MapCoord(FR,FX);var FT=Dk();var FS=FT.Width();var FW=FT.Height();FT.leftBottom.x+=FS*0.1;FT.leftBottom.y+=FW*0.1;FT.rightTop.x-=FS*0.1;FT.rightTop.y-=FW*0.1;if(CR!=null){if(FR<CR.leftBottom.x||FX<CR.leftBottom.y||FR>CR.rightTop.x||FX>CR.rightTop.x){return }}if(FT.Contains(FU)){return }var FV=Bx.MakeCopy();FV.SetMapCenter(new SuperMap.IS.MapCoord(FR,FX));AV(FV)}function AI(FR){var FS=Bx.MakeCopy();FS.SetMapScale(FR);AV(FS)}function Ek(FS){var FR=Bx.MakeCopy();FR.SetZoomLevel(FS);AV(FR)}function AF(){var FR=Bx.MakeCopy();if(FR.mapScales&&FR.mapScales.length>0){if(Ac.zoomLevel<FR.mapScales.length){FR.SetMapScale(FR.mapScales[Ac.zoomLevel])}else{FR.SetMapScale(FR.mapScales[FR.mapScales.length])}}else{FR.SetMapScale(Ac.mapScale*2)}AV(FR)}function d(FR){var FS=Bx.MakeCopy();FS.SetMapScale(Ac.mapScale*FR);AV(FS)}function O(){var FR=Bx.MakeCopy();if(FR.mapScales&&FR.mapScales.length>0){if(Ac.zoomLevel>1){FR.SetMapScale(FR.mapScales[Ac.zoomLevel-2])}else{FR.SetMapScale(FR.mapScales[0])}}else{FR.SetMapScale(Ac.mapScale/2)}AV(FR)}function Cp(FS,FV,FT){var FU=Bx.MakeCopy();var FR=new SuperMap.IS.MapCoord(FS,FV);FU.SetMapCenter(FR);FU.SetMapScale(FT);AV(FU)}function B1(FR){return Bk(FR,AD.leftBottom.x,AD.rightTop.x)}function B0(FR){return Bk(FR,AD.leftBottom.y,AD.rightTop.y)}function Bk(FT,FR,FS){if(FT<FR){return FR}if(FT>FS){return FS}return FT}function B7(){return Ac.MakeCopy()}function Bb(FV){var FW=Bx.MakeCopy();if(FW.mapScales&&FW.mapScales.length>0){if(Ac.zoomLevel<FW.mapScales.length){FW.SetMapScale(FW.mapScales[Ac.zoomLevel])}else{FW.SetMapScale(FW.mapScales[FW.mapScales.length])}}else{FW.SetMapScale(Ac.mapScale*2)}var FU=BI(FW.center);var FT=Ez(FU.x-FV.x,FW.mapScale);var FS=Ez(FU.y-FV.y,FW.mapScale);var FR=R(FV);FW.center.x=FR.x+FT;FW.center.y=FR.y-FS;Cp(FW.center.x,FW.center.y,FW.mapScale)}function Ej(FV){var FW=Bx.MakeCopy();if(FW.mapScales&&FW.mapScales.length>0){if(Ac.zoomLevel>1){FW.SetMapScale(FW.mapScales[Ac.zoomLevel-2])}else{FW.SetMapScale(FW.mapScales[0])}}else{FW.SetMapScale(Ac.mapScale/2)}var FU=BI(FW.center);var FT=Ez(FU.x-FV.x,FW.mapScale);var FS=Ez(FU.y-FV.y,FW.mapScale);var FR=R(FV);FW.center.x=FR.x+FT;FW.center.y=FR.y-FS;Cp(FW.center.x,FW.center.y,FW.mapScale)}function EP(){return F}function EO(){return C}function B4(){return Cv}function B3(){return Cu}function C7(){return B}function C6(){return A}function Ef(FR){if(C3&&(C3!=CT&&C3!=FH)){C3.Destroy()}if(FR){FR.Init(DQ)}C3=FR;Dz(C3)}function Dz(FS){var FR=document.getElementById(Aj.id+"_hiddenClientAction");if(!FR){return }if(FS==null){FR.value=""}else{FR.value=FS.GetJSON()}}function Az(){return C3}function EY(FS,FR){if(!FS){FS="unClassified"}FS=DQ.id+"_"+FS;var FT=document.getElementById(FS);if(!FT){FT=document.createElement("div");FT.id=FS;A0.appendChild(FT)}if(FR.parentNode){FR.parentNode.removeChild(FR)}FT.appendChild(FR)}function AH(FR,FT){FR=DQ.id+"_"+FR;var FS=document.getElementById(FR);if(!FS){return }FS.style.visibility=FT?"":"hidden"}function Bd(FR,FT){FR=DQ.id+"_"+FR;var FS=document.getElementById(FR);if(FS){FS.style.zIndex=FT}}function BG(){this.style.visibility="visible"}function Cn(FT,FY,FS,FX,FZ,FR,FV,FW){for(var FU=0;FU<BV.length;FU++){if(BV[FU]==FT){return false}}BV.push(FT);Av.push(FY);BE.push(FS);Dm.push(FX);Co.push(FZ);EW.push(FR);AK.push(FV);CD.push(FW);return true}function AL(FS,FU,FT,FZ,Fa,FR,FW,FY){if(!FS||!FU||!FS.length||!FU.length){return false}if(FS.length!=FU.length){return false}var FX=true;for(var FV=0;FV<FS.length;FV++){FX&=Cn(FS[FV],FU[FV],FT,FZ,Fa,FR,FW,FY)}return FX}function BT(FT,FY,FS,FX,FZ,FR,FV,FW){for(var FU=0;FU<BV.length;FU++){if(BV[FU]==FT){BV[FU]=FT;Av[FU]=FY;BE[FU]=FS;Dm[FU]=FX;Co[FU]=FZ;EW[FU]=FR;AK[FU]=FV;CD[FU]=FW;return true}}BV.push(FT);Av.push(FY);BE.push(FS);Dm.push(FX);Co.push(FZ);EW.push(FR);AK.push(FV);CD.push(FW);return true}function Cg(FS,FU,FT,FZ,Fa,FR,FW,FY){if(!FS||!FU||!FS.length||!FU.length){return false}if(FS.length!=FU.length){return false}var FX=true;for(var FV=0;FV<FS.length;FV++){FX&=BT(FS[FV],FU[FV],FT,FZ,Fa,FR,FW,FY)}return FX}function l(FS){for(var FR=0;FR<BV.length;FR++){if(BV[FR]==FS){BV.splice(FR,1);Av.splice(FR,1);BE.splice(FR,1);Dm.splice(FR,1);Co.splice(FR,1);EW.splice(FR,1);AK.splice(FR,1);CD.splice(FR,1);return true}}return false}function Ad(FT){if(!FT||!FT.length){return false}var FR=true;for(var FS=0;FS<FT.length;FS++){FR&=l(FT[FS])}return FR}function AM(){while(BV.length>0){BV.pop();var FS=Av.pop();if(FS){FS.Destroy();FS=null}var FR=BE.pop();if(FR){FR.Destroy();FR=null}Dm.pop();Co.pop();EW.pop();AK.pop();CD.pop()}return true}function AO(FS){for(var FR=0;FR<BV.length;FR++){if(BV[FR]==FS){return Av[FR]}}return null}function AZ(FT){var FS=new Array();for(var FR=0;FR<FT.length;FR++){FS.push(AO(FT[FR]))}return FS}function Di(FR){Cz=FR}function Dx(FR){Em=FR}function u(FR){Ap=FR}function Dh(FW,FV,FX){var FS=AX+"common.ashx";var FU=CW;function FR(FY){if(!FY){if(FW){FW(null,FX)}return }while(Cl.length>0){Cl.pop()}CM=eval("("+FY+")");D0();if(FW){FW(CM,FX)}}var FT=new SuperMap.IS.RequestManager(FS,FR,FV,FX);FT.AddQueryString("map",FU);FT.AddQueryString("method","UpdateGeometry");FT.AddQueryString("geometryIDs",_ToJSON(BV));FT.AddQueryString("geometries",_ToJSON(Av));FT.AddQueryString("geometrystyles",_ToJSON(BE));FT.AddQueryString("geometryIndexs",_ToJSON(Dm));FT.AddQueryString("defaultStyle",_ToJSON(Cz));FT.Send();FT.Destroy();FT=null}function CC(FX,Fa,Fd,FT,FW,FZ){if(!CM){return }var FS=Ez(Fa,Ac.mapScale);if(Fd){var FR=new Array();for(var FV=0;FV<Av.length;FV++){if(isPointInGeometry(FX,Av[FV],FS)){FR.push(BV[FV])}}if(FT){FT(FR,FZ)}}else{var Fc=AX+"common.ashx";var FY=CW;function Fb(Ff){if(!Ff){if(FT){FT(null,FZ)}return }var Fe=eval("("+Ff+")");if(FT){FT(Fe,FZ)}}var FU=new SuperMap.IS.RequestManager(Fc,Fb,FW,FZ);FU.AddQueryString("map",FY);FU.AddQueryString("method","QueryGeomtryByPoint");FU.AddQueryString("geometryKey",CM);FU.AddQueryString("position",_ToJSON(FX));FU.AddQueryString("tolerance",FS);FU.Send();FU.Destroy();FU=null}}function FP(FW){var FT=FW.GetCenter();if(!FW.isFilter){DH.push(FW);FW.isShow=true;FW.Show();return }if(!Ai.Contains(FT)){Eu.push(FW);FW.isShow=false;FW.Hide()}else{var FV=null;var FU=null;var FR=false;var FS=EM.length;while(FS--){FV=EM[FS];FU=FV.GetCenter();if(FU==null){continue}if(FT.x>=FU.x-AJ&&FT.x<=FU.x+AJ&&FT.y>=FU.y-AJ&&FT.y<=FU.y+AJ){FV.AddMark(FW);FW.isShow=false;FW.Hide();FR=true;break}}if(!FR){FV=new Ec();FV.AddMark(FW);FW.isShow=true;EM.push(FV)}}}function E5(FR,Fd,Fa,Fe,FX,FS,FY,Fb,Fc,FT,FZ){var FU;if(arguments.length>1){FU=new SuperMap.IS.MarkParam();FU.id=FR;FU.x=Fd;FU.y=Fa;FU.w=Fe;FU.h=FX;FU.innerHtml=FS;FU.className=FY;FU.zIndex=Fb;FU.groupID=Fc;FU.alignStyle=FT;FU.isFilter=FZ}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.MarkParam){FU=arguments[0]}else{return }}var FW=new FB();FW.Init(FU);Bn.push(FW);FL();var FV=B2();if(FU.isFilterMarks&&FV<DP){FP(FW)}FW.Draw();return FW.div}function B8(Fc,FY,FX,Fa,Fj,FW,FT,Fb,FS,FZ,Fn){var Fl;if(arguments.length>1){Fl=new SuperMap.IS.MarkParam();Fl.id=Fc;Fl.x=FY;Fl.y=FX;Fl.w=Fa;Fl.h=Fj;Fl.innerHtml=FW;Fl.className=FT;Fl.zIndex=Fb;Fl.groupID=FS;Fl.alignStyle=FZ;Fl.isFilter=Fn}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.MarkParam){Fl=arguments[0]}else{return }}var Fe=B2();if(Fl.isFilterMarks&&Fe<DP){var FR=new SuperMap.IS.MapCoord(Fl.x,Fl.y);var Ff=DH.length;while(Ff--){if(DH[Ff].id==Fl.id){DH[Ff].Init(Fl);DH[Ff].Draw();FL();return DH[Ff].div}}var FV=Eu.length;while(FV--){if(Eu[FV].id==Fl.id){if(!Ai.Contains(FR)){Eu[FV].Init(Fl);Eu[FV].Draw();FL();return Eu[FV].div}var Fd=Eu.splice(FV,1);Fd[0].Init(Fl);FP(Fd[0]);Fd[0].Draw();FL();return Fd[0].div}}var FU=null;var Fh=null;var Fi=EM.length;while(Fi--){FU=EM[Fi];Fh=FU.GetMarks();var Fg=Fh.length;var Fk;var Fm;while(Fg--){Fk=Fh[Fg];if(Fk.id==Fl.id){Fk.Init(Fl);Fm=Fk.region.GetCenter();if(FR.x<Fm.x-AJ||FR.x>Fm.x+AJ||FR.y<Fm.y-AJ||FR.y>Fm.y+AJ){Fk.region.RemoveMark(Fl.id);FP(Fk)}Fk.Draw();FL();return Fk.div}}}}else{var Fi=Bn.length;while(Fi--){var Fk=Bn[Fi];if(Fk.id==Fl.id){Fk.isShow=true;Fk.Init(Fl);Fk.Draw();FL();return Fk.div}}}return E5(Fl)}function Ev(FV){var FR;var FU=Bn.length;while(FU--){FR=Bn[FU];if(FR.id==FV){if(FR.region!=null){FR.region.RemoveMark(FV)}else{var FT=Eu.length;while(FT--){if(Eu[FT].id==FV){Eu.splice(FT,1);break}}var FS=DH.length;while(FS--){if(DH[FS].id==FV){DH.splice(FS,1);break}}}Bn.splice(FU,1);FR.Destroy();FR=null;FL();return }}}function Ax(){while(Bn.length>0){var FR=Bn.pop();FR.Destroy();FR=null}FL();while(EM.length){region=EM.pop();marks=region.GetMarks();var FS=marks.length;while(FS--){marks[FS].region=null}region.ClearMarks();region=null;delete region}while(Eu.length){Eu.pop()}while(DH.length){DH.pop()}}function Ec(){var FR;var FS=new Array();this.GetCenter=function(){return FR};this.AddMark=function(FT){if(FR==null){FR=FT.GetCenter()}FT.region=this;FS.push(FT)};this.GetMarks=function(){return FS};this.ClearMarks=function(){var FU=null;var FT=FS.length;while(FT--){FU=FS.pop();FU=null;delete FU}FS=new Array()};this.RemoveMark=function(FU){var FT=FS.length;while(FT--){if(FU==FS[FT].id){FS[FT].region=null;FS.splice(FT,1);if(FT==0&&FS.length>0){FS[0].isShow=true;FS[0].Draw()}break}}};this.Update=function(){var FU=1;if(!this.IsInBounds()){FU=0}else{if(FS.length>0&&FS[0].div.style.display!="block"){FS[0].Show()}}var FT=FS.length;while(FT-->FU){FS[FT].Hide()}};this.IsInBounds=function(FY){if(!FY){FY=Ai}var FU=true;var FW=FY.leftBottom.x;var FV=FY.leftBottom.y;var FX=FY.rightTop.x;var FT=FY.rightTop.y;if(FR.x+AJ<FW||FR.x-AJ>FX){FU=false}if(FU&&(FR.y-AJ>FT||FR.y+AJ<FV)){FU=false}return FU}}function Ed(){var FR=EM.length;while(FR--){EM[FR].Update()}}function H(FY){var FZ=new Array();var FV=FY.length;var FT;var FW;while(FV--){FT=FY[FV];if(!FT.isFilter){if(FT.drawed){FT.Reposition()}else{FT.Draw()}continue}FW=FT.GetCenter();if(!Ai.Contains(FW)){FT.isShow=false;FT.Hide();FZ.push(FT)}else{var FX=null;var FS=false;var FR;var FU=EM.length;while(FU--){FX=EM[FU];FR=FX.GetCenter();if(FW.x>=FR.x-AJ&&FW.x<=FR.x+AJ&&FW.y>=FR.y-AJ&&FW.y<=FR.y+AJ){FT.isShow=false;FT.Hide();FX.AddMark(FT);FS=true;break}}if(!FS){FX=new Ec();FT.isShow=true;FX.AddMark(FT);EM.push(FX)}}if(FT.drawed){FT.Reposition()}else{FT.Draw()}}Eu=FZ}function D4(){var FT=B2();AJ=Ez(Ae/2,FT);Ai=Dk();var FW=Ai.Width();var FZ=Ai.Height();Ai.leftBottom.x=Ai.leftBottom.x-FW*DL;Ai.leftBottom.y=Ai.leftBottom.y-FZ*DL;Ai.rightTop.x=Ai.rightTop.x+FW*DL;Ai.rightTop.y=Ai.rightTop.y+FZ*DL;if(Db.isFilterMarks&&FT<DP){var FR=Eu;Ce=FT;var Fb;var Fc;var FV=EM.length;while(FV--){Fb=EM.pop();Fc=Fb.GetMarks();var FU=Fc.length;while(FU--){Fc[FU].region=null}Fb.ClearMarks();Fb=null;delete Fb}FR=Bn;H(FR);Ed()}else{var FV=Bn.length;var FS;var FY;var FX;var Fa;while(FV--){FS=Bn[FV];Fa=FS.GetCenter();if(Ai.Contains(Fa)){FS.Reposition();FS.isShow=true;if(FS.drawed){FS.Show()}else{FS.Draw()}}else{FS.Hide()}}}}function FB(){var FR=this;var Fa=document.createElement("div");Fa.mk=this;this.div=Fa;var Ff=0,Fe=0,FX=0,FW=0;var Fl=new SuperMap.IS.MapCoord(0,0);var Fd=0;var Fb=0;var Fc=Dw+1;var FU=new Array(Fc);var Fh=new Array(Fc);this.isShow=true;this.drawed=false;this.isFilter=true;this.Hide=function(){Fa.style.display="none"};this.Show=function(){Fa.style.display="block"};this.Init=function(Fm){this.id=Fm.id;this.x=Fm.x;this.y=Fm.y;this.w=Fm.w;this.h=Fm.h;this.innerHtml=Fm.innerHtml;this.className=Fm.className;this.zIndex=Fm.zIndex;this.groupID=Fm.groupID;this.alignStyle=Fm.alignStyle;this.region;if(typeof (Fm.isFilter)=="boolean"){this.isFilter=Fm.isFilter}Fl.x=Fm.x;Fl.y=Fm.y;Fd=Fm.w;Fb=Fm.h};this.Destroy=function(){Fa.mk=null;while(Fa.childNodes.length>0){Fa.removeChild(Fa.childNodes[0])}Fa.innerHtml=null;FZ();Fa=null;this.div=null;while(FU.length>0){FU.pop()}FU=null;while(Fh.length>0){Fh.pop()}Fh=null;this.region=null};this.GetCenter=function(){return new SuperMap.IS.MapCoord(Fl.x,Fl.y)};this.Draw=function(){if(!this.isShow){this.Hide();return }Fa.id=this.id;Fa.className=this.className;Fa.style.position="absolute";Fa.innerHTML=this.innerHtml;if(!this.zIndex){Fa.style.zIndex=DX}else{Fa.style.zIndex=this.zIndex}if(!Db.fixedView){Fa.detachEvent("onmousedown",Ao);Fa.detachEvent("ondblclick",Fg);Fa.detachEvent("onmousewheel",FS);Fa.attachEvent("onmousedown",Ao);Fa.attachEvent("ondblclick",Fg);Fa.attachEvent("onmousewheel",FS)}var Fm=N.MapCoordToPixel(Fl,Ac.mapScale);if(Fm){Ff=_Round(Fm.x-F);Fe=_Round(Fm.y-C);FX=Ff;FW=Fe;FT();Fi(0);if(this.isShow){Fa.style.display="block"}}else{Fa.style.display="none"}FZ();EY(this.groupID,this.div);_AdjustCustomMarkPosition(this.id,this.alignStyle);this.drawed=true};function Fj(){var Fn=Dw;for(var Fm=0;Fm<=Fn;Fm++){FU[Fm]=Ff-Fd/2;Fh[Fm]=Fe-Fb/2}}function FT(){var Fp=Dw;for(var Fo=0;Fo<=Fp;Fo++){var Fn=Fo/Fp;var Fm=1-Fn;FU[Fo]=_Floor(Fm*Ff+Fn*FX-Fd/2);Fh[Fo]=_Floor(Fm*Fe+Fn*FW-Fb/2)}}function Fi(Fm){Fa.style.left=FU[Fm]+"px";Fa.style.top=Fh[Fm]+"px";_AdjustCustomMarkPosition(FR.id,FR.alignStyle)}function Fk(){var Fm=0;Fm=Ff;Ff=FX;FX=Fm;Fm=Fe;Fe=FW;FW=Fm}function FY(){var Fm=N.MapCoordToPixel(Fl,Ac.mapScale);if(Fm){Ff=_Round(Fm.x-F);Fe=_Round(Fm.y-C);Fj();Fi(0);if(this.isShow){Fa.style.display="block"}}else{Fa.style.display="none"}}function FV(Fp,Fo,Fn){Ff-=Cv;Fe-=Cu;var Fm=N.MapCoordToPixel(Fl,Fn);if(Fm){FX=_Round(Fm.x-Fp);FW=_Round(Fm.y-Fo);FT();if(this.isShow){Fa.style.display="block"}}else{Fa.style.display="none"}}function FZ(){if(Fa.parentNode!=null){Fa.parentNode.removeChild(Fa)}}function Fg(Fm){Fm=_GetEvent(Fm);_CancelBubble(Fm);if(Ds||D){return false}var Fn=Bx.MakeCopy();Fn.SetMapCenter(Fl);if(!Fm.altKey){Fn.SetMapScale(Ac.mapScale*2)}else{Fn.SetMapScale(Ac.mapScale/2)}AV(Fn);return false}function FS(Fm){Fm=_GetEvent(Fm);_CancelBubble(Fm);if(Ds||D){return false}var Fn=_GetMouseScrollDelta(Fm);if(Fn>0){if(!DQ.wheelZoomByMouse){AF()}else{Bb(Fm)}}else{if(Fn<0){if(!DQ.wheelZoomByMouse){O()}else{Ej(Fm)}}}return false}this.ClearSteps=Fj;this.SetFactor=Fi;this.SwapStates=Fk;this.Reposition=FY;this.PrepareForZoom=FV;this.RemoveFromMap=FZ}function E0(FS,FT,Fa,FW,Fc,FX,FY,FZ,FV,FR){var FU;if(arguments.length>1){FU=new SuperMap.IS.LineParam();FU.id=FS;FU.xs=FT;FU.ys=Fa;FU.strokeWeight=FW;FU.strokeColor=Fc;FU.opacity=FX;FU.zIndex=FY;FU.groupID=FZ;FU.parts=FV;FU.arrowType=FR}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.LineParam){FU=arguments[0]}else{return }}if(FU.id==null||FU.xs==null||FU.ys==null){return null}var Fb=new C0("line");Fb.Init(FU);FK.push(Fb);FN();return Fb}function B5(FS,FT,Fb,FX,Fd,FY,FZ,Fa,FV,FR){var FU;if(arguments.length>1){FU=new SuperMap.IS.LineParam();FU.id=FS;FU.xs=FT;FU.ys=Fb;FU.strokeWeight=FX;FU.strokeColor=Fd;FU.opacity=FY;FU.zIndex=FZ;FU.groupID=Fa;FU.parts=FV;FU.arrowType=FR}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.LineParam){FU=arguments[0]}else{return }}if(FU.id==null||FU.xs==null||FU.ys==null){return null}for(var FW=0;FW<FK.length;FW++){var Fc=FK[FW];if(Fc.id==FU.id){Fc.Init(FU);FN();return Fc}}return E0(FU)}function Et(FT){for(var FS=0;FS<FK.length;FS++){var FR=FK[FS];if(FR.id==FT){FK.splice(FS,1);FR.Destroy();FN();return }}}function D6(){while(FK.length>0){FK.pop().Destroy()}FN()}function Br(){for(var FR=0;FR<FK.length;FR++){FK[FR].Reposition()}}function B6(){for(var FR=0;FR<FQ.length;FR++){FQ[FR].Reposition()}}function Eg(){for(var FR=0;FR<Bw.length;FR++){Bw[FR].Reposition()}}function At(){for(var FR=0;FR<Cb.length;FR++){Cb[FR].Reposition()}}function Cj(FR,FT,Fb,FW,Fc,FS,Fa,FX,FZ,FV){var FU;if(arguments.length>1){FU=new SuperMap.IS.PolygonParam();FU.id=FR;FU.xs=FT;FU.ys=Fb;FU.strokeWeight=FW;FU.strokeColor=Fc;FU.fillColor=FS;FU.fillOpacity=Fa;FU.zIndex=FX;FU.groupID=FZ;FU.parts=FV}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.PolygonParam){FU=arguments[0]}else{return }}if(FU.id==null||FU.xs==null||FU.ys==null){return null}var FY=new C0("polygon");FY.Init(FU);FQ.push(FY);q();return FY}function AT(FR,FT,Fc,FX,Fd,FS,Fb,FY,Fa,FV){var FU;if(arguments.length>1){FU=new SuperMap.IS.PolygonParam();FU.id=FR;FU.xs=FT;FU.ys=Fc;FU.strokeWeight=FX;FU.strokeColor=Fd;FU.fillColor=FS;FU.fillOpacity=Fb;FU.zIndex=FY;FU.groupID=Fa;FU.parts=FV}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.PolygonParam){FU=arguments[0]}else{return }}if(FU.id==null||FU.xs==null||FU.ys==null){return null}var FZ=null;for(var FW=0;FW<FQ.length;FW++){FZ=FQ[FW];if(FZ.id==FU.id){FZ.Init(FU);q();return FZ}}FZ=null;return Cj(FU)}function DC(FT){for(var FS=0;FQ&&FS<FQ.length;FS++){var FR=FQ[FS];if(FR.id==FT){FQ.splice(FS,1);FR.Destroy();q();return }}}function Ct(){while(FQ.length>0){FQ.pop().Destroy()}q()}function E7(FS,FR,Fc,FX,FW,Fb,FT,Fa,FY,FZ){var FV;if(arguments.length>1){FV=new SuperMap.IS.EllipseParam();FV.id=FS;FV.center=FR;FV.semiMajorAxis=Fc;FV.semiMinorAxis=FX;FV.strokeWeight=FW;FV.strokeColor=Fb;FV.fillColor=FT;FV.fillOpacity=Fa;FV.zIndex=FY;FV.groupID=FZ}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.EllipseParam){FV=arguments[0]}else{return }}if(FV.id==null||FV.center==null||FV.semiMajorAxis==null||FV.semiMinorAxis==null){return null}var FU=new C0("ellipse");FU.Init(FV);Bw.push(FU);EF();return FU}function Ci(FS,FR,Fd,FY,FX,Fc,FT,Fb,FZ,Fa){var FV;if(arguments.length>1){FV=new SuperMap.IS.EllipseParam();FV.id=FS;FV.center=FR;FV.semiMajorAxis=Fd;FV.semiMinorAxis=FY;FV.strokeWeight=FX;FV.strokeColor=Fc;FV.fillColor=FT;FV.fillOpacity=Fb;FV.zIndex=FZ;FV.groupID=Fa}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.EllipseParam){FV=arguments[0]}else{return }}if(FV.id==null||FV.center==null||FV.semiMajorAxis==null||FV.semiMinorAxis==null){return null}var FU=null;for(var FW=0;FW<Bw.length;FW++){FU=Bw[FW];if(FU.id==FV.id){FU.Init(FV);EF();return FU}}FU=null;return E7(FV)}function e(FT){for(var FR=0;Bw&&FR<Bw.length;FR++){var FS=Bw[FR];if(FS.id==FT){Bw.splice(FR,1);FS.Destroy();EF();return }}}function K(){while(Bw.length>0){Bw.pop().Destroy()}EF()}function AN(FS,FR,Fd,FZ,FY,FT,FW,Fc,FX,Fa,Fb){var FV;if(arguments.length>1){FV=new SuperMap.IS.PolygonParam();FV.id=FS;FV.center=FR;FV.semiMajorAxis=Fd;FV.semiMinorAxis=FZ;FV.startAngle=FY;FV.endAngle=FT;FV.strokeWeight=FW;FV.strokeColor=Fc;FV.opacity=FX;FV.zIndex=Fa;FV.groupID=Fb}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.EllipticArcParam){FV=arguments[0]}else{return }}if(FV.id==null||FV.center==null||FV.semiMajorAxis==null||FV.semiMinorAxis==null||FV.startAngle==null||FV.endAngle==null){return null}var FU=new C0("ellipticArc");FU.Init(FV);Cb.push(FU);FD();return FU}function Au(FS,FR,Fe,Fa,FZ,FT,FX,Fd,FY,Fb,Fc){var FV;if(arguments.length>1){FV=new SuperMap.IS.EllipticArcParam();FV.id=FS;FV.center=FR;FV.semiMajorAxis=Fe;FV.semiMinorAxis=Fa;FV.startAngle=FZ;FV.endAngle=FT;FV.strokeWeight=FX;FV.strokeColor=Fd;FV.opacity=FY;FV.zIndex=Fb;FV.groupID=Fc}else{if(arguments.length==1&&arguments[0].constructor==SuperMap.IS.EllipticArcParam){FV=arguments[0]}else{return }}if(FV.id==null||FV.center==null||FV.semiMajorAxis==null||FV.semiMinorAxis==null||FV.startAngle==null||FV.endAngle==null){return null}var FU=null;for(var FW=0;FW<Cb.length;FW++){FU=Cb[FW];if(FU.id==FV.id){FU.Init(FV);FD();return FU}}FU=null;return AN(FV)}function Ea(FT){for(var FR=0;Cb&&FR<Cb.length;FR++){var FS=Cb[FR];if(FS.id==FT){Cb.splice(FR,1);FS.Destroy();FD();return }}}function AR(){while(Cb.length>0){Cb.pop().Destroy()}FD()}function CF(FR){if(!FR){FR="unClassified"}var FS=document.getElementById(DQ.id+"_"+FR);if(FS&&FS.parentNode){FS.parentNode.removeChild(FS)}}_Point=function(FS,FR){this.x=FS;this.y=FR};this.ComputePoint=DW;function DW(Fe,FZ,FS,FY,FX){var FT=Fe.x;var FR=Fe.y;var Fi=FZ.x;var Ff=FZ.y;var FU=Math.abs(FT-Fi);var Fk=Math.abs(FR-Ff);var Fd=Math.sqrt(FU*FU+Fk*Fk);var Fb=Math.asin(Fk/Fd);var Fh=30/180*Math.PI;var Fc=Fb-Fh;var Fa=90/180*Math.PI-Fb-Fh;var FW=0;var Fj=0;var FV=0;var Fg=0;if(FS<5){FS=5}if(Fi>=FT&&Ff>=FR){FW=Fi-FS*Math.cos(Fc);Fj=Ff-FS*Math.sin(Fc);FV=Fi-FS*Math.sin(Fa);Fg=Ff-FS*Math.cos(Fa);FY.x=parseInt(FW);FY.y=parseInt(Fj);FX.x=parseInt(FV);FX.y=parseInt(Fg);return }else{if(Fi<=FT&&Ff>=FR){FW=Fi+FS*Math.cos(Fc);Fj=Ff-FS*Math.sin(Fc);FV=Fi+FS*Math.sin(Fa);Fg=Ff-FS*Math.cos(Fa);FY.x=parseInt(FW);FY.y=parseInt(Fj);FX.x=parseInt(FV);FX.y=parseInt(Fg);return }else{if(Fi>=FT&&Ff<=FR){FW=Fi-FS*Math.cos(Fc);Fj=Ff+FS*Math.sin(Fc);FV=Fi-FS*Math.sin(Fa);Fg=Ff+FS*Math.cos(Fa);FY.x=parseInt(FW);FY.y=parseInt(Fj);FX.x=parseInt(FV);FX.y=parseInt(Fg);return }else{if(Fi<=FT&&Ff<=FR){FW=Fi+FS*Math.cos(Fc);Fj=Ff+FS*Math.sin(Fc);FV=Fi+FS*Math.sin(Fa);Fg=Ff+FS*Math.cos(Fa);FY.x=parseInt(FW);FY.y=parseInt(Fj);FX.x=parseInt(FV);FX.y=parseInt(Fg);return }}}}}function C0(Fm){var F4=Fm;var GB="3pt";var Fe="#316AC5";var Fs="#316AC5";var Fy="0.6";var Fh=true;var F1=null;var Fk=null;var FS=null;var GC=null;var Fu=null;var Fi=null;var F3="";var Fv="";var GA="";var Fg="";var FX="";var FV=0;var FU="";var Fb=0;var FZ=0;var Fp=0;var Fn=0;var F8=null;var F7=null;var FY=null;var F9=null;var Fq=null;var FT=null;var Fl=0;var FR=360;var Fw=null;var Fr=0;var F0=null;var Fa=null;function F5(GJ,GH,GO,GR,GM,GG,GP,GI,GD,GK,GU,GE,GS,GQ,GL,GF){var GT=null;if(arguments.length>1){switch(Fm){case"line":GT=new SuperMap.IS.LineParam();GT.id=GJ;GT.xs=GH;GT.ys=GO;GT.strokeWeight=GR;GT.strokeColor=GM;GT.opacity=GP;GT.zIndex=GI;GT.groupID=GD;GT.parts=GK;GT.arrowType=GF;break;case"polygon":GT=new SuperMap.IS.PolygonParam();GT.id=GJ;GT.xs=GH;GT.ys=GO;GT.strokeWeight=GR;GT.strokeColor=GM;GT.fillColor=GG;GT.fillOpacity=GP;GT.zIndex=GI;GT.groupID=GD;GT.parts=GK;break;case"ellipse":GT=new SuperMap.IS.EllipseParam();GT.id=GJ;GT.center=GU;GT.semiMajorAxis=GE;GT.semiMinorAxis=GS;GT.strokeWeight=GR;GT.strokeColor=GM;GT.fillColor=GG;GT.fillOpacity=GP;GT.zIndex=GI;GT.groupID=GD;break;case"ellipticArc":GT=new SuperMap.IS.EllipticArcParam();GT.id=GJ;GT.center=GU;GT.semiMajorAxis=GE;GT.semiMinorAxis=GS;GT.startAngle=GQ;GT.endAngle=GL;GT.strokeWeight=GR;GT.strokeColor=GM;GT.fillColor=GG;GT.opacity=GP;GT.zIndex=GI;GT.groupID=GD;break}}else{if(arguments.length==1&&(arguments[0].constructor==SuperMap.IS.LineParam||arguments[0].constructor==SuperMap.IS.PolygonParam||arguments[0].constructor==SuperMap.IS.EllipseParam||arguments[0].constructor==SuperMap.IS.EllipticArcParam)){GT=arguments[0]}else{return }}if(!GT.strokeWeight){GT.strokeWeight=GB}else{GT.strokeWeight+=""}if(!GT.strokeColor){GT.strokeColor=Fe}if(!GT.fillColor){GT.fillColor=Fs}if(GT.fillOpacity==null||GT.fillOpacity<0){GT.fillOpacity=Fy}if(!GT.zIndex){GT.zIndex=DX}this.id=GT.id;F3=GT.id;if(GT.parts==null){GT.parts=new Array();if(GT.xs!=null&&GT.xs.length!=0){GT.parts[0]=GT.xs.length}}this.parts=GT.parts;FY=new Array();while(FY.length>0){FY.pop()}for(var GN=0;GN<GT.parts.length;GN++){FY.push(GT.parts[GN])}if(GT.arrowType){Fr=GT.arrowType}if(!Fr){Fr=0}this.center=GT.center;this.semiMajorAxis=GT.semiMajorAxis;this.semiMinorAxis=GT.semiMinorAxis;this.strokeWeight=GT.strokeWeight;this.strokeColor=GT.strokeColor;this.fillColor=GT.fillColor;this.fillOpacity=GT.fillOpacity;this.zIndex=GT.zIndex;this.groupID=GT.groupID;FU=GT.groupID;Fv=GT.strokeWeight;GA=GT.strokeColor;Fg=GT.fillColor;FX=GT.fillOpacity;FV=GT.zIndex;if(GT.xs!=null){this.xs=GT.xs;F8=GT.xs.concat();Fb=F8[0];Fp=F8[F8.length-1]}if(GT.ys!=null){this.ys=GT.ys;F7=GT.ys.concat();FZ=F7[0];Fn=F7[F7.length-1]}F9=GT.center;Fq=GT.semiMajorAxis;FT=GT.semiMinorAxis;if(GT.startAngle!=null){this.startAngle=GT.startAngle;Fl=GT.startAngle}if(GT.endAngle!=null){this.endAngle=GT.endAngle;FR=GT.endAngle}Fd()}function FW(){Fz();if(FS){FS.clear()}FY=F8=F7=F1=FS=Fk=Fu=Fi=null;F0=null;Fa=null}function Fz(){if(F1&&F1.parentNode!=null){F1.parentNode.removeChild(F1);if(F0){F0.parentNode.removeChild(F0)}}if(Fk&&Fk.parentNode!=null){Fk.parentNode.removeChild(Fk)}}function Ft(){if(!Fh){F2();return }if(F1){F1.style.display="block";if(F0){F0.style.display="block"}}if(Fk){Fk.style.display="block"}}function F2(){if(F1){F1.style.display="none";if(F0){F0.style.display="none"}}if(Fk){Fk.style.display="none"}}function Fc(GD){Fh=GD;if(!Fh){F2()}}function Fd(){Fo()}function Fj(){Fo()}function Fo(){Ff()}function Fx(GG){var GF=new SuperMap.IS.MapCoord();for(var GE=0;GE<F8.length;GE++){GF.x=F8[GE];GF.y=F7[GE];var GD=BI(GF);GG.push((GD.x+Cv));GG.push((GD.y+Cu))}GF=null}function Ff(){if(!Dy){var GR=0;var GJ=0;var Gb=0;var GX=0;switch(F4){case"polygon":case"line":var Ga=new Array();var Gi=new SuperMap.IS.MapCoord();for(var Gd=0;Gd<F8.length;Gd++){Gi.x=F8[Gd];Gi.y=F7[Gd];var GD=BI(Gi);if(Gd==0){GR=GD.x+Cv;GJ=GD.y+Cu;Gb=GD.x+Cv;GX=GD.y+Cu}if(GR>GD.x+Cv){GR=GD.x+Cv}if(GJ>GD.y+Cu){GJ=GD.y+Cu}if(Gb<GD.x+Cv){Gb=GD.x+Cv}if(GX<GD.y+Cu){GX=GD.y+Cu}Ga.push(new SuperMap.IS.PixelCoord(GD.x+Cv,GD.y+Cu))}Gi=null;break;case"ellipse":case"ellipticArc":var Gg=BI(F9);Fq=parseInt(CX(Fq,B2()));FT=parseInt(CX(FT,B2()));GR=Gg.x-Fq;GJ=Gg.y-FT;Gb=Gg.x+Fq;GX=Gg.y+FT;break}GR-=parseInt(Fv);GJ-=parseInt(Fv);Gb+=parseInt(Fv);GX+=parseInt(Fv);if(F4=="line"&&Fr!=SuperMap.IS.ArrowType.none){GR-=parseInt((Fv/10)*30);GJ-=parseInt((Fv/10)*30);Gb+=parseInt((Fv/10)*30);GX+=parseInt((Fv/10)*30)}if(!Fk){Fk=document.createElement("div");Fk.id=F3;Fk.style.position="absolute";Fk.unselectable="on";Fk.style.zIndex=FV;EY(FU,Fk)}else{Fk.removeChild(GC)}Fk.style.left=GR+"px";Fk.style.top=GJ+"px";GC=document.createElement("canvas");GC.id=F3;GC.width=Math.abs(Gb-GR);GC.height=Math.abs(GX-GJ);Fk.appendChild(GC);Fw=GC.getContext("2d");if(FX!=1){Fk.style.opacity=FX}if(Fh){Fk.style.display="block";Fk.style.visibility="visible"}else{Fk.style.display="none";Fk.style.visibility=""}Fw.translate(-GR,-GJ);Fw.lineWidth=parseInt(Fv);Fw.lineCap="round";Fw.lineJoin="round";Fw.strokeStyle=GA;Fw.fillStyle=Fg;switch(F4){case"polygon":case"line":var GP=0;for(var Gd=0;Gd<FY.length;Gd++){var GQ=FY[Gd];var Gi=new SuperMap.IS.MapCoord();for(var Gc=0;Gc<GQ;Gc++){if(Gc==0){Fw.beginPath();Fw.moveTo(Ga[GP+Gc].x,Ga[GP+Gc].y)}else{Fw.lineTo(Ga[GP+Gc].x,Ga[GP+Gc].y)}}if(F4=="polygon"){Fw.closePath();Fw.fill()}Fw.stroke();GP=GP+FY[Gd]}break;case"ellipse":case"ellipticArc":var Gg=BI(F9);var GI=Math.max(Fq,FT);var GG=Math.PI/180;var Gh=Fq/FT;Fw.translate(Gg.x,Gg.y);if(GI==Fq){Fw.scale(1,1/Gh)}else{Fw.scale(Gh,1)}Fw.translate(-Gg.x,-Gg.y);if((Fl+FR)%360==0){Fw.arc(Gg.x,Gg.y,GI,-Fl*GG,FR*GG,true)}else{Fw.arc(Gg.x,Gg.y,GI,-Fl*GG,-FR*GG,true)}if(_ygPos.browser=="opera"){if(F4=="ellipse"){Fw.fill()}Fw.stroke();Fw.translate(Gg.x,Gg.y);if(GI==Fq){Fw.scale(1,Gh)}else{Fw.scale(1/Gh,1)}Fw.translate(-Gg.x,-Gg.y)}else{Fw.translate(Gg.x,Gg.y);if(GI==Fq){Fw.scale(1,Gh)}else{Fw.scale(1/Gh,1)}Fw.translate(-Gg.x,-Gg.y);if(F4=="ellipse"){Fw.fill()}Fw.stroke()}break}if(F4=="line"&&Fr!=SuperMap.IS.ArrowType.none){var Ga=new Array();Fx(Ga);var GU=new _Point(0,0);var GT=new _Point(0,0);switch(Fr){case SuperMap.IS.ArrowType.start:var GP=0;for(var Gd=0;Gd<FY.length;Gd++){var GQ=FY[Gd];if(GQ<2){continue}var GV=new _Point(Ga[GP],Ga[GP+1]);var GS=new _Point(Ga[GP+2],Ga[GP+3]);if(!GV.x||!GV.y||!GS.x||!GS.y){continue}DQ.ComputePoint(GS,GV,(Fv/10)*30,GU,GT);Fw.beginPath();Fw.moveTo(GV.x,GV.y);Fw.lineTo(GU.x,GU.y);Fw.stroke();Fw.beginPath();Fw.moveTo(GV.x,GV.y);Fw.lineTo(GT.x,GT.y);Fw.stroke();GP=GP+FY[Gd]*2}break;case SuperMap.IS.ArrowType.end:var GP=0;for(var Gd=0;Gd<FY.length;Gd++){var GQ=FY[Gd];if(GQ<2){continue}var GV=new _Point(Ga[GP+FY[Gd]*2-4],Ga[GP+FY[Gd]*2-3]);var GS=new _Point(Ga[GP+FY[Gd]*2-2],Ga[GP+FY[Gd]*2-1]);if(!GV.x||!GV.y||!GS.x||!GS.y){continue}DQ.ComputePoint(GV,GS,(Fv/10)*30,GU,GT);Fw.beginPath();Fw.moveTo(GS.x,GS.y);Fw.lineTo(GU.x,GU.y);Fw.stroke();Fw.beginPath();Fw.moveTo(GS.x,GS.y);Fw.lineTo(GT.x,GT.y);Fw.stroke();GP=GP+FY[Gd]*2}break;case SuperMap.IS.ArrowType.startAndEnd:var GP=0;for(var Gd=0;Gd<FY.length;Gd++){var GQ=FY[Gd];if(GQ<2){continue}var GV=new _Point(Ga[GP+FY[Gd]*2-4],Ga[GP+FY[Gd]*2-3]);var GS=new _Point(Ga[GP+FY[Gd]*2-2],Ga[GP+FY[Gd]*2-1]);if(!GV.x||!GV.y||!GS.x||!GS.y){continue}DQ.ComputePoint(GV,GS,(Fv/10)*30,GU,GT);Fw.beginPath();Fw.moveTo(GS.x,GS.y);Fw.lineTo(GU.x,GU.y);Fw.stroke();Fw.beginPath();Fw.moveTo(GS.x,GS.y);Fw.lineTo(GT.x,GT.y);Fw.stroke();GV=new _Point(Ga[GP],Ga[GP+1]);GS=new _Point(Ga[GP+2],Ga[GP+3]);if(!GV.x||!GV.y||!GS.x||!GS.y){continue}DQ.ComputePoint(GS,GV,(Fv/10)*30,GU,GT);Fw.beginPath();Fw.moveTo(GV.x,GV.y);Fw.lineTo(GU.x,GU.y);Fw.stroke();Fw.beginPath();Fw.moveTo(GV.x,GV.y);Fw.lineTo(GT.x,GT.y);Fw.stroke();GP=GP+FY[Gd]*2}break;default:break}}Fw=null;return false}var GN=false;if(F1){GN=true}var GZ="";switch(F4){case"polygon":case"line":var Ga=new Array();Fx(Ga);var GP=0;var GM=new Array();var GE=new Array();for(var Gd=0;Gd<FY.length;Gd++){GM[Gd]="m"+Ga[GP]+","+Ga[GP+1];GE[Gd]="l"+Ga.slice(GP+2,(GP+FY[Gd]*2)).join(",");if(F4=="polygon"){GZ=GZ+(GM[Gd]+" "+GE[Gd]+" x ")}else{GZ=GZ+(GM[Gd]+" "+GE[Gd]+" e ")}GP=GP+FY[Gd]*2}GM=null;GE=null;break;case"ellipse":case"ellipticArc":var Ga=BI(F9);var GK=Math.pow(2,16);var GL=FR-Fl;if(GL<0){GL=360+GL}var GZ="m "+Ga.x+","+Ga.y+" al "+Ga.x+","+Ga.y+","+parseInt(CX(Fq,B2()))+","+parseInt(CX(FT,B2()))+","+Fl*GK+","+(GL)*GK+" e";break}if(!GN){F1=document.createElement("v:shape");F1.setAttribute("path",GZ)}else{F1.path.value=GZ}F1.coordsize=(Aj.clientWidth)+","+(Aj.clientHeight);F1.id=F3;if(F4=="polygon"||F4=="ellipse"){F1.filled="true"}else{F1.filled="false"}F1.style.zIndex=FV;F1.unselectable="on";F1.style.position="absolute";F1.style.border="0px";F1.style.width=Aj.clientWidth;F1.style.height=Aj.clientHeight;if(Fh){F1.style.display="block"}else{F1.style.display="none"}if(F4=="polygon"||F4=="ellipse"){if(!GN){Fu=document.createElement("v:fill");F1.appendChild(Fu)}if(FX!=1){Fu.setAttribute("opacity",FX)}Fu.setAttribute("color",Fg)}if(!GN){Fi=document.createElement("v:stroke");F1.appendChild(Fi)}if(F4=="line"&&Fr!=SuperMap.IS.ArrowType.none){var GP=0;var Ga=new Array();Fx(Ga);var Gf=new Array();var Ge=new Array();var GU=new _Point(0,0);var GT=new _Point(0,0);var GO="";switch(Fr){case SuperMap.IS.ArrowType.start:for(var Gd=0;Gd<FY.length;Gd++){if(FY[Gd]<2){continue}var GV=new _Point(Ga[GP],Ga[GP+1]);var GS=new _Point(Ga[GP+2],Ga[GP+3]);if(!GV.x||!GV.y||!GS.x||!GS.y){continue}DQ.ComputePoint(GS,GV,(Fv/10)*30,GU,GT);GO+="m "+GV.x+", "+GV.y+" l "+GU.x+","+GU.y+" e ";GO+="m "+GV.x+", "+GV.y+" l "+GT.x+","+GT.y+" e ";GP=GP+FY[Gd]*2}break;case SuperMap.IS.ArrowType.end:for(var Gd=0;Gd<FY.length;Gd++){if(FY[Gd]<2){continue}var GV=new _Point(Ga[GP+FY[Gd]*2-4],Ga[GP+FY[Gd]*2-3]);var GS=new _Point(Ga[GP+FY[Gd]*2-2],Ga[GP+FY[Gd]*2-1]);if(!GV.x||!GV.y||!GS.x||!GS.y){continue}DQ.ComputePoint(GV,GS,(Fv/10)*30,GU,GT);GO+="m "+GS.x+", "+GS.y+" l "+GU.x+","+GU.y+" e ";GO+="m "+GS.x+", "+GS.y+" l "+GT.x+","+GT.y+" e ";GP=GP+FY[Gd]*2}break;case SuperMap.IS.ArrowType.startAndEnd:for(var Gd=0;Gd<FY.length;Gd++){if(FY[Gd]<2){continue}var GY=new _Point(Ga[GP],Ga[GP+1]);var GH=new _Point(Ga[GP+2],Ga[GP+3]);if(!GY.x||!GY.y||!GH.x||!GH.y){continue}DW(GH,GY,(Fv/10)*30,GU,GT);GO+="m "+GY.x+", "+GY.y+" l "+GU.x+","+GU.y+" e ";GO+="m "+GY.x+", "+GY.y+" l "+GT.x+","+GT.y+" e ";var GW=new _Point(Ga[GP+FY[Gd]*2-4],Ga[GP+FY[Gd]*2-3]);var GF=new _Point(Ga[GP+FY[Gd]*2-2],Ga[GP+FY[Gd]*2-1]);if(!GW.x||!GW.y||!GF.x||!GF.y){continue}DQ.ComputePoint(GW,GF,(Fv/10)*30,GU,GT);GO+="m "+GF.x+", "+GF.y+" l "+GU.x+","+GU.y+" e ";GO+="m "+GF.x+", "+GF.y+" l "+GT.x+","+GT.y+" e ";GP=GP+FY[Gd]*2}break;default:break}if(!GN){F0=document.createElement("v:shape");F0.setAttribute("path",GO)}else{F0.path.value=GO}F0.coordsize=(Aj.clientWidth)+","+(Aj.clientHeight);F0.id=F3;F0.style.zIndex=FV;F0.unselectable="on";F0.style.position="absolute";F0.style.border="0px";F0.style.width=Aj.clientWidth;F0.style.height=Aj.clientHeight;F0.filled="false";if(!GN){Fa=document.createElement("v:stroke");F0.appendChild(Fa)}Fa.setAttribute("weight",Fv);Fa.setAttribute("color",GA);Fa.setAttribute("joinstyle","round");Fa.setAttribute("endcap","round");Fa.setAttribute("opacity","0.75");if(!GN){EY(FU,F0)}}Fi.setAttribute("weight",Fv);Fi.setAttribute("color",GA);Fi.setAttribute("joinstyle","round");Fi.setAttribute("endcap","round");Fi.setAttribute("opacity","0.75");if(!GN){EY(FU,F1)}}function F6(){Fd()}this.Init=F5;this.Destroy=FW;this.RemoveFromMap=Fz;this.Show=Ft;this.Hide=F2;this.SetVisible=Fc;this.Start=Fd;this.Update=Fj;this.Reposition=F6}function EQ(){for(var FR=0;FR<FK.length;FR++){FK[FR].Start();FK[FR].Show()}for(var FR=0;FR<FQ.length;FR++){FQ[FR].Start();FQ[FR].Show()}for(var FR=0;FR<Bw.length;FR++){Bw[FR].Start();Bw[FR].Show()}for(var FR=0;FR<Cb.length;FR++){Cb[FR].Start();Cb[FR].Show()}}function By(){for(var FR=0;FR<FK.length;FR++){FK[FR].Hide()}for(var FR=0;FR<FQ.length;FR++){FQ[FR].Hide()}for(var FR=0;FR<Bw.length;FR++){Bw[FR].Hide()}for(var FR=0;FR<Cb.length;FR++){Cb[FR].Hide()}}function AP(){for(var FR=0;FR<FK.length;FR++){FK[FR].Update()}for(var FR=0;FR<FQ.length;FR++){FQ[FR].Update()}for(var FR=0;FR<Bw.length;FR++){Bw[FR].Update()}for(var FR=0;FR<Cb.length;FR++){Cb[FR].Update()}}function Bm(FR){Ev(FR)}function AS(FS,Fd,Fb,FT,Fe,Fc,FX,FV){var Fa="1000";var FU=0;var FZ=0;if(!Fd){return }if(!Fb){return }if(!FT){FT=100}if(!Fe){Fe=100}if(!FV){FV=0.5}if(FT<50){FT=50}if(Fe<50){Fe=50}if(!Fc){Fc="title"}if(!FX){FX="content"}var FW="white";var FR="";if(FV&&FV<1&&FV>0){FR="filter:alpha(opacity="+(FV)*100+");opacity:"+FV+";"}var FY="<div style='"+FR+"z-index:"+Fa+";width:"+FT*2+"px;height:"+Fe+"px;left:"+FU+"px;top:"+FZ+"px;color:"+FW+";font-size:12px;font-family:Verdana;position:absolute;border:0px solid white;'  ondblclick =_CancelBubble(window.event)  onmousemove =_CancelBubble(window.event) ><div style='position:absolute;left:"+FT/10+"px;top:"+Fe/2+"px;width:70%;height:50%;z-index:"+(Fa-3)+";'><img src='images/shadow.gif' style='width:100%;height:100%;' /></div><div style='position:absolute;cursor:default;left:0px;top:0px;width:50%;height:75%;z-index:"+(Fa-2)+";' onclick=_CancelBubble(window.event)><img src='images/form-white1.gif' style='width:100%;height:100%;' /></div><div style='position:absolute;cursor:default;left:"+FT/2+"px;top:"+Fe*3/4+"px;width:"+25*75/183+"%;height:25%;z-index:"+(Fa-2)+";'><img src='images/form-white2.gif' style='width:100%;height:100%;' /></div><div style='position:absolute;left:0px;top:0px;z-index:"+(Fa-1)+";width:100%;height:20px;><table border=0 cellspacing=0 cellpadding=0><tr><td style='width="+FT+"'><span style='width:"+(FT-12)+";color:orange;padding-left:3px;font-size:12px' >"+Fc+"</span></td><td align=right style='width:12'><span style='position:absolute;left:"+(FT-10)+"px;width:12px;border-width:0px;color:orange;' onclick='var infoWindow=document.getElementById(\""+FS+"\");infoWindow.parentNode.removeChild(infoWindow);infoWindow=null;'>X</span></td></tr></table><div style='width:"+(FT-12)+"px;height:"+(Fe*0.7-20-4)+"px;color: orange;line-height:14px;word-break:break-all;word-wrap:break-word;padding:3px;overflow:hidden'>"+FX+"</div></div>";B8(FS,Fd,Fb,FT,Fe*2,FY,null,null,null,null,false)}function BW(){return N.GetMapBounds()}function Dk(){var FY=new SuperMap.IS.PixelRect();var FR=FY.leftTop;var FX=FY.rightBottom;FR.x=Ac.pixelCenter.x-E/2;FR.y=Ac.pixelCenter.y-Q/2;FX.x=FR.x+E;FX.y=FR.y+Q;var FV=new SuperMap.IS.MapRect();var FW=FV.leftBottom;var FT=FV.rightTop;var FU=N.PixelToMapCoord(FR,Ac.mapScale);var FS=N.PixelToMapCoord(FX,Ac.mapScale);if(FU==null||FS==null){return FV}FW.x=FU.x;FW.y=FS.y;FT.x=FS.x;FT.y=FU.y;return FV}function EZ(){if(AB){return }AB=true;window.clearTimeout(BD);BD=null;var FT=true;if(Dv<G){for(var FU=0;FU<Eq.length;FU++){var FR=Eq[FU];if(FR==null){continue}for(var FS=0;FS<FR.length;FS++){if(FR[FS]&&!FR[FS].Loaded){FT=false;break}}}}else{Dv=0;for(var FU=0;FU<Eq.length;FU++){var FR=Eq[FU];if(FR==null){continue}for(var FS=0;FS<FR.length;FS++){if(FR[FS]&&!FR[FS].Loaded){FT=false;FR[FS].RefreshUrl();continue}}}}if(FT){Dv=0;Dq("onimagesload",new EventArguments(null,""))}else{Dv++;BD=setTimeout(EZ,200)}AB=false}function FJ(){if(A0){A0.innerHtml="";if(!A0.parentNode){BU.appendChild(A0)}return A0}var FR=document.createElement("DIV");var FT=FR.style;FT.position="absolute";FT.padding="0px";FT.margin="0px";FT.top="0px";FT.width=BU.style.width;FT.height=BU.style.height;FT.zIndex=DX;FT=null;var FS=document.createElement("div");FS.id="unClassified";FR.appendChild(FS);A0=FR;BU.appendChild(A0);FR=null;return A0}this.GetMapCenterX=r;this.GetMapCenterY=p;this.GetPixelCenterX=As;this.GetPixelCenterY=Ar;this.MapCoordToPixel=BI;this.PixelToMapCoord=R;this.GetMapScale=B2;this.GetZoomLevel=DS;this.GetMapBounds=BW;this.GetViewBounds=Dk;this.PixelToMapDistance=Ez;this.MapDistanceToPixel=CX;this.GetSize=CN;this.Resize=C4;this.Pan=EB;this.DynamicPan=C5;this.StopDynamicPan=k;this.PanToMapCoord=A5;this.ViewByBounds=Am;this.ViewByPoints=DB;this.ViewByPoint=DD;this.SetMapScale=AI;this.SetZoomLevel=Ek;this.ZoomIn=AF;this.ZoomOut=O;this.Zoom=d;this.SetCenterAndZoom=Cp;this.AttachEvent=EI;this.DetachEvent=DF;this.SetAnimationEnabled=AG;this.IsAnimationEnabled=EV;this.SetMapParam=AV;this.GetMapParam=B7;this.Debug=CY;this.GetOriginX=EP;this.GetOriginY=EO;this.GetOffsetX=B4;this.GetOffsetY=B3;this.GetContainerX=C7;this.GetContainerY=C6;this.GetAction=Az;this.SetAction=Ef;this.CustomLayer=new Object();var EX=this.CustomLayer;EX.AddMark=E5;EX.InsertMark=B8;EX.RemoveMark=Ev;EX.ClearMarks=Ax;EX.AddLine=E0;EX.InsertLine=B5;EX.RemoveLine=Et;EX.ClearLines=D6;EX.AddPolygon=Cj;EX.InsertPolygon=AT;EX.RemovePolygon=DC;EX.ClearPolygons=Ct;EX.AddEllipse=E7;EX.InsertEllipse=Ci;EX.RemoveEllipse=e;EX.ClearEllipses=K;EX.AddEllipticArc=AN;EX.InsertEllipticArc=Au;EX.RemoveEllipticArc=Ea;EX.ClearEllipticArcs=AR;EX.OpenInfoWindow=AS;EX.CloseInfoWindow=Bm;EX.SetGroupVisible=AH;EX.SetGroupZindex=Bd;EX.AddGeometry=Cn;EX.AddGeometries=AL;EX.InsertGeometry=BT;EX.InsertGeometries=Cg;EX.RemoveGeometry=l;EX.RemoveGeometries=Ad;EX.ClearGeometries=AM;EX.GetGeometry=AO;EX.GetGeometries=AZ;EX.UpdateGeometries=Dh;EX.SetDefaultGeometryStyle=Di;EX.SetGeometryTolerance=Dx;EX.SetCalculateInClient=u;EX.QueryGeomtryByPoint=CC;EX.AttachEvent=Es;EX.DetachEvent=Ei;EX.RemoveGroup=CF;EX=null;this.GetQueryManager=function(){if(!CO){CO=new SuperMap.IS.QueryManager(AX,CW,DI,Aq,CJ);CO.AttachEvent("onchangetrackinglayer",C9)}return CO};this.GetQueryManger=this.GetQueryManager;this.GetSpatialAnalystManager=function(){if(!DM){DM=new SuperMap.IS.SpatialAnalystManager(AX,CW,DI,Aq,CJ);DM.AttachEvent("onchangetrackinglayer",C9);DM.AttachEvent("onviewboundschanged",Cf)}return DM};this.GetEditManager=function(){if(!Bf){Bf=new SuperMap.IS.EditManager(AX,CW)}return Bf};this.GetMapStatus=function(FS,FU,FT,FR,FV){N.GetMapStatus(FS,FU,FT,FR,FV)};this.GetEntity=function(FS,FR,FW,FU,FT,FV){N.GetEntity(FS,FR,FW,FU,FT,FV)};this.GetEntities=function(FT,FR,FS,FV,FU,FW){N.GetEntities(FT,FR,FS,FV,FU,FW)};this.MeasureDistance=function(FR,FT,FU,FS,FV){N.MeasureDistance(FR,FT,FU,FS,FV)};this.MeasureArea=function(FR,FT,FU,FS,FV){N.MeasureArea(FR,FT,FU,FS,FV)};this.CustomInvoke=function(FU,FR,FT,FS,FV){N.CustomInvoke(FU,FR,FT,FS,FV)};this.GetOverview=function(FT,FS,FR,FU){N.GetOverview(FT,FS,FR,FU)};this.GetMapImage=function(FS,FT,FR,FU){N.GetMapImage(FS,FT,FR,FU)};this.GetMapImageByDpi=function(FT,FR,FU,FS,FV){N.GetMapImageByDpi(FT,FR,FU,FS,FV)};this.GetDefaultMapStatus=function(FR,FU,FT,FW,FV,FS,FX){N.GetDefaultMapStatus(FR,FU,FT,FW,FV,FS,FX)};this.OpenDatasource=function(FR,FT,FS,FU){N.OpenDatasource(FR,FT,FS,FU)};this.CloseDatasource=function(FR,FT,FS,FU){N.CloseDatasource(FR,FT,FS,FU)};this.RefreshDatasource=function(FS,FR,FT){N.RefreshDatasource(FS,FR,FT)};this.GetWorkspaceInfo=function(FS,FR,FT){N.GetWorkspaceInfo(FS,FR,FT)};this.GetDatasetInfo=function(FR,FU,FT,FS,FV){N.GetDatasetInfo(FR,FU,FT,FS,FV)};this.ClearCache=function(FR,FU,FT,FS,FV){N.ClearCache(FR,FU,FT,FS,FV)};this.ConnectDatasources=function(FS,FR,FT){N.ConnectDatasources(FS,FR,FT)};this.GetFieldInfo=function(FT,FV,FS,FR,FU){N.GetFieldInfo(FT,FV,FS,FR,FU)};this.MakeDefaultDotDensityTheme=function(FR,FV,FS,FU,FT,FW){N.MakeDefaultDotDensityTheme(FR,FV,FS,FU,FT,FW)};this.MakeDefaultGraduatedSymbolTheme=function(FR,FV,FS,FU,FT,FW){N.MakeDefaultGraduatedSymbolTheme(FR,FV,FS,FU,FT,FW)};this.MakeDefaultGraphTheme=function(FR,FU,FS,FV,FT,FW){N.MakeDefaultGraphTheme(FR,FU,FS,FV,FT,FW)};this.MakeDefaultRangeTheme=function(FS,FW,FR,FT,FV,FU,FX){N.MakeDefaultRangeTheme(FS,FW,FR,FT,FV,FU,FX)};this.MakeDefaultUniqueTheme=function(FS,FX,FT,FW,FR,FV,FU,FY){N.MakeDefaultUniqueTheme(FS,FX,FT,FW,FR,FV,FU,FY)};this.MakeDefaultGridRangeTheme=function(FS,FR,FT,FV,FU,FW){N.MakeDefaultGridRangeTheme(FS,FR,FT,FV,FU,FW)};this.ClearHighlight=function(FS,FR,FT){N.ClearHighlight(FS,FR,FT)};function EN(Fa,FR,FY,FS,FU,FX){var FZ=AX+"path.ashx";var FV=CW;function FW(Fe){if(!Fe){if(FS){FS(null,FX)}return }var Fc=eval("("+Fe+")");if(!Fc){return }var Fd=new SuperMap.IS.BusStop();Fd.FromJSON(Fc);if(Fc.Location){Fc.Location=null}Fc=null;var Fb="<div style='font-size:16px; color:blue; font-weight:bold'><img src='images/marker.gif' style='cursor:hand' />"+Fd.stopName+"<div>";DQ.CustomLayer.InsertMark("BusStop",Fd.Location.x,Fd.Location.y,10,10,Fb);DQ.PanToMapCoord(Fd.Location.x,Fd.Location.y);if(FS){FS(Fd,FX)}Fd.Destroy();Fd=null}var FT=new SuperMap.IS.RequestManager(FZ,FW,FU,FX);FT.AddQueryString("map",FV);FT.AddQueryString("method",Fa);FT.AddQueryStrings(FR,FY);FT.Send();FT.Destroy();FT=null;while(FR.length>0){FR.pop();FY.pop()}FR=null;FY=null}this.ShowBusStop=function(FU,FS,FR,FT){EN("ShowBusStop",["id"],[FU],FS,FR,FT)};function Dr(Fa,FR,FY,FS,FU,FX){var FZ=AX+"path.ashx";var FV=CW;function FW(Ff){if(!Ff){if(FS){FS(null,FX)}return }var Fg=eval("("+Ff+")");if(!Fg){return }var Fd=new SuperMap.IS.BusLine();Fd.FromJSON(Fg);if(Fg&&Fg.points){while(Fg.points.length>0){Fg.points.pop()}}Fg=null;var Fb=new Array();var Fe=new Array();for(var Fc=0;Fc<Fd.points.length;Fc++){Fb[Fc]=Fd.points[Fc].x;Fe[Fc]=Fd.points[Fc].y}DQ.CustomLayer.InsertLine("BusLine",Fb,Fe,3,"blue");DQ.ViewByPoints(Fd.points);while(Fb.length>0){Fb.pop();Fe.pop()}Fb=null;Fe=null;if(FS){FS(Fd,FX)}Fd.Destroy();Fd=null}var FT=new SuperMap.IS.RequestManager(FZ,FW,FU,FX);FT.AddQueryString("map",FV);FT.AddQueryString("method",Fa);FT.AddQueryStrings(FR,FY);FT.Send();FT.Destroy();FT=null;while(FR.length>0){FR.pop();FY.pop()}FR=null;FY=null}this.ShowBusLine=function(FU,FS,FR,FT){Dr("ShowBusLine",["id"],[FU],FS,FR,FT)};function D1(){var FT=new Array();for(var FS=0;FS<Bn.length;FS++){var FR=Bn[FS].id.toLowerCase();if(FR.indexOf("stopname")>-1){FT.push(Bn[FS].id)}}while(FT.length>0){DQ.CustomLayer.RemoveMark(FT.pop())}}function EJ(Fa,FR,FY,FS,FU,FX){var FZ=AX+"path.ashx";var FV=CW;function FW(Fh){if(!Fh){if(FS){FS(null,FX)}return }var Fl=eval("("+Fh+")");if(!Fl){return }var Fg=new SuperMap.IS.BusRouting();Fg.FromJSON(Fl);if(Fl.busLines){while(Fl.busLines.length>0){var Fj=Fl.busLines.pop();if(Fj&&Fj.points){while(Fj.points.length>0){Fj.points.pop()}}Fj=null}}if(Fl.upStops){while(Fl.upStops.length>0){var Fi=Fl.upStops.pop();if(Fi.Location){Fi.Location=null}Fi=null}}if(Fl.downStops){while(Fl.downStops.length>0){var Fi=Fl.downStops.pop();if(Fi.Location){Fi.Location=null}Fi=null}}Fl=null;if(Cc>0){for(var Ff=0;Ff<Cc;Ff++){DQ.CustomLayer.RemoveMark("BusStartStop"+Ff);DQ.CustomLayer.RemoveMark("BusEndStop"+Ff);DQ.CustomLayer.RemoveLine("BusRouting"+Ff)}D1()}if(Fg.upStops){for(var Ff=0;Ff<Fg.upStops.length;Ff++){var Fb="<div style='font-size:16px; color:blue;font-weight:bold'><img src='images/marker.gif' alt='"+Fg.upStops[Ff].stopName+"'style='cursor:hand' />";DQ.CustomLayer.InsertMark("BusStartStop"+Ff,Fg.upStops[Ff].Location.x,Fg.upStops[Ff].Location.y,10,10,Fb)}}if(Fg.downStops){for(var Ff=0;Ff<Fg.downStops.length;Ff++){var Fb="<div style='ffont-size:16px; color:blue;font-weight:bold'><img src='images/marker.gif' alt='"+Fg.downStops[Ff].stopName+"'style='cursor:hand' />";DQ.CustomLayer.InsertMark("BusEndStop"+Ff,Fg.downStops[Ff].Location.x,Fg.downStops[Ff].Location.y,10,10,Fb)}}if(Fg.busLines){for(var Ff=0;Ff<Fg.busLines.length;Ff++){var Fd=new Array();var Fk=new Array();for(var Fe=0;Fe<Fg.busLines[Ff].points.length;Fe++){Fd[Fe]=Fg.busLines[Ff].points[Fe].x;Fk[Fe]=Fg.busLines[Ff].points[Fe].y}DQ.CustomLayer.InsertLine("BusRouting"+Ff,Fd,Fk,3,"blue");while(Fd.length>0){Fd.pop();Fk.pop()}Fd=null;Fk=null}var Fc=new Array();for(var Ff=0;Ff<Fg.busLines.length;Ff++){for(var Fe=0;Fe<Fg.busLines[Ff].points.length;Fe++){Fc.push(Fg.busLines[Ff].points[Fe])}Cc=Ff+1}DQ.ViewByPoints(Fc);while(Fc.length>0){Fc.pop()}Fc=null}if(FS){FS(Fg,FX)}Fg.Destroy();Fg=null}var FT=new SuperMap.IS.RequestManager(FZ,FW,FU,FX);FT.AddQueryString("map",FV);FT.AddQueryString("method",Fa);FT.AddQueryStrings(FR,FY);FT.Send();FT.Destroy();FT=null;while(FR.length>0){FR.pop();FY.pop()}FR=null;FY=null}this.ShowRouting=function(FT,FS,FR,FU){EJ("ShowRouting",["busRouting"],[FT],FS,FR,FU)};this.GetResource=function(FS,FR,FU,FT,FV){N.GetResource(FS,FR,FU,FT,FV)};this.GetGeometryImage=function(FS,FR,FU,FT,FV){N.GetGeometryImage(FS,FR,FU,FT,FV)};this.GenerateResourceRequest=function(FS){var FR=_GetCurrentHandler(Db.mapHandler)+"ajax/"+encodeURI(Db.mapName)+"/"+FS.style.brushBackColor+"/"+FS.style.brushBackTransparent+"/"+FS.style.brushColor+"/"+FS.style.brushStyle+"/"+FS.style.penColor+"/"+FS.style.penStyle+"/"+FS.style.penWidth+"/"+FS.style.symbolRotation+"/"+FS.style.symbolSize+"/"+FS.style.symbolStyle+"/"+FS.resourceType+"/"+FS.imageFormat+"/"+FS.width+"/"+FS.height+"/map.ashx?GetResource=true&redirect="+Db.redirect;return FR};function Cq(FR){if(!FR){return -1}return(FR.r)|(FR.g<<8)|(FR.b<<16)}var W;var C1;var Ah;var Ag;var Bh;var Bg;var CI;var Ca;var An;var Aa;var D3;var Ee;var BB;var Ay;var Du;var h;var Ab;var BJ=false;var Cm;var Bu;var EL;function BO(){BJ=false;DQ.CustomLayer.RemoveMark("Walk");W=null;C1=null}function m(){BJ=false}function AC(){if(!W){return }if(!BJ){BJ=true;Df()}}function J(FZ,FR,Fa,FW,FX,Fb,FS,FT,FV,FU,FY){if(BJ){return }if(FZ==null||FZ.length<2){return }BJ=true;W=FZ;C1=FR;BB=Fa;Ay=FW;Du=FX;h=Fb;Ab=FS;Bu=FU;Cm=FY;D5=Dk();Aa=50;if(FT){Aa=FT}D3=100;if(FV){D3=FV}EL=0;FG()}this.StartDynamicNavigate=J;this.PauseDynamicNavigate=m;this.ContinueDynamicNavigate=AC;this.StopDynamicNavigate=BO;function FG(){if(!W){return }var FS=W[EL];var FR=W[EL+1];CU(FS);Bh=FR.x-FS.x;Bg=FR.y-FS.y;Ah=FS.x;Ag=FS.y;An=Math.sqrt((Math.pow(Bh,2)+Math.pow(Bg,2)));if(An==0){EL++;if(EL<W.length-1){FG()}else{if(Bu){Bu(Cm)}if(Ab){D5=Dk();if(W==null||W.length<2){return }EL=0;FG()}else{BJ=false;DQ.CustomLayer.RemoveMark("Walk")}}}else{Ee=An/Aa;CI=0;window.setTimeout(Df,D3)}}function Df(){if(!BJ){return }var FT=Aa*CI;CI++;if(FT>An){FT=An}var FR=new SuperMap.IS.MapCoord(FT*Bh/An+Ah,FT*Bg/An+Ag);CU(FR);var FU;var FS=DZ(FR);if(FS){FU="<img src='"+Ay+"'/>"}else{FU="<img src='"+BB+"'/>"}DQ.CustomLayer.InsertMark("Walk",FR.x,FR.y,20,40,FU);if(CI<Ee){Ew=window.setTimeout(Df,D3)}else{EL++;if(EL<W.length-1){FG(W[EL],W[EL+1],C1,EL)}else{if(Bu){Bu(Cm)}if(Ab){D5=Dk();if(W==null||W.length<2){return }EL=0;FG()}else{BJ=false;DQ.CustomLayer.RemoveMark("Walk")}}}}function CU(FR){if(!Dk().Contains(FR)){A5(FR.x,FR.y)}}function DZ(FR){if(C1!=null){for(var FS=0;FS<C1.length;FS++){if(C1[FS].Contains(FR)){if(h){h(FR,C1[FS],Cm)}return true;break}}}if(Du){Du(FR,Cm)}return false}function CA(FS){var FR=document.getElementById(Aj.id+"_hiddenLayers");if(FR){FR.value=FS}}function T(){var FR=new Object();FR.center=new SuperMap.IS.MapCoord();FR.center.x=r();FR.center.y=p();FR.mapScale=Ac.mapScale;FR.mapBounds=BW();FR.viewBounds=Dk();FR.mapName=CW;FR.trackingLayerIndex=DI;FR.userID=Aq;var FS=document.getElementById(Aj.id+"_hiddenMapParam");if(FS){FS.value=_ToJSON(FR)}}function Dj(){var FS=Aj.style.width+"|"+Aj.style.height;var FR=document.getElementById(Aj.id+"_hiddenSize");if(FR){FR.value=FS}}function Dt(){var FT=document.getElementById(Aj.id+"_hiddenClientAction");if(FT&&FT.value){var FR=FT.value;var FS=_JSONToAction(FR);Ef(FS)}}function Bq(){var FS=document.getElementById(Aj.id+"_hiddenMarks");if(FS&&FS.value){FS.value=unescape(FS.value);var FR=eval("("+FS.value+")");if(FR){while(FR.length>0){var FT=FR.pop();FT.innerHtml=FT.innerHtml;E5(FT.id,FT.x,FT.y,FT.w,FT.h,FT.innerHtml,FT.className,FT.zIndex,FT.groupID,FT.alignStyle);FT=null}}}}function FO(){var FT=document.getElementById(Aj.id+"_hiddenLines");if(FT&&FT.value){var FS=eval("("+FT.value+")");if(FS){while(FS.length>0){var FR=FS.pop();E0(FR.id,FR.xs,FR.ys,FR.strokeWeight,FR.strokeColor,FR.opacity,FR.zIndex,FR.groupID,FR.parts);FR=null}}}}function Dd(){var FT=document.getElementById(Aj.id+"_hiddenPolygons");if(FT&&FT.value){var FR=eval("("+FT.value+")");if(FR){while(FR.length>0){var FS=FR.pop();Cj(FS.id,FS.xs,FS.ys,FS.strokeWeight,FS.strokeColor,FS.fillColor,FS.fillOpacity,FS.zIndex,FS.groupID,FS.parts);FS=null}}}}function AW(){var FT=document.getElementById(Aj.id+"_hiddenEllipses");if(FT&&FT.value){var FR=eval("("+FT.value+")");if(FR){while(FR.length>0){var FS=FR.pop();E7(FS.id,FS.center,FS.semiMajorAxis,FS.semiMinorAxis,FS.strokeWeight,FS.strokeColor,FS.fillColor,FS.fillOpacity,FS.zIndex,FS.groupID);FS=null}}}}function z(){var FR=document.getElementById(Aj.id+"_hiddenEllipticArcs");if(FR&&FR.value){var FS=eval("("+FR.value+")");if(FS){while(FS.length>0){var FT=FS.pop();AN(FT.id,FT.center,FT.semiMajorAxis,FT.semiMinorAxis,FT.startAngle,FT.endAngle,FT.strokeWeight,FT.strokeColor,FT.opacity,FT.zIndex,FT.groupID);FT=null}}}}function C9(FR){I=new Date().getTime();DI=FR.trackingLayerIndex;Aq=FR.userID;if(N){N.ChangeTrackingLayerKey(DI,Aq)}if(CO){CO.ChangeTrackingLayerKey(DI,Aq)}if(DM){DM.ChangeTrackingLayerKey(DI,Aq)}if(FR.bSaveHistory){T()}Bt()}function DY(FR){Dq("onchangelayer")}function Cf(FR){if(FR){Am(FR.leftBottom.x,FR.leftBottom.y,FR.rightTop.x,FR.rightTop.y)}}function FL(){if(!DQ.storeClientInfo){return }var FU=document.getElementById(Aj.id+"_hiddenMarks");if(!FU){return }if(!Bn){FU.value=""}var FT=new Array();for(var FS=0;FS<Bn.length;FS++){var FV=new Object();FV.id=Bn[FS].id;FV.x=Bn[FS].x;FV.y=Bn[FS].y;FV.w=Bn[FS].w;FV.h=Bn[FS].h;FV.innerHtml=Bn[FS].innerHtml;FV.className=Bn[FS].className;FV.zIndex=Bn[FS].zIndex;FV.groupID=Bn[FS].groupID;FV.alignStyle=Bn[FS].alignStyle;FT.push(FV)}var FR=_ToJSON(FT);while(FT.length>0){FT.pop()}FT=null;FR=escape(FR);FU.value=FR}function FN(){if(!DQ.storeClientInfo){return }var FV=document.getElementById(Aj.id+"_hiddenLines");if(!FV){return }var FS=null;if(FK){FS=new Array();for(var FU=0;FU<FK.length;FU++){var FR=new Object();FR.id=FK[FU].id;FR.xs=FK[FU].xs;FR.ys=FK[FU].ys;FR.strokeWeight=FK[FU].strokeWeight;FR.strokeColor=FK[FU].strokeColor;FR.zIndex=FK[FU].zIndex;FR.groupID=FK[FU].groupID;FR.parts=FK[FU].parts;FS.push(FR)}}var FT=_ToJSON(FS);if(FS){while(FS.length>0){var FR=FS.pop();FR=null}FS=null}FV.value=FT}function q(){if(!DQ.storeClientInfo){return }var FV=document.getElementById(Aj.id+"_hiddenPolygons");if(!FV){return }var FR=null;if(FQ){FR=new Array();for(var FU=0;FU<FQ.length;FU++){var FT=new Object();FT.id=FQ[FU].id;FT.xs=FQ[FU].xs;FT.ys=FQ[FU].ys;FT.parts=FQ[FU].parts;FT.strokeWeight=FQ[FU].strokeWeight;FT.strokeColor=FQ[FU].strokeColor;FT.fillColor=FQ[FU].fillColor;FT.fillOpacity=FQ[FU].fillOpacity;FT.zIndex=FQ[FU].zIndex;FT.groupID=FQ[FU].groupID;FR.push(FT)}}var FS=_ToJSON(FR);if(FR){while(FR.length>0){var FT=FR.pop();FT=null}FR=null}FV.value=FS}function EF(){if(!DQ.storeClientInfo){return }var FV=document.getElementById(Aj.id+"_hiddenEllipses");if(!FV){return }var FT=null;if(Bw){FT=new Array();for(var FS=0;FS<Bw.length;FS++){var FU=new Object();FU.id=Bw[FS].id;FU.center=Bw[FS].center;FU.semiMajorAxis=Bw[FS].semiMajorAxis;FU.semiMinorAxis=Bw[FS].semiMinorAxis;FU.strokeWeight=Bw[FS].strokeWeight;FU.strokeColor=Bw[FS].strokeColor;FU.fillColor=Bw[FS].fillColor;FU.fillOpacity=Bw[FS].fillOpacity;FU.zIndex=Bw[FS].zIndex;FU.groupID=Bw[FS].groupID;FT.push(FU)}}var FR=_ToJSON(FT);if(FT){while(FT.length>0){var FU=FT.pop();FU=null}FT=null}FV.value=FR}function FD(){if(!DQ.storeClientInfo){return }var FT=document.getElementById(Aj.id+"_hiddenEllipticArcs");if(!FT){return }var FU=null;if(Cb){FU=new Array();for(var FS=0;FS<Cb.length;FS++){var FV=new Object();FV.id=Cb[FS].id;FV.center=Cb[FS].center;FV.semiMajorAxis=Cb[FS].semiMajorAxis;FV.semiMinorAxis=Cb[FS].semiMinorAxis;FV.startAngle=Cb[FS].startAngle;FV.endAngle=Cb[FS].endAngle;FV.strokeWeight=Cb[FS].strokeWeight;FV.strokeColor=Cb[FS].strokeColor;FV.fillColor=Cb[FS].fillColor;FV.fillOpacity=Cb[FS].fillOpacity;FV.zIndex=Cb[FS].zIndex;FV.groupID=Cb[FS].groupID;FU.push(FV)}}var FR=_ToJSON(FU);if(FU){while(FU.length>0){var FV=FU.pop();FV=null}FU=null}FT.value=FR}function Ck(){En=Eq;Eq=new Array();EC();DE();D4();Br();B6();Eg();At();D9()}function Bt(){if(o[1]!=null){while(o[1].length>0){var FT=o[1][0];delete o[1][FT];o[1].shift()}o[1]=null}if(!Eq[1]){Eq[1]=new Array()}if(Eq[1].length>0){for(var FX=0;FX<Eq[1].length;FX++){Eq[1][FX].RefreshUrl()}}else{var FZ=DN[BL[1]].visibleBounds;var Fg=DN[BL[1]].maxScale;var FS=DN[BL[1]].minScale;var FV=_Floor((X[1]-1)/2);var FU=_Floor((U[1]-1)/2);var Fa=0;var Fc=0;var FY=0;var FW=0;var Ff=0;var Fe=0;while(FV+Fa<X[1]||FU+Fa<U[1]){FY=FV+Fa;FW=FU-Fa;Ff=FY;Fe=FW;Fc=1;do{if(Ff>=0&&Ff<X[1]&&Fe>=0&&Fe<U[1]){var Fd=V(Ff+ET[1],Fe+D8[1],DN[BL[1]].tileWidth,DN[BL[1]].tileHeight,DN[BL[1]].layerBounds);var Fb=null;if((!Fg||Ac.mapScale<Fg)&&(!FS||Ac.mapScale>FS)&&(!FZ||Bp(Fd,FZ))){Fb=BK(Ff+ET[1],Fe+D8[1],Ac.mapScale,DN[BL[1]])}if(!Eq[1]){Eq[1]=new Array()}var FR=Ff+Fe*X[1];Eq[1][FR]=Fb}if(Ff==FV+Fa&&Fe==FU+Fa){Fc=0}else{if(Ff==FV-Fa&&Fe==FU+Fa){Fc=3}else{if(Ff==FV-Fa&&Fe==FU-Fa){Fc=2}else{if(Ff==FV+Fa&&Fe==FU-Fa){Fc=1}}}}if(Fa>0){if(Fc==0){Ff--}else{if(Fc==1){Fe++}else{if(Fc==2){Ff++}else{if(Fc==3){Fe--}}}}}}while(FY!=Ff||FW!=Fe);Fa++}}}function D0(){I=new Date().getTime();if(o[2]!=null){while(o[2].length>0){var FT=o[2][0];delete o[2][FT];o[2].shift()}o[2]=null}if(!Eq[2]){Eq[2]=new Array()}if(Eq[2].length>0){for(var FX=0;FX<Eq[2].length;FX++){Eq[2][FX].RefreshUrl()}}else{var FZ=DN[BL[2]].visibleBounds;var Fg=DN[BL[2]].maxScale;var FS=DN[BL[2]].minScale;var FV=_Floor((X[2]-1)/2);var FU=_Floor((U[2]-1)/2);var Fa=0;var Fc=0;var FY=0;var FW=0;var Ff=0;var Fe=0;while(FV+Fa<X[2]||FU+Fa<U[2]){FY=FV+Fa;FW=FU-Fa;Ff=FY;Fe=FW;Fc=1;do{if(Ff>=0&&Ff<X[2]&&Fe>=0&&Fe<U[2]){var Fd=V(Ff+ET[2],Fe+D8[2],DN[BL[2]].tileWidth,DN[BL[2]].tileHeight,DN[BL[2]].layerBounds);var Fb=null;if((!Fg||Ac.mapScale<Fg)&&(!FS||Ac.mapScale>FS)&&(!FZ||Bp(Fd,FZ))){Fb=BK(Ff+ET[2],Fe+D8[2],Ac.mapScale,DN[BL[2]])}if(!Eq[2]){Eq[2]=new Array()}var FR=Ff+Fe*X[2];Eq[2][FR]=Fb}if(Ff==FV+Fa&&Fe==FU+Fa){Fc=0}else{if(Ff==FV-Fa&&Fe==FU+Fa){Fc=3}else{if(Ff==FV-Fa&&Fe==FU-Fa){Fc=2}else{if(Ff==FV+Fa&&Fe==FU-Fa){Fc=1}}}}if(Fa>0){if(Fc==0){Ff--}else{if(Fc==1){Fe++}else{if(Fc==2){Ff++}else{if(Fc==3){Fe--}}}}}}while(FY!=Ff||FW!=Fe);Fa++}}}function A7(){Eh=true;CO=null;DM=null;overview=null;Bf=null;magnifier=null;while(E2.length>0){var FR=E2.pop();FR.RemoveFromMap();FR=null}while(y.length>0){var FU=y.pop();FU.RemoveFromMap();FU=null}while(t.length>0){var FV=t.pop();FV.RemoveFromMap();FV=null}while(Er.length>0){var FT=Er.pop();FT.RemoveFromMap();FT=null}if(A8){A8.Destroy();A8=null}if(CG){CG.Destroy()}Ax();D6();Ct();K();AR();Eo(true);if(BU){BU.parentNode.removeChild(BU);BU.innerHTML=""}while(a.length>0){var FS=a.pop();while(FS.length>0){FS.pop()}}DQ.Init()}function Dg(FT,FZ,Fa,FY,FR,FX,FW,Fc,Fe,Ff,Fb,Fd,FV){var FU=DN[FT];if(FU!=null){return false}if(FU==null){FU=new Object()}FU.id=FT;if(typeof (FZ)=="function"){FU.GetTileID=FZ}else{FU.tileIDPattern=FZ;FU.GetTileID=function(Fh,Fg,Fi){var Fj=FZ.replace(/{tx}/g,Fh);Fj=Fj.replace(/{ty}/g,Fg);Fj=Fj.replace(/{ms}/g,Fi);return Fj}}if(typeof (Fa)=="function"){FU.GetTileUrl=Fa}else{FU.tileUrlPattern=Fa;FU.GetTileUrl=function(Fh,Fg,Fi){var Fj=Fa.replace(/{tx}/g,Fh);Fj=Fj.replace(/{ty}/g,Fg);Fj=Fj.replace(/{ms}/g,Fi);return Fj}}if(FY){if(FU.visibleBounds==null){FU.visibleBounds=new SuperMap.IS.MapRect()}FU.visibleBounds.Copy(FY)}FU.maxScale=FR;FU.minScale=FX;FU.interval=FW;FU.opacity=Fc;if(Fe<0){FU.zIndex=DX}else{FU.zIndex=Fe}if(Ff){FU.tileWidth=Ff}else{FU.tileWidth=A4}if(Fb){FU.tileHeight=Fb}else{FU.tileHeight=A4}if(Fd){if(FU.layerBounds==null){FU.layerBounds=new SuperMap.IS.MapRect()}FU.layerBounds.Copy(Fd)}else{FU.layerBounds=N.GetMapBounds()}DN[FU.id]=FU;BL.push(FU.id);var FS=document.createElement("div");FS.id=FU.id;FS.style.zIndex=FU.zIndex;FS.style.position="absolute";FS.style.padding="0px";FS.style.margin="0px";FS.style.width=BU.style.width;FS.style.height=BU.style.height;BU.appendChild(FS);FU.container=FS;FU.useImageBuffer=FV;if(FU.interval&&FU.interval>0){FU.timeID=window.setInterval(Ba(FU.id),FU.interval)}return true}function c(Fd,Fc,Fe,FW,FT,Fg,Fh,FU,Fb,FR,FZ,Fa,FV){var FY=DN[Fd];if(!FY){return Dg(Fd,Fc,Fe,FW,FT,Fg,Fh,FU,Fb,FR,FZ,Fa,FV)}else{if(typeof (Fc)=="function"){FY.GetTileID=Fc}else{FY.tileIDPattern=Fc;FY.GetTileID=function(Fk,Fj,Fl){var Fm=Fc.replace(/{tx}/g,Fk);Fm=Fm.replace(/{ty}/g,Fj);Fm=Fm.replace(/{ms}/g,Fl);return Fm}}if(typeof (Fe)=="function"){FY.GetTileUrl=Fe}else{FY.tileUrlPattern=Fe;FY.GetTileUrl=function(Fk,Fj,Fl){var Fm=Fe.replace(/{tx}/g,Fk);Fm=Fm.replace(/{ty}/g,Fj);Fm=Fm.replace(/{ms}/g,Fl);return Fm}}FY.visibleBounds=FW;FY.maxScale=FT;FY.minScale=Fg;FY.interval=Fh;FY.opacity=FU;if(Fb<=0){FY.zIndex=DX}else{FY.zIndex=Fb}if(FR){FY.tileWidth=FR}else{FY.tileWidth=A4}if(FZ){FY.tileHeight=FZ}else{FY.tileHeight=A4}if(Fa){FY.layerBounds=Fa}else{FY.layerBounds=N.GetMapBounds()}FY.useImageBuffer=FV;if(FY.timeID){window.clearInterval(FY.timeID)}var FS=null;var FX=-1;for(var Ff=0;Ff<BL.length;Ff++){if(Fd==BL[Ff]){FX=Ff;break}}if(FX==-1){return }if(o[FX]!=null){while(o[FX].length>0){var Fi=o[FX][0];delete o[FX][Fi];o[FX].shift()}o[FX]=null}if(FY.timeID){window.clearInterval(FY.timeID)}if(FY.interval&&FY.interval>0){FY.timeID=window.setInterval(Ba(FY.id),FY.interval)}return true}}function EK(FW){if(!FW||FW==BH||FW==Eb||FW==DA){return false}if(DN[FW]){if(DN[FW].timeID){window.clearInterval(DN[FW].timeID)}}var FV=DN[FW].container;FV.parentNode.removeChild(FV);FV=null;DN[FW]=null;var FR=null;var FS=-1;for(var FU=0;FU<BL.length;FU++){if(FW==BL[FU]){FS=FU;break}}if(FS==-1){return true}if(o[FS]!=null){while(o[FS].length>0){var FT=o[FS][0];delete o[FS][FT];o[FS].shift()}o[FS]=null}for(var FU=0;FU<BL.length;FU++){if(BL[FU]==FW){BL.splice(FU,1);return true}}return false}function Eo(FU){var FX=false;var FR=BL.length;for(var FT=0;FT<FR;FT++){if(!FU){if(BL[FT]==BH||BL[FT]==Eb||BL[FT]==DA){continue}}if(DN[BL[FT]]){if(DN[BL[FT]].timeID){window.clearInterval(DN[BL[FT]].timeID)}}var FZ=null;if(o[FT]!=null){while(o[FT].length>0){var FS=o[FT][0];delete o[FT][FS];o[FT].shift()}o[FT]=null}var FW=DN[BL[FT]].container;FW.parentNode.removeChild(FW);FW=null;DN[BL[FT]]=null;FX=true}var FV=0;for(var FT=0;FT<FR;FT++){if(!FU){if(BL[FT]==BH||BL[FT]==Eb||BL[FT]==DA){FV++;continue}}var FY=BL.splice(FV,1);FY=null}return FX}this.CustomLayer.AddTileLayer=function(FS,FW,FX,FV,FR,FU,FT,FZ,Fb,Fc,FY,Fa){var Fd=Dg(FS,FW,FX,FV,FR,FU,FT,FZ,Fb,Fc,FY,Fa,false);if(Fd){Cr();Ck()}return Fd};this.CustomLayer.InsertTileLayer=function(FS,FW,FX,FV,FR,FU,FT,FZ,Fb,Fc,FY,Fa){var Fd=c(FS,FW,FX,FV,FR,FU,FT,FZ,Fb,Fc,FY,Fa);if(Fd){Cr();Ck()}return Fd};this.CustomLayer.RemoveTileLayer=function(FS){var FR=EK(FS);if(FR){Cr();Ck()}return FR};this.CustomLayer.AddWMSLayer=function(FS){function FR(FV,FX,FW){return FV+","+FX+","+FW+","+FS.id}function FT(Fc,Fb,FY){var Fe=V(Fc,Fb,A4,A4);var Fa=Fe.leftBottom.x;var FX=Fe.rightTop.x;var FZ=Fe.leftBottom.y;var FV=Fe.rightTop.y;var Fd=new Array();Fd.push(FS.param.url);var FW=FS.param.url;if(FW.substr(FW.length-1)!="?"){Fd.push("&")}Fd.push("SERVICE=WMS");Fd.push("&");Fd.push("REQUEST=GetMap");Fd.push("&");Fd.push("LAYERS=");Fd.push(FS.param.layers);Fd.push("&");if(parseFloat(FS.param.version)>=1.3){Fd.push("CRS=")}else{Fd.push("SRS=")}Fd.push(FS.param.projection);Fd.push("&");Fd.push("BBOX=");if(parseFloat(FS.param.version)>=1.3&&FS.param.projection.toLowerCase().indexOf("epsg")!=-1){Fd.push(FZ);Fd.push(",");Fd.push(Fa);Fd.push(",");Fd.push(FV);Fd.push(",");Fd.push(FX)}else{Fd.push(Fa);Fd.push(",");Fd.push(FZ);Fd.push(",");Fd.push(FX);Fd.push(",");Fd.push(FV)}Fd.push("&");Fd.push("WIDTH=");Fd.push(A4);Fd.push("&");Fd.push("HEIGHT=");Fd.push(A4);Fd.push("&");Fd.push("FORMAT=");Fd.push(FS.param.format);Fd.push("&");Fd.push("BGCOLOR=");Fd.push(FS.param.bgColor);Fd.push("&");Fd.push("VERSION=");Fd.push(FS.param.version);Fd.push("&Styles=");return Fd.join("")}var FU=Dg(FS.id,FR,FT,null,0,0,FS.interval,FS.opacity,FS.zIndex,A4,A4,null,false);if(FU){Cr();Ck()}return FU};this.CustomLayer.ClearTileLayers=function(){var FR=Eo(false);if(FR){Cr();Ck()}return FR};function Ak(FS,FR,FT){return FS+","+FR+","+FT+","+Aj.id}function CQ(FS,FR,FT){return N.GetTileUrl(FS,FR,FT)}function Af(FR,FT,FS){return N.GetTileSimpleCacheUrl(FR,FT,FS)}function BM(FS,FR,FT){return"tl,"+FS+","+FR+","+FT+","+Aj.id}function Al(FU,FS,FV){if(DI<0){return"images/spacer.gif"}var FR="";if(Db.customKeys){for(var FW=0;FW<Db.customKeys.length;FW++){FR+="&"+Db.customKeys[FW]+"="+Db.customValues[FW]}}var FX=false;FX=N.GetCurrentAntiAlias();var FT=_GetCurrentHandler(AX)+"ajax/"+encodeURI(DQ.mapName)+"/"+FV+"/"+FU+"/"+FS+"/"+DI+"/"+Aq+"/"+A4+"/gif/"+FX+"/"+Db.useReferBounds+"/map.ashx?GetTrackingLayerImage=true&t="+I+"&redirect="+Db.redirect+FR;return FT}function CE(FS,FR,FT){return"gl,"+FS+","+FR+","+FT+","+Aj.id}function DK(FU,FS,FV){if(CM==""){return"images/spacer.gif"}var FR="";if(Db.customKeys){for(var FW=0;FW<Db.customKeys.length;FW++){FR+="&"+Db.customKeys[FW]+"="+Db.customValues[FW]}}var FX=false;FX=N.GetCurrentAntiAlias();var FT=_GetCurrentHandler(AX)+"ajax/"+encodeURI(DQ.mapName)+"/"+FV+"/"+FU+"/"+FS+"/"+A4+"/"+El+"/"+CM+"/"+FX+"/"+Db.useReferBounds+"/map.ashx?GetGeometryImage=true&t="+I+"&redirect="+Db.redirect+FR;return FT}function V(Fd,Fb,Fc,FZ,Fa){if(!Fa){Fa=AD}var FX=new SuperMap.IS.PixelCoord();var FY=new SuperMap.IS.PixelCoord();FX.x=Fd*Fc;FX.y=(Fb+1)*FZ;FY.x=(Fd+1)*Fc;FY.y=(Fb)*FZ;var FT=Ez(1,Ac.mapScale);var Fe=Ez(1,Ac.mapScale,true);var FV=Fa.leftBottom.x+(FX.x*FT);var FS=Fa.rightTop.y-(FX.y*Fe);var FW=Fa.leftBottom.x+(FY.x*FT);var FU=Fa.rightTop.y-(FY.y*Fe);var FR=new SuperMap.IS.MapRect(FV,FS,FW,FU);FX=null;FY=null;return FR}this.GetTileBounds=V;function Bp(FS,FR){if(!FS||!FR){return false}if(FS.leftBottom.x<FR.rightTop.x&&FS.rightTop.x>FR.leftBottom.x&&FS.rightTop.y>FR.leftBottom.y&&FS.leftBottom.y<FR.rightTop.y){return true}return false}function Ba(FS){var FR=function(){var FW=null;var FT=null;var FV=-1;for(var FY=0;FY<BL.length;FY++){if(FS==BL[FY]){FW=Eq[FY];FV=FY;break}}if(FV==-1){return }if(o[FV]!=null){while(o[FV].length>0){var FX=o[FV][0];delete o[FV][FX];o[FV].shift()}o[FV]=null}if(FW.length>0){for(var FU=0;FU<FW.length;FU++){if(FW[FU]!=null){FW[FU].RefreshUrl()}}}};return FR}function Cr(){var FU=document.getElementById(Aj.id+"_hiddenTileLayers");if(!FU){return }if(DN==null){FU.value=""}var FW=new Array();for(var FS=0;FS<BL.length;FS++){if(BL[FS]==BH||BL[FS]==Eb){continue}var FV=DN[BL[FS]];if(!FV.tileIDPattern||!FV.tileUrlPattern){continue}var FT=new Object();FT.id=FV.id;FT.tileIDPattern=FV.tileIDPattern;FT.tileUrlPattern=FV.tileUrlPattern;FT.visibleBounds=FV.visibleBounds;FT.maxScale=FV.maxScale;FT.minScale=FV.minScale;FT.interval=FV.interval;FT.opacity=FV.opacity;FT.zIndex=FV.zIndex;FT.tileWidth=FV.tileWidth;FT.tileHeight=FV.tileHeight;FT.layerBounds=FV.layerBounds;FW.push(FT)}var FR=_ToJSON(FW);FU.value=FR}function A1(){var FT=document.getElementById(Aj.id+"_hiddenTileLayers");if(FT&&FT.value){var FS=FT.value;var FU=eval(FS);if(FU){for(var FR=0;FR<FU.length;FR++){if(FU[FR]){Dg(FU[FR].id,FU[FR].tileIDPattern,FU[FR].tileUrlPattern,FU[FR].visibleBounds,FU[FR].maxScale,FU[FR].minScale,FU[FR].interval,FU[FR].opacity,FU[FR].zIndex,FU[FR].tileWidth,FU[FR].tileHeight,FU[FR].layerBounds,false)}}}FU=null}}function D2(FS,FV,FU,FX){EH=FS;if(FS){function FT(FZ,Fb){var Fa=DQ.id+"PrintLayer";var FY=document.getElementById(Fa);if(FY==null){FY=document.createElement("div");FY.id=Fa;FY.style.zIndex=3;FY.style.position="absolute";FY.style.padding="0px";FY.style.margin="0px";FY.style.width=BU.style.width;FY.style.height=BU.style.height;FY.style.left="0px";FY.style.top="0px"}FY.style.backgroundImage="url("+FZ+")";FY.style.backgroundRepeat="no-repeat";BU.appendChild(FY);if(FV){FV(FZ,Fb)}}Ac.pixelRect=CN();N.GetMapImage(Ac,FT,FU,FX)}else{var FW=DQ.id+"PrintLayer";var FR=document.getElementById(FW);if(FR!=null){BU.removeChild(FR)}}}this.SetPrintMode=D2;function Bl(FR){CR=FR;var FS=Bx.MakeCopy();AV(FS)}this.SetCustomBounds=Bl}
