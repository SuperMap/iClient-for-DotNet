//================================================================================ 
// SuperMap IS .NET 客户端程序，版权所有，北京超图软件股份有限公司，2000-2008。 
// 本程序只能在有效的授权许可下使用。未经许可，不得以任何手段擅自使用或传播。 
// 作 者:  SuperMap IS Web Team 
// 版 本:  $Id: SuperMap.IS.LegendControl.js,v 1.80 2011/02/15 09:34:12 hubq Exp $
// 文 件:  SuperMap.IS.LegendControl.js 
// 描 述:  AjaxScripts 图例控件 
// 更 新:  $Date: 2011/02/15 09:34:12 $ 
//================================================================================
SuperMap.IS.LegendControl=function(Z,Q,E){var S=null;var l=null;Z=_GetDomElement(Z);var a=Z.id;var k=false;var M=1;var J=false;if(E&&typeof (E.isNeedTitle)!="undefined"){J=E.isNeedTitle}var D=true;if(E&&typeof (E.isShowInCurrentPage)!="undefined"){D=E.isShowInCurrentPage}var f="";if(E&&typeof (E.legendUrl)!="undefined"){f=E.legendUrl}var V=new Array();var I=new Array();var K;var b="White";if(E&&typeof (E.headerBackColor)!="undefined"){b=E.headerBackColor}this.titleFont=new SuperMap.IS.Font();if(E&&typeof (E.titleFont)!="undefined"){var h=eval("("+E.titleFont+")");this.titleFont.FromJSON(h);h=null}var O="Black";if(E&&typeof (E.headerForeColor)!="undefined"){O=E.headerForeColor}var W="White";if(E&&typeof (E.itemBackColor)!="undefined"){W=E.itemBackColor}this.itemFont=new SuperMap.IS.Font();if(E&&typeof (E.itemFont)!="undefined"){var T=eval("("+E.itemFont+")");this.itemFont.FromJSON(T);T=null}var N="Black";if(E&&typeof (E.itemForeColor)!="undefined"){N=E.itemForeColor}this.separator="@";if(E&&typeof (E.separator)!="undefined"){this.separator=E.separator}this.overFlowEnabled=true;if(E&&typeof (E.overFlowEnabled)!="undefined"){this.overFlowEnabled=E.overFlowEnabled}this.expand=false;if(E&&typeof (E.expand)!="undefined"){this.expand=E.expand}var g=16;if(E&&E.resourceWidth){g=E.resourceWidth}var j=16;if(E&&E.resourceHeight){j=E.resourceHeight}var B=true;if(E&&E.themeNameEnabled){B=E.themeNameEnabled}var H=this;var R=null;var e=null;this.Destroy=F;this.Update=L;if(Q){Q.AttachEvent("oninit",c);Q.AttachEvent("ondestroying",F)}function c(){if(k){return }if(R){if(R.parentNode){R.parentNode.removeChild(R)}R=null}R=document.createElement("div");var p="px";var n="px";var o=Z.style.pixelWidth;if(E&&typeof (E.width)!="undefined"){n=Y(E.width);o=E.width.toString().replace(n,"")}var m=Z.style.pixelHeight;if(E&&typeof (E.height)!="undefined"){p=Y(E.height);m=E.height.toString().replace(p,"")}R.style.width=o+n;R.style.height=m+p;R.style.position="relative";Z.appendChild(R);if(H.overFlowEnabled){R.style.overflow="auto";R.style.overflowX="auto";R.style.overflowY="auto"}k=true;S=Q;l=Q.layers;U();if(D){d()}else{Z.style.visibility="hidden"}if(Q){Q.AttachEvent("onendswitchmap",L);Q.AttachEvent("onchangelayer",L)}}function Y(m){if(m.toString().indexOf("px")!=-1){return"px"}else{if(m.toString().indexOf("%")!=-1){return"%"}}return"px"}function F(){if(S){Q.DetachEvent("onendswitchmap",L);Q.DetachEvent("onchangelayer",L);Q.DetachEvent("oninit",c);Q.DetachEvent("ondestroying",F)}l=null;a=null;k=null;M=null;J=null;D=null;f=null;V=null;I=null;K=null;b=null;H.titleFont.Destroy();H.titleFont=null;O=null;W=null;H.itemFont.Destroy();H.itemFont=null;N=null;if(Z){Z.innerHTML=""}H=null;Z=null}function U(){K=new Array();for(var m=0;m<Q.layers.length;m++){K[m]=m}}function d(){var s;var t="";t+="<table>";if(J){t+="<tr style='background-color:"+b+";color:"+O+";font-family:"+H.titleFont.fontFamily.name+";font-size:"+H.titleFont.size+";";if(H.titleFont.bold){t+="font-weight:bold;"}if(H.titleFont.italic){t+="font-style:itlic;"}if(H.titleFont.underline&&H.titleFont.strikeout){t+="text-decoration:underline line-through;"}else{if(H.titleFont.underline){t+="text-decoration:underline;"}else{if(H.titleFont.strikeout){t+="text-decoration:line-through;"}}}t+="'>";t+="<td ColSpan=4 align=center valign=middle>"+SuperMap.IS.LegendControlResource.title+" ("+Q.mapName+")</td>";t+="</tr>"}var n="";var AK="";t+=n;var z=new SuperMap.IS.ResourceParam();z.width=g;z.height=j;for(var AI=0;AI<K.length;AI++){var AE=K[AI];if(!l[AE]){continue}var y="";var v="";switch(l[AE].type){case SuperMap.IS.LayerType.point:v=0;break;case SuperMap.IS.LayerType.line:v=1;break;case SuperMap.IS.LayerType.polygon:v=2;break;case SuperMap.IS.LayerType.grid:v=2;break;case SuperMap.IS.LayerType.dem:v=2;break;default:break}var AJ=l[AE].name+"_StyleIMG";z.style=l[AE].style;z.resourceType=v;z.imageFormat=M;y="<tr style='background-color:"+W+";color:"+N+";font-family:"+H.itemFont.fontFamily.name+";font-size:"+H.itemFont.size+";";if(H.itemFont.bold){y+="font-weight:bold;"}if(H.itemFont.italic){y+="font-style:itlic;"}if(H.itemFont.underline&&H.itemFont.strikeout){y+="text-decoration:underline line-through;"}else{if(H.itemFont.underline){y+="text-decoration:underline;"}else{if(H.itemFont.strikeout){y+="text-decoration:line-through;"}}}y+="'>";var q=false;if(l[AE].themeUnique||l[AE].themeRange||l[AE].themeGraph||l[AE].themeGraduatedSymbol||l[AE].themeLabel||l[AE].themeDotDensity||l[AE].themeGridRange||l[AE].themeCustom){q=true}y+='<td valign="top" width="20px">';if(q){if(H.expand){y+='<img id="Switch_'+a+"_"+l[AE].name+'_Themes" src="images/expand.gif" >'}else{y+='<img id="Switch_'+a+"_"+l[AE].name+'_Themes" src="images/collapse.gif" >'}}y+="</td><td>";if(l[AE].type==SuperMap.IS.LayerType.point||l[AE].type==SuperMap.IS.LayerType.line||l[AE].type==SuperMap.IS.LayerType.polygon){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="'+Q.GenerateResourceRequest(z)+'" >'}else{if(l[AE].type==SuperMap.IS.LayerType.network){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/Network.gif" >'}else{if(l[AE].type==SuperMap.IS.LayerType.text){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/Text.gif" >'}else{if(l[AE].type==SuperMap.IS.LayerType.image){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/Image.gif" >'}else{if(l[AE].type==SuperMap.IS.LayerType.mrSID){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/MRSID.gif" >'}else{if(l[AE].type==SuperMap.IS.LayerType.grid){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/GRID.gif" >'}else{if(l[AE].type==SuperMap.IS.LayerType.dem){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/Dem.gif" >'}else{if(l[AE].type==SuperMap.IS.LayerType.ecw){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/Ecw.gif" >'}else{if(l[AE].type==SuperMap.IS.LayerType.cad){y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/CAD.gif" >'}else{y+='<img id="'+AJ+'"  width='+g+" height="+j+' src="images/spacer.gif" >'}}}}}}}}}y+='<span style="font-weight:bold">'+l[AE].caption.split(H.separator)[0]+"</span>";if(H.expand){y+='<table id="'+a+"_"+l[AE].name+'_Themes" style="display:block">'}else{y+='<table id="'+a+"_"+l[AE].name+'_Themes" style="display:none">'}var AG=l[AE].themeUnique;if(AG!=null){y+=i(AE,"Unique",AG);var x=l[AE].name+"_ThemeUnique_IMG";var o=null;if(AG.itemCaptions!=null&&AG.itemCaptions.length>0){o=AG.itemCaptions}else{o=AG.values}for(var AH=0;AH<AG.values.length;AH++){z.style=AG.displays[AH];z.resourceType=v;z.imageFormat=M;y+="<div style='width:80px;'><img id=\""+x+'"src="'+Q.GenerateResourceRequest(z)+'">'+o[AH]+"</div>"}y+=X()}var AC=l[AE].themeRange;if(AC!=null){y+=i(AE,"Range",AC);for(var AH=0;AH<AC.displays.length;AH++){var x=l[AE].name+"_ThemeRange_IMG"+AH;z.style=AC.displays[AH];z.resourceType=v;z.imageFormat=M;var AD="";if(AC.itemCaptions&&AC.itemCaptions[AH]){AD=AC.itemCaptions[AH]}else{if(AH==0){AD="x<"+AC.breakValues[AH]}else{if(AH==AC.displays.length-1){AD=AC.breakValues[AH-1]+"<=x"}else{AD=AC.breakValues[AH-1]+"<=x<"+AC.breakValues[AH]}}}y+="<div style='width:80px;'><img id=\""+x+'" src="'+Q.GenerateResourceRequest(z)+'" >'+AD+"</div>"}y+=X()}var AB=l[AE].themeGraph;if(AB!=null){y+=i(AE,"Graph",AB);for(var AH=0;AH<AB.graphStyles.length;AH++){var x=l[AE].name+"_ThemeGraph_IMG"+AH;z.style=AB.graphStyles[AH];z.resourceType=2;z.imageFormat=M;y+="<div style='width:80px;'><img id=\""+x+'" src="'+Q.GenerateResourceRequest(z)+'" >'+AB.expressions[AH]+"</div>"}y+=X()}var w=l[AE].themeGraduatedSymbol;if(w!=null){y+=i(AE,"GraduatedSymbol",w);var x;x=l[AE].name+"_ThemeGraph_IMG_0";z.style=w.styleForPositive;z.resourceType=0;z.imageFormat=M;y+="<Div style='width:80px;'><img id=\""+x+'" src="'+Q.GenerateResourceRequest(z)+'" >'+SuperMap.IS.LegendControlResource.positive+"</div>";if(w.showNegative==true){x=l[AE].name+"_ThemeGraph_IMG_1";z.style=w.styleForNegative;z.resourceType=0;z.imageFormat=M;y+="<Div style='width:80px;'><img id=\""+x+'" src="'+Q.GenerateResourceRequest(z)+'" >'+SuperMap.IS.LegendControlResource.negative+"</div>";y+=X()}}var r=l[AE].themeLabel;if(r!=null){y+=i(AE,"Label",r);y+=X()}var u=l[AE].themeDotDensity;if(u!=null){y+=i(AE,"DotDensity",u);var x=l[AE].name+"_ThemeDotDensity_IMG";z.style=u.dotStyle;z.resourceType=0;z.imageFormat=M;y+="<div style='width:80px;'><img id=\""+x+'" src="'+Q.GenerateResourceRequest(z)+'" >'+u.dotValue+"</div>";y+=X()}var AF=l[AE].themeGridRange;if(AF!=null){y+=i(AE,"GridRange",AF);for(var AH=0;AH<AF.displays.length;AH++){var x=l[AE].name+"_ThemeRange_IMG"+AH;z.style=new SuperMap.IS.Style();z.style.brushColor=AF.displays[AH];z.resourceType=v;z.imageFormat=M;var AD=AF.itemCaptions[AH];y+="<div style='width:80px;'><img id=\""+x+'" src="'+Q.GenerateResourceRequest(z)+'" >'+AD+"</div>"}y+=X()}var AA=l[AE].themeCustom;if(AA!=null){y+=i(AE,"Custom",AA);y+=X()}y+="</table></td>";y+="</tr>";t+=y}t+=n;t+="</table>";var p=document.createElement("form");p.innerHTML=t;R.appendChild(p);for(var AI=0;AI<K.length;AI++){var AE=K[AI];if(!l[AE]){continue}var q=false;if(l[AE].themeUnique||l[AE].themeRange||l[AE].themeGraph||l[AE].themeGraduatedSymbol||l[AE].themeLabel||l[AE].themeDotDensity||l[AE].themeGridRange||l[AE].themeCustom){q=true}if(q){C("Switch_"+a+"_"+l[AE].name+"_Themes",function(m){G(m)})}var AG=l[AE].themeUnique;if(AG!=null){C("Switch_"+a+"_"+l[AE].name+"_Unique",function(m){G(m)})}var AC=l[AE].themeRange;if(AC!=null){C("Switch_"+a+"_"+l[AE].name+"_Range",function(m){G(m)})}var AB=l[AE].themeGraph;if(AB!=null){C("Switch_"+a+"_"+l[AE].name+"_Graph",function(m){G(m)})}var w=l[AE].themeGraduatedSymbol;if(w!=null){C("Switch_"+a+"_"+l[AE].name+"_GraduatedSymbol",function(m){G(m)})}var r=l[AE].themeLabel;if(r!=null){}var u=l[AE].themeDotDensity;if(u!=null){C("Switch_"+a+"_"+l[AE].name+"_DotDensity",function(m){G(m)})}var AF=l[AE].themeGridRange;if(AF!=null){C("Switch_"+a+"_"+l[AE].name+"_GridRange",function(m){G(m)})}var AA=l[AE].themeCustom;if(AA!=null){}}e=new Array();for(var AI=0;AI<l.length;AI++){e[AI]=new SuperMap.IS.Layer();e[AI].FromJSON(l[AI])}}function C(o,n){var m=document.getElementById(o);if(m!=null){if(_ygPos.browser.indexOf("ie")!=-1||_ygPos.browser=="opera"){m.attachEvent("onclick",n)}else{m.addEventListener("click",n,true)}m=null}}function i(m,r,p){var q="<tr>";q+='<td valign="top" width="20px">';if(r!="Label"&&r!="Custom"){q+='<img id="Switch_'+a+"_"+l[m].name+"_"+r+'"  src="images/expand.gif" >'}var o="";if(p!=null){o=p.caption}var n="";switch(r){case"DotDensity":n="ThemeDotDensity.gif";break;case"GraduatedSymbol":n="ThemeGraduatedSymbol.gif";break;case"Graph":n="ThemeGraph.gif";break;case"Label":n="ThemeLabel.gif";break;case"Range":n="ThemeRange.gif";break;case"Unique":n="ThemeUnique.gif";break;case"Custom":n="ThemeCustom.gif";break;case"GridRange":n="ThemeRange.gif";if(p.breakValues[0]==null){q='<tr><td valign="top" width="20px">'}break}q+='</td><td><table><tr><td valign="top" width="20px"> <img src="images/'+n+'"> </td><td>';if(B==true){q+=o}q+="</td><tr><td></td><td>";q+='<div id="'+a+"_"+l[m].name+"_"+r+'" style="display:block">';return q}function X(){var m="</div></td></tr></table></td></tr>";return m}function A(n,o){var m=document.getElementById(o);m.src=n}function P(){}this.SwitchThemesDisplay=G;function G(q){var p=q.srcElement.id;var m=p.replace("Switch_","");var n=document.getElementById(p);var r=document.getElementById(m);if(r==null||n==null){return }if(r.style.display=="block"){r.style.display="none";n.src="images/collapse.gif"}else{r.style.display="block";n.src="images/expand.gif"}}function L(){k=false;c()}}
